var ei=Object.defineProperty;var ti=(f,e,i)=>e in f?ei(f,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[e]=i;var m=(f,e,i)=>ti(f,typeof e!="symbol"?e+"":e,i);import{e as rt,g as ii}from"./index-BRIFiw3q.js";const ie=class ie{constructor(e,i,t){m(this,"height",0);m(this,"width",0);m(this,"canvas");m(this,"context");m(this,"bufferCanvas");m(this,"bufferContext");this.height=i,this.width=t,e instanceof HTMLCanvasElement?(this.canvas=e,this.canvas.tabIndex=1):(this.canvas=this.createCanvas(i,t),this.canvas.tabIndex=1,e==null||e.appendChild(this.canvas)),this.canvas.style.imageRendering="pixelated",this.context=this.canvas.getContext("2d"),this.context.canvas.classList.add("fade-in"),this.bufferCanvas=this.createCanvas(i,t),this.bufferCanvas.style.imageRendering="pixelated",this.bufferContext=this.bufferCanvas.getContext("2d"),this.canvas.addEventListener("focus",()=>{const s=new CustomEvent("focus",{detail:{state:!0}});document.dispatchEvent(s)}),this.canvas.addEventListener("blur",()=>{const s=new CustomEvent("focus",{detail:{state:!1}});document.dispatchEvent(s)})}static initialize(e,i,t){return ie.instance||(ie.instance=new ie(e,i,t)),ie.instance}static get canvas(){return ie.instance}static get context(){return ie.instance.bufferContext}static get height(){return ie.instance.height}static get width(){return ie.instance.width}static getBufferCanvas(){return ie.instance.bufferCanvas}static getDisplayCanvas(){return ie.instance.canvas}createCanvas(e,i){const t=document.createElement("canvas");return t.height=e,t.width=i,t}static Clear(){ie.instance.bufferCanvas&&ie.instance.canvas&&ie.instance.context.clearRect(0,0,ie.instance.canvas.width,ie.instance.canvas.height)}static Render(){ie.instance.bufferCanvas&&ie.instance.canvas&&(ie.instance.context.imageSmoothingEnabled=!1,ie.instance.context.drawImage(ie.instance.bufferCanvas,0,0,ie.instance.bufferCanvas.width,ie.instance.bufferCanvas.height,0,0,ie.instance.canvas.width,ie.instance.canvas.height))}};m(ie,"instance");let C=ie;const $e=class $e{constructor(){m(this,"pending",[]);m(this,"assetsLoaded",!1);m(this,"animations",{});m(this,"fonts",{});m(this,"images",{});m(this,"total",0)}static initalize(){return $e.instance||($e.instance=new $e),$e.instance}Preload(...e){this.pending=[],e.forEach(i=>{this.total+=i.length,i.forEach(async t=>{await this.LoadAsset(t.name,t.src)})})}async LoadAsset(e,i,t){var s;switch(t||(t=this.onAssetLoaded.bind(this)),(s=i.split(".").pop())==null?void 0:s.toLowerCase()){case"anm2":await this.loadAnimation(e,i,t);break;case"fnt":await this.loadFont(e,i,t);break;case"gif":case"png":const r=await this.loadImage(e,i);if(!r){console.warn("Error loading asset",i);return}if(this.pending.includes(r)){console.debug("Already waiting for asset to load",i);return}r.onload=()=>{t&&t()},this.pending.push(r);break;default:console.error("No media loader available for",i)}}async loadAnimation(e,i,t){const s=new ni;s.Load(i,()=>{this.animations[e]=s,this.pending.push({complete:!0}),t&&t()}),this.animations[e]=s}async loadFont(e,i,t){return fetch(i).then(s=>s.arrayBuffer()).then(s=>{this.fonts[e]=new si(s),this.pending.push({complete:!0}),t&&t()})}async loadImage(e,i){const t=new Image;return this.images[e]=t,t.onerror=s=>{console.error(`Failed to load image: ${i}`,s),t.complete=!0},t.src=i,t}onAssetLoaded(){const e=Math.floor((this.pending.length-this.pending.filter(s=>!s.complete).length)/this.total*100),i=this.pending.length===this.total&&this.pending.length-this.pending.filter(s=>s.complete).length===0,t=new CustomEvent("loadingEvent",{detail:{progress:e}});document.dispatchEvent(t),i&&(this.assetsLoaded=!0)}draw(e,i,t,s,r,a,l,c,y){const v=this.images[e];if(!v){console.warn(`Image "${e}" not found`);return}if(!v.complete||v.naturalWidth===0){console.warn(`Image "${e}" is not properly loaded or is broken`);return}C.context.imageSmoothingEnabled=!1,s!==void 0&&r!==void 0&&a!==void 0&&l!==void 0&&c!==void 0&&y!==void 0?C.context.drawImage(v,i,t,s,r,a,l,c,y):s!==void 0&&r!==void 0?C.context.drawImage(v,i,t,s,r):C.context.drawImage(v,i,t)}getAnimation(e){if(!(e in this.animations))throw"Invalid animation name. Animation has not been loaded.";return new ri(this.animations[e])}getFont(e){return this.fonts[e]}getImage(e){return this.images[e]}};m($e,"instance");let nt=$e;const j=nt.initalize();class ai{constructor(e){m(this,"chunk");this.chunk=e}toHex(){return[...new Uint8Array(this.chunk)].map(e=>e.toString(16).padStart(2,"0")).join("")}toString(){return[...new Uint8Array(this.chunk)].map(e=>String.fromCharCode(e)).join("")}toInt(){return[...new Uint8Array(this.chunk)].reduce((e,i)=>e+i,0)}Value(){return this.chunk}}class si{constructor(e){m(this,"data");m(this,"position",0);m(this,"name","");m(this,"sourceFile","");m(this,"image");m(this,"height",0);m(this,"width",0);m(this,"map",{});this.data=new Uint8Array(e),this.parseFontFile()}parseFontFile(){if(this.read(5).toHex()!=="424d460301")throw new Error("Not a valid .fnt file header!");for(this.skip(18),this.name=this.readString(),this.skip(9),this.height=this.readUint16(),this.width=this.readUint16(),this.skip(12),this.sourceFile=this.readString().toLowerCase(),j.LoadAsset(this.sourceFile,`resources/font/${this.sourceFile}`,()=>{this.image=j.getImage(this.sourceFile)}),this.skip(5);this.remainingBytes>=20;){const i=String.fromCharCode(this.readUint16());this.skip(2),this.map[i]={xOffset:this.readUint16(),yOffset:this.readUint16(),width:this.readUint16(),height:this.readUint16(),xPad:this.readUint16(),yPad:this.readUint16()},this.map[i].xPad>10&&(this.map[i].xPad=0),this.skip(4)}}get remainingBytes(){return this.data.byteLength-this.position}read(e){if(this.remainingBytes<e)return null;const i=new Uint8Array(this.data.buffer.slice(this.position,this.position+e));return this.position+=e,new ai(i)}skip(e){this.position+=e}readByte(){return this.read(1)}readUint16(){const e=this.read(2).Value();return e?e[1]<<8|e[0]:null}readString(){let e,i="";for(;(e=this.read(1))&&e.toHex()!=="00";)i+=e.toString();return i}readRemaining(){if(this.remainingBytes===0)return null;const e=new Uint8Array(this.data.buffer.slice(this.position));return this.position=this.data.byteLength,e}write(e,i,t=1,s,r){let a=0,l=0;const c=i.clone();return[...e].forEach(y=>{let[v,h]=this.writeLetter(y,c,s,r);v+=t,c.add(new $.Vector(v,0)),v>a&&(a=v),h>l&&(l=h)}),[a,l]}writeLetter(e,i,t=1,s=1){return!(e in this.map)||!this.image?[0,0]:(this.image&&this.image.complete&&this.image.naturalWidth>0?C.context.drawImage(this.image,this.map[e].xOffset,this.map[e].yOffset,this.map[e].width,this.map[e].height,i.x+Math.ceil(this.map[e].xPad*t),i.y+Math.ceil(this.map[e].yPad+s),Math.ceil(this.map[e].width*t),Math.ceil(this.map[e].height*s)):console.warn("Font image is not properly loaded or is broken"),[Math.ceil(this.map[e].width*t),Math.ceil(this.map[e].height*s)])}GetName(){return this.name}}var q=(f=>(f[f.WALK_UP=1]="WALK_UP",f[f.WALK_DOWN=2]="WALK_DOWN",f[f.WALK_LEFT=3]="WALK_LEFT",f[f.WALK_RIGHT=4]="WALK_RIGHT",f[f.SHOOT_UP=5]="SHOOT_UP",f[f.SHOOT_DOWN=6]="SHOOT_DOWN",f[f.SHOOT_LEFT=7]="SHOOT_LEFT",f[f.SHOOT_RIGHT=8]="SHOOT_RIGHT",f[f.BOMB=9]="BOMB",f[f.ITEM=10]="ITEM",f[f.POCKET_ITEM=11]="POCKET_ITEM",f[f.DROP=12]="DROP",f[f.FULLSCREEN=13]="FULLSCREEN",f[f.RESTART=14]="RESTART",f[f.MUTE=15]="MUTE",f))(q||{}),le=(f=>(f[f.NONE=0]="NONE",f.UP="Up",f.DOWN="Down",f.LEFT="Left",f.RIGHT="Right",f))(le||{}),Xe=(f=>(f[f.LEFT=60]="LEFT",f[f.UP=7]="UP",f[f.RIGHT=74]="RIGHT",f[f.DOWN=127]="DOWN",f))(Xe||{}),je=(f=>(f[f.RIGHT=1]="RIGHT",f[f.LEFT=-1]="LEFT",f))(je||{}),te=(f=>(f[f.NONE=0]="NONE",f[f.PIT=1]="PIT",f[f.OBJECT=2]="OBJECT",f[f.SOLID=3]="SOLID",f[f.WALL=4]="WALL",f[f.WALL_EXCEPT_PLAYER=5]="WALL_EXCEPT_PLAYER",f))(te||{}),we=(f=>(f[f.EMPTY=0]="EMPTY",f[f.FULL=1]="FULL",f[f.HALF=2]="HALF",f[f.SOUL=3]="SOUL",f[f.ETERNAL=4]="ETERNAL",f[f.DOUBLE=5]="DOUBLE",f[f.BLACK=6]="BLACK",f[f.GOLDEN=7]="GOLDEN",f[f.HALF_SOUL=8]="HALF_SOUL",f[f.SCARED=9]="SCARED",f[f.BLENDED=10]="BLENDED",f[f.BONE=11]="BONE",f[f.ROTTEN=12]="ROTTEN",f))(we||{}),Rt=(f=>(f[f.INIT=0]="INIT",f[f.APPEAR=1]="APPEAR",f[f.IDLE=2]="IDLE",f[f.MOVE=3]="MOVE",f[f.SUICIDE=4]="SUICIDE",f[f.JUMP=5]="JUMP",f[f.STOMP=6]="STOMP",f[f.ATTACK=7]="ATTACK",f[f.SUMMON=8]="SUMMON",f[f.SPECIAL=9]="SPECIAL",f[f.DEATH=10]="DEATH",f))(Rt||{}),mt=(f=>(f.BOSS="Boss",f.CURSE="Curse",f.DEFAULT="Normal",f.SECRET="Secret",f.SHOP="Shop",f.START="Start",f.SUPERSECRET="SuperSecret",f.TREASURE="Treasure",f))(mt||{});class ri{constructor(e){m(this,"animation");m(this,"currentAnimation",!1);m(this,"animationFrame");m(this,"nullAnimationFrame",0);m(this,"rotation");m(this,"spritesheets");m(this,"playing",!1);m(this,"mirror",!1);m(this,"RGBTintImageCache",{});m(this,"RGBOffsetImageCache",{});m(this,"xOffset",0);m(this,"yOffset",0);m(this,"scale",new $.Vector(1,1));m(this,"layerScale",{});this.animation=e,this.animation.Enter(),this.InitializeCache()}Enter(){this.currentAnimation=this.animation.GetAnimations()[this.animation.GetDefaultAnimation()],this.currentAnimation instanceof Q&&(this.animationFrame=0)}GetFrameCount(){return this.currentAnimation instanceof Q?this.currentAnimation.frames:-1}GetAnimationName(){return this.currentAnimation instanceof Q?this.currentAnimation.name:null}HideLayer(e){this.currentAnimation instanceof Q&&console.log(this.currentAnimation)}IsPlaying(){return this.playing}GetSpritesheet(){return this.spritesheets?this.spritesheets:this.animation.GetSpritesheet()}Play(e,i){this.playing&&!i||(e=e||this.animation.GetDefaultAnimation(),e in this.animation.GetAnimations()&&this.currentAnimation instanceof Q&&(this.currentAnimation.name!==e||i)&&(this.currentAnimation=this.animation.GetAnimations()[e],this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames,this.playing=!0)))}Scale(e){this.scale=e}ScaleLayer(e,i){this.layerScale[e]=i}Stop(){this.playing=!1}async InitializeCache(){Object.keys(this.animation.GetAnimations()).forEach(e=>{const i=this.animation.GetAnimations()[e];for(let t=0;t<i.layerAnimations.length;t++)for(let s=0;s<i.layerAnimations[t].frames.length;s++){const r=i.layerAnimations[t].frames[s],a=this.animation.GetLayers()[t].spritesheet;let l=this.GetSpritesheet()[a];if(r.redOffset!==0||r.greenOffset!==0||r.blueOffset!==0){const c=`${t}:${a}@[RO=${r.redOffset},GO=${r.greenOffset},BO=${r.blueOffset}]`;if(!(c in this.RGBOffsetImageCache)){const y=l.height,v=l.width,h=new C(null,l.height,l.width).createCanvas(l.height,l.width),b=h.getContext("2d");b.drawImage(l,0,0);const x=b.getImageData(0,0,l.width,l.height),g=x.data;for(let E=0,k=g.length;E<k;E+=4){const D=g[E],_=g[E+1],P=g[E+2],G=Math.floor((D+_+P)/3);g[E]=g[E+1]=g[E+2]=G}b==null||b.putImageData(x,0,0),b.globalCompositeOperation="source-atop",b.globalAlpha=1,b.fillStyle=`rgb(${r.redOffset}, ${r.greenOffset}, ${r.blueOffset})`,b.fillRect(0,0,l.width,l.height),b.globalCompositeOperation="lighter",b.drawImage(l,0,0);const T=new Image;T.src=h.toDataURL(),l=T,l.height=y,l.width=v,this.RGBOffsetImageCache[c]=l}}if(r.redTint!==255||r.greenTint!==255||r.blueTint!==255){const c=`${t}:${a}@[RT=${r.redTint},GT=${r.greenTint},TO=${r.blueTint}]`;if(!(c in this.RGBTintImageCache)){const y=l.height,v=l.width,h=new C(null,l.height,l.width).createCanvas(l.height,l.width),b=h.getContext("2d");b.drawImage(l,0,0);const x=b.getImageData(0,0,l.width,l.height),g=x.data;for(let E=0,k=g.length;E<k;E+=4){const D=g[E],_=g[E+1],P=g[E+2],G=Math.floor((D+_+P)/3);g[E]=g[E+1]=g[E+2]=G}b==null||b.putImageData(x,0,0),b.globalCompositeOperation="source-atop",b.globalAlpha=1,b.fillStyle=`rgb(${r.redTint}, ${r.greenTint}, ${r.blueTint})`,b.fillRect(0,0,l.width,l.height),b.globalCompositeOperation="multiply",b.drawImage(l,0,0);const T=new Image;T.src=h.toDataURL(),l=T,l.height=y,l.width=v,this.RGBTintImageCache[c]=l}}}})}Render(e,i,t){if(this.currentAnimation instanceof Q)for(let s=0;s<this.currentAnimation.layerAnimations.length;s++)this.RenderLayer(s,e,i,t)}RenderLayer(e,i,t,s){if(!(this.currentAnimation instanceof Q))return;const r=this.currentAnimation.layerAnimations[e];let a=r.frames[this.currentAnimation.frames-this.animationFrame];if(a||(a=[...r.frames].pop()),a&&a.visible){const l=this.animation.GetLayers()[r.layerId].spritesheet;let c=this.GetSpritesheet()[l];if(a.redOffset!==0||a.greenOffset!==0||a.blueOffset!==0){const k=`${r.layerId}:${l}@[RO=${a.redOffset},GO=${a.greenOffset},BO=${a.blueOffset}]`;k in this.RGBOffsetImageCache?c=this.RGBOffsetImageCache[k]:console.log("RGB Offset Spritesheet doesn't exist?")}if(a.redTint!==255||a.greenTint!==255||a.blueTint!==255){const k=`${r.layerId}:${l}@[RT=${a.redTint},GT=${a.greenTint},TO=${a.blueTint}]`;k in this.RGBTintImageCache?c=this.RGBTintImageCache[k]:console.log("RGB Tint Spritesheet doesn't exist, creating?",k)}const y=a.xCrop,v=a.yCrop,h=a.width,b=a.height,x=i.x-a.xPivot+a.xPosition,g=i.y-a.yPivot+a.yPosition,T=a.width,E=a.height;C.context.save(),C.context.imageSmoothingEnabled=!1,C.context.globalAlpha=a.alphaTint/255,C.context.translate(x+a.xPivot,g+a.yPivot),C.context.rotate(this.rotation*Math.PI/180||a.rotation*Math.PI/180),C.context.scale(a.xScale/100,a.yScale/100),C.context.translate(a.xScale<0?-1:0,a.yScale<0?-1:0),(this.scale.x!==1||this.scale.y!==1)&&C.context.scale(this.scale.x,this.scale.y),e in this.layerScale&&C.context.scale(this.layerScale[e].x,this.layerScale[e].y),C.context.translate((x+a.xPivot)*-1,(g+a.yPivot)*-1),c&&c.complete&&c.naturalWidth>0?C.context.drawImage(c,y,v,h,b,x+this.xOffset,g+this.yOffset,T,E):console.warn("Spritesheet for animation is not properly loaded or is broken",{spritesheet:c}),C.context.restore(),he.GetDebugSettings().GridInfo&&(C.context.strokeStyle="#ff0000",C.context.strokeRect(i.x,i.y,1,1))}}async ReplaceSpritesheet(e,i){this.spritesheets||(this.spritesheets=Object.assign({},this.animation.GetSpritesheet()));const t=new URL(i,window.location.href);await fetch(t).then(async s=>{if(!s.ok)t.pathname.startsWith("/public/resources-dlc3")&&(t.pathname=t.pathname.replace("/public/resources-dlc3","/public/resources"),await fetch(t).then(r=>{if(r.ok){const a=new Image;a.src=t.href,this.spritesheets[e]=a}else throw new Error("Not 2xx response")}));else{const r=new Image;r.src=t.href,this.spritesheets[e]=r}})}Mirror(){this.mirror=!this.mirror}Rotate(e){this.rotation=e}SetAnimation(e,i=!0){e in this.animation.GetAnimations()&&this.currentAnimation instanceof Q&&this.currentAnimation.name!==e&&(this.currentAnimation=this.animation.GetAnimations()[e],this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames))}SetFrame(e,i){this.playing||(i&&this.SetAnimation(i),this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames-e))}Update(e){if(!(this.currentAnimation instanceof Q))return;const i=this.animationFrame;this.playing&&this.animationFrame--,this.animationFrame<=0&&this.playing&&(this.currentAnimation instanceof Q&&this.currentAnimation.loop?this.animationFrame=this.currentAnimation.frames:this.animationFrame=1),i===this.animationFrame&&!this.currentAnimation.loop&&(this.playing=!1),this.currentAnimation.nullAnimations.every(t=>{t.frames.length&&this.nullAnimationFrame++}),e!==void 0&&e(i===this.animationFrame)}OnNullItem(e){this.currentAnimation instanceof Q&&this.currentAnimation.nullAnimations.forEach(i=>{e(i.layerId,i.frames[this.nullAnimationFrame])})}OnTrigger(e){this.currentAnimation instanceof Q&&(this.currentAnimation.triggers.forEach(i=>{this.animationFrame===i.atFrame&&Object.values(this.animation.events).forEach(t=>{if(t.id===i.eventId)return e(t.name)})}),e(null))}}class ni{constructor(e){m(this,"source");m(this,"loaded",!1);m(this,"spritesheets",{});m(this,"layers",{});m(this,"nulls",{});m(this,"events",{});m(this,"animations",{});m(this,"defaultAnimationName");m(this,"rotation");m(this,"xScale",0);m(this,"yScale",0);m(this,"baseHREF");m(this,"fps",30);m(this,"playing",!1);m(this,"currentAnimation",!1);m(this,"animationFrame",NaN);m(this,"x",0);m(this,"y",0);m(this,"xOffset",0);m(this,"yOffset",0);m(this,"RGBTintImageCache",{});m(this,"RGBOffsetImageCache",{});e&&(this.source=e,this.Load(this.source,()=>{this.loaded=!0}))}get frame(){return this.currentAnimation instanceof Q?this.currentAnimation.frames-this.animationFrame:!1}Enter(){this.currentAnimation=this.animations[this.defaultAnimationName],this.currentAnimation instanceof Q&&(this.animationFrame=0)}FrameDebug(e){if(this.currentAnimation instanceof Q)for(let i=0;i<this.currentAnimation.layerAnimations.length;i++){const s=this.currentAnimation.layerAnimations[i].frames[this.currentAnimation.frames-this.animationFrame];!s||!s.visible||e(s)}}GetAnimation(){return this.currentAnimation}GetAnimations(){return this.animations}GetAnimationName(){return this.currentAnimation instanceof Q?this.currentAnimation.name:null}GetDefaultAnimation(){return this.defaultAnimationName}GetFilename(){return this.source}GetFrame(){return this.currentAnimation instanceof Q?this.currentAnimation.frames-this.animationFrame:0}GetFrameCount(){return this.currentAnimation instanceof Q?this.currentAnimation.frames:-1}GetLayerCount(){return this.currentAnimation instanceof Q?this.currentAnimation.layerAnimations.length:0}GetLayers(){return this.layers}GetSpritesheet(){return this.spritesheets}GetOverlayAnimation(){return""}GetOverlayFrame(){return 0}IsEventTriggered(e){return!1}IsFinished(e){return this.frame===this.currentAnimation.frames}IsLoaded(){return this.loaded}IsOverlayFinished(e){return!1}IsOverlayPlaying(e){return!1}IsPlaying(e){return this.currentAnimation instanceof Q?this.currentAnimation.name===e&&this.playing:!1}IsVisible(){if(!(this.currentAnimation instanceof Q))return!1;let e=!1;for(let i=0;i<this.currentAnimation.layerAnimations.length;i++){const t=this.currentAnimation.layerAnimations[i];let s=t.frames[this.currentAnimation.frames-this.animationFrame];s||(s=[...t.frames].pop()),s&&s.visible&&(e=!0)}return e}async Load(e,i){var G,O;const t=new URL(e.toLowerCase(),window.location.href),s=t.href.substring(0,t.href.lastIndexOf("/"))+"/",a=await(await fetch(t.href)).text(),l=new window.DOMParser().parseFromString(a,"application/xml"),c=l.evaluate("/AnimatedActor/Content/Spritesheets/Spritesheet",l,null,XPathResult.ANY_TYPE,null);let y;for(;y=c.iterateNext();)if(y instanceof Element){const L=y.getAttribute("Path").replace(/\\/g,"/"),A=new URL(L,s);await fetch(A).then(async u=>{if(!u.ok)A.pathname.startsWith("/public/resources-dlc3")&&(A.pathname=A.pathname.replace("/public/resources-dlc3","/public/resources"),await fetch(A).then(R=>{if(R.ok){const I=new Image;I.src=A.href,this.spritesheets[y.getAttribute("Id")]=I}else throw new Error("Not 2xx response")}));else{const R=new Image;R.src=A.href,this.spritesheets[y.getAttribute("Id")]=R}})}const v=l.evaluate("/AnimatedActor/Content/Layers/Layer",l,null,XPathResult.ANY_TYPE,null);let h;for(;h=v.iterateNext();)h&&(this.layers[h.getAttribute("Id")]={name:h.getAttribute("Name"),id:parseInt(h.getAttribute("Id"),10),spritesheet:parseInt(h.getAttribute("SpritesheetId"),10)});const b=l.evaluate("/AnimatedActor/Content/Nulls/Null",l,null,XPathResult.ANY_TYPE,null);let x;for(;x=b.iterateNext();)x&&(this.nulls[x.getAttribute("Id")]={name:x.getAttribute("Name"),id:parseInt(x.getAttribute("Id"),10),showRect:x.getAttribute("ShowRect")?JSON.parse((G=x.getAttribute("ShowRect"))==null?void 0:G.toLowerCase()):!0});const g=l.evaluate("/AnimatedActor/Content/Events/Event",l,null,XPathResult.ANY_TYPE,null);let T;for(;T=g.iterateNext();)T&&(this.events[T.getAttribute("Id")]={name:T.getAttribute("Name"),id:parseInt(T.getAttribute("Id"),10)});const E=l.evaluate("/AnimatedActor/Animations/@DefaultAnimation",l,null,XPathResult.ANY_TYPE,null);this.defaultAnimationName=(O=E.iterateNext())==null?void 0:O.nodeValue;const D=l.evaluate("/AnimatedActor/Info",l,null,XPathResult.ANY_TYPE,null).iterateNext();D?this.fps=parseInt(D.getAttribute("Fps"),10)/1e3:this.fps=30/1e3;const _=l.evaluate("/AnimatedActor/Animations/Animation",l,null,XPathResult.ANY_TYPE,null);let P;for(;P=_.iterateNext();)P=new Q(P),this.animations[P.name]=P;i!==void 0&&i()}Play(e,i){e in this.animations&&this.currentAnimation instanceof Q&&this.currentAnimation.name!==e&&(this.currentAnimation=this.animations[e],this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames,this.playing=!0))}PlayOverlay(e,i){}PlayRandom(e){}Reload(){}RemoveOverlay(){}Render(e,i,t){if(this.currentAnimation instanceof Q)for(let s=0;s<this.currentAnimation.layerAnimations.length;s++)this.RenderLayer(s,e,i,t)}RenderLayer(e,i,t,s){if(!(this.currentAnimation instanceof Q))return;const r=this.currentAnimation.layerAnimations[e];let a=r.frames[this.currentAnimation.frames-this.animationFrame];if(a||(a=[...r.frames].pop()),a&&a.visible){let l=this.GetSpritesheet()[this.layers[r.layerId].spritesheet];if(a.redOffset!==0||a.greenOffset!==0||a.blueOffset!==0){const E=`${l.src}@[RO=${a.redOffset},GO=${a.greenOffset},BO=${a.blueOffset}]`;if(E in this.RGBOffsetImageCache)l=this.RGBOffsetImageCache[E];else{const k=new C(null,l.height,l.width).createCanvas(l.height,l.width),D=k.getContext("2d");D.drawImage(l,0,0);const _=D.getImageData(0,0,l.width,l.height),P=_.data;for(let O=0,L=P.length;O<L;O+=4){const A=P[O],u=P[O+1],R=P[O+2],I=Math.floor((A+u+R)/3);P[O]=P[O+1]=P[O+2]=I}D==null||D.putImageData(_,0,0),D.globalCompositeOperation="source-atop",D.globalAlpha=1,D.fillStyle=`rgb(${a.redOffset}, ${a.greenOffset}, ${a.blueOffset})`,D.fillRect(0,0,l.width,l.height),D.globalCompositeOperation="lighter",D.drawImage(l,0,0);const G=new Image;G.src=k.toDataURL(),l=G,this.RGBOffsetImageCache[E]=l}}if(a.redTint!==255||a.greenTint!==255||a.blueTint!==255){const E=`${l.src}@[RT=${a.redTint},GT=${a.greenTint},TO=${a.blueTint}]`;if(E in this.RGBTintImageCache)l=this.RGBTintImageCache[E];else{const k=new C(null,l.height,l.width).createCanvas(l.height,l.width),D=k.getContext("2d");D.drawImage(l,0,0);const _=D.getImageData(0,0,l.width,l.height),P=_.data;for(let O=0,L=P.length;O<L;O+=4){const A=P[O],u=P[O+1],R=P[O+2],I=Math.floor((A+u+R)/3);P[O]=P[O+1]=P[O+2]=I}D==null||D.putImageData(_,0,0),D.globalCompositeOperation="source-atop",D.globalAlpha=1,D.fillStyle=`rgb(${a.redTint}, ${a.greenTint}, ${a.blueTint})`,D.fillRect(0,0,l.width,l.height),D.globalCompositeOperation="multiply",D.drawImage(l,0,0);const G=new Image;G.src=k.toDataURL(),l=G,this.RGBTintImageCache[E]=l}}const c=a.xCrop,y=a.yCrop,v=a.width,h=a.height,b=i.x-a.xPivot+a.xPosition,x=i.y-a.yPivot+a.yPosition,g=a.width,T=a.height;C.context.save(),C.context.imageSmoothingEnabled=!1,C.context.globalAlpha=a.alphaTint/255,C.context.translate(b+a.xPivot,x+a.yPivot),C.context.rotate(this.rotation*Math.PI/180||a.rotation*Math.PI/180),C.context.scale(a.xScale/100,a.yScale/100),C.context.translate(a.xScale<0?-1:0,a.yScale<0?-1:0),C.context.translate((b+a.xPivot)*-1,(x+a.yPivot)*-1),l&&l.complete&&l.naturalWidth>0?C.context.drawImage(l,c,y,v,h,b+this.xScale+this.xOffset,x+this.yScale+this.yOffset,g-this.xScale,T-this.yScale):console.warn("Spritesheet for BaseAnimation is not properly loaded or is broken"),C.context.restore(),C.context.save(),C.context.strokeStyle="#ff0000",C.context.strokeRect(i.x,i.y,1,1),C.context.restore()}}Reset(){}Rotate(e){this.rotation=e}SetAnimation(e,i=!0){e in this.animations&&this.currentAnimation instanceof Q&&this.currentAnimation.name!==e&&(this.currentAnimation=this.animations[e],this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames))}SetFrame(e,i){i&&this.SetAnimation(i),this.currentAnimation instanceof Q&&(this.animationFrame=this.currentAnimation.frames-e)}SetAnimationLength(e){this.currentAnimation instanceof Q&&(this.currentAnimation.frames=e)}Stop(){this.playing=!1}Update(e){if(!(this.currentAnimation instanceof Q))return;const i=this.animationFrame;this.currentAnimation&&this.animationFrame--,this.animationFrame<=0&&(this.currentAnimation instanceof Q&&this.currentAnimation.loop?this.animationFrame=this.currentAnimation.frames:this.animationFrame=1),e!==void 0&&e(i===this.animationFrame)}WasEventTriggered(e){return!1}}class Q{constructor(e){m(this,"node");m(this,"name");m(this,"frames");m(this,"loop");m(this,"rootAnimation",[]);m(this,"layerAnimations",[]);m(this,"nullAnimations",[]);m(this,"triggers",[]);var i;this.node=e,this.name=e.getAttribute("Name"),this.frames=parseInt(e.getAttribute("FrameNum"),10),this.loop=((i=e.getAttribute("Loop"))==null?void 0:i.toLowerCase())==="true",this.Initialize()}Initialize(){for(let e=0;e<this.node.childNodes.length;e++){const i=this.node.childNodes[e];if(i.nodeType===Node.ELEMENT_NODE)switch(i.nodeName){case"RootAnimation":this.LoadRootAnimation(i);break;case"LayerAnimations":this.LoadLayerAnimations(i);break;case"NullAnimations":this.LoadNullAnimations(i);break;case"Triggers":this.LoadTriggers(i);break;default:throw new Error(`Unknown animation node: ${i.nodeName}`)}}}LoadRootAnimation(e){this.rootAnimation=this.GetFrames(e)}LoadLayerAnimations(e){var t;const i=[];for(let s=0;s<e.childNodes.length;s++){const r=e.childNodes[s];r.nodeType===Node.ELEMENT_NODE&&i.push({layerId:parseInt(r.getAttribute("LayerId"),10),visible:((t=r.getAttribute("Visible"))==null?void 0:t.toLowerCase())==="true",frames:this.GetFrames(r)})}this.layerAnimations=i}LoadNullAnimations(e){var t;const i=[];for(let s=0;s<e.childNodes.length;s++){const r=e.childNodes[s];r.nodeType===Node.ELEMENT_NODE&&i.push({layerId:parseInt(r.getAttribute("NullId"),10),visible:((t=r.getAttribute("Visible"))==null?void 0:t.toLowerCase())==="true",frames:this.GetFrames(r)})}this.nullAnimations=i}LoadTriggers(e){const i=[];for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];s.nodeType===Node.ELEMENT_NODE&&i.push({eventId:parseInt(s.getAttribute("EventId"),10),atFrame:parseInt(s.getAttribute("AtFrame"),10)})}this.triggers=i}GetFrames(e){var t,s;const i=[];for(let r=0;r<e.childNodes.length;r++){const a=e.childNodes[r];let l;for(let c=r+1;c<e.childNodes.length;c++){const y=e.childNodes[c];if(y.nodeType===Node.ELEMENT_NODE){l=y;break}}if(a.nodeType===Node.ELEMENT_NODE){const c=parseInt(a.getAttribute("Delay"),10),y=JSON.parse(a.getAttribute("Interpolated")?(t=a.getAttribute("Interpolated"))==null?void 0:t.toLowerCase():"false"),v=((s=a.getAttribute("Visible"))==null?void 0:s.toLowerCase())==="true";for(let h=0;h<c;h++){const b=g=>parseInt(a.getAttribute(g),10),x=g=>{if(!y||!l)return b(g);{const T=b(g),E=parseInt(l.getAttribute(g),10);return Math.floor(T+(E-T)/c*h)}};i.push({interpolated:y,visible:v,height:b("Height"),width:b("Width"),rotation:b("Rotation"),xPosition:b("XPosition"),yPosition:b("YPosition"),xPivot:b("XPivot"),yPivot:b("YPivot"),xCrop:b("XCrop"),yCrop:b("YCrop"),xScale:x("XScale"),yScale:x("YScale"),redTint:x("RedTint"),greenTint:x("GreenTint"),blueTint:x("BlueTint"),alphaTint:x("AlphaTint"),redOffset:x("RedOffset"),greenOffset:x("GreenOffset"),blueOffset:x("BlueOffset")})}}}return i}}let et;const oi=new Uint8Array(16);function li(){if(!et&&(et=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!et))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return et(oi)}const ve=[];for(let f=0;f<256;++f)ve.push((f+256).toString(16).slice(1));function ci(f,e=0){return(ve[f[e+0]]+ve[f[e+1]]+ve[f[e+2]]+ve[f[e+3]]+"-"+ve[f[e+4]]+ve[f[e+5]]+"-"+ve[f[e+6]]+ve[f[e+7]]+"-"+ve[f[e+8]]+ve[f[e+9]]+"-"+ve[f[e+10]]+ve[f[e+11]]+ve[f[e+12]]+ve[f[e+13]]+ve[f[e+14]]+ve[f[e+15]]).toLowerCase()}const di=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),At={randomUUID:di};function hi(f,e,i){if(At.randomUUID&&!f)return At.randomUUID();f=f||{};const t=f.random||(f.rng||li)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,ci(t)}class Me{constructor(e){m(this,"Animation");m(this,"traits",{});m(this,"parent");m(this,"Hitbox");m(this,"Acceleration",new $.Vector(0,0));m(this,"_elasticity",0);m(this,"_friction",.35);m(this,"_mass",0);m(this,"Position",new $.Vector(0,0));m(this,"_speed",1);m(this,"_uuid",hi());m(this,"Velocity",new $.Vector(0,0));m(this,"Modifiers",{Elasticity:0,Friction:0,Mass:0,Speed:0});this.Position=e||new $.Vector(C.width/2,C.height/2)}get Elasticity(){return this._elasticity+this.Modifiers.Elasticity}SetBaseElasticity(e){return this._elasticity=e,this}IncreaseElasticity(e){return this.Modifiers.Elasticity+=e,this}DecreaseElasticity(e){return this.Modifiers.Elasticity-=e,this}get Friction(){return this._friction+this.Modifiers.Friction}SetBaseFriction(e){return this._friction=e,this}SetFrictionModifier(e){return this.Modifiers.Friction=e,this}IncreaseFriction(e){return this.Modifiers.Friction+=e,this}DecreaseFriction(e){return this.Modifiers.Friction-=e,this}get Mass(){return this._mass+this.Modifiers.Mass}get InvertedMass(){return this.Mass===0?0:1/this.Mass}SetBaseMass(e){return this._mass=e,this}IncreaseMass(e){return this.Modifiers.Mass+=e,this}DecreaseMass(e){return this.Modifiers.Mass-=e,this}get Speed(){return this._speed+this.Modifiers.Speed}SetBaseSpeed(e){return this._speed=e,this}IncreaseSpeed(e){return this.Modifiers.Speed+=e,this}DecreaseSpeed(e){return this.Modifiers.Speed-=e,this}get UUID(){return this._uuid}Enter(){Object.values(this.traits).forEach(e=>{e.Enter(this)}),this.Animation&&this.Animation.Enter()}addTrait(e){this.traits[e.name]=e}getTrait(e){return e in this.traits?this.traits[e]:void 0}hasTrait(e){return e in this.traits}removeTrait(e){this.hasTrait(e)&&delete this.traits[e]}renderTrait(e){var i;(i=this.traits[e])==null||i.render(this,!0)}finalize(){Object.values(this.traits).forEach(e=>{e.finalize()})}IsVisible(){return!0}Collision(e,i){Object.values(this.traits).forEach(t=>{t.collides(this,e)}),i&&(e.Position.sub(i.overlapV.clone().scale(e.InvertedMass)),this.Position.sub(i.overlapV.clone().scale(-this.InvertedMass)))}OnEnterCollision(e,i){}OnExitCollision(e,i){}OnAnimate(e){}OnRoomEnter(){}OnRoomExit(){}collides(e){Object.values(this.traits).forEach(i=>{i.collides(this,e)})}obstruct(e,i){Object.values(this.traits).forEach(t=>{t.obstruct(this,e,i)})}Update(e){this.SetFrictionModifier(0),Object.values(this.traits).forEach(i=>{i.update(this,e)}),this.Animation&&this.Animation.Update(i=>{this.OnAnimate(i)})}Render(){if(Object.values(this.traits).forEach(e=>{e.render(this)}),this.Animation&&this.Animation.Render(this.Position),this.Hitbox&&he.GetDebugSettings().Hitspheres){if(C.context.save(),C.context.strokeStyle="#ff0000",C.context.beginPath(),this.Hitbox instanceof $.Circle){const e=this.Hitbox;C.context.arc(e.pos.x,e.pos.y,e.r,0,Math.PI*2,!0)}else if(this.Hitbox instanceof $.Polygon){const e=this.Hitbox;if(e.calcPoints.length===4)C.context.rect(e.pos.x,e.pos.y,e.calcPoints[2].x,e.calcPoints[2].y);else{C.context.moveTo(e.calcPoints[0].x,e.calcPoints[0].y);for(let i=1;i<e.calcPoints.length;i++)C.context.lineTo(e.calcPoints[i].x,e.calcPoints[i].y);C.context.lineTo(e.calcPoints[0].x,e.calcPoints[0].y)}}C.context.closePath(),C.context.stroke(),C.context.restore()}}remove(){const e=[];he.GetLevel().GetRoom().GetNonGridEntities().forEach(i=>{i!==this&&e.push(i)}),he.GetLevel().GetRoom().SetNonGridEntities(e)}get Parent(){return this.parent}DistanceTo(e){return bt(this.Position,e)}TargetDirection(e){return Ht(this.Position,e)}GetAnimation(){return this.Animation}SetAnimation(e){return this.Animation=e,this}GetHitbox(){return this.Hitbox}SetHitbox(e){return this.Hitbox=e,this}GetRenderOrder(){return this.Hitbox?this.Position.y:-1}}class tt extends Me{constructor(i){i.add(new $.Vector(13,13));super(i);m(this,"HP",3);m(this,"Ready",!1);m(this,"CollisionRadius",8);m(this,"bfsDistanceGrid",null);m(this,"bfsGridWidth",0);m(this,"bfsGridHeight",0);m(this,"bfsCellSize",0);m(this,"bfsRoomLeft",0);m(this,"bfsRoomTop",0);m(this,"ProjectileCooldown");m(this,"ProjectileDelay");m(this,"State",Rt.INIT);m(this,"StateFrame",0);m(this,"Alive",!0);m(this,"lastPathTarget",null);m(this,"lastPathTime",0);m(this,"cachedPath",[]);m(this,"pathCacheTimeout",2e3)}Update(i){var t,s;super.Update(i),he.GetRoomFrameCount()>10&&(this.Ready=!0),this.Alive||(s=(t=he.GetLevel())==null?void 0:t.GetRoom())==null||s.RemoveEntity(this),this.Hitbox&&(this.Hitbox.pos=this.Position)}Render(){super.Render(),this.Alive&&j.getFont("luaminioutlined").write(String(this.HP),this.Position.clone().sub(new $.Vector(7,6)))}OnRoomEnter(){super.OnRoomEnter()}OnRoomExit(){super.OnRoomExit(),this.Ready=!1}FindPath(i,t){const s=Date.now();return this.bfsDistanceGrid&&this.lastPathTarget&&s-this.lastPathTime<this.pathCacheTimeout&&Math.abs(this.lastPathTarget.x-i.x)<20&&Math.abs(this.lastPathTarget.y-i.y)<20?[]:this.LineOfSight(i)?(this.bfsDistanceGrid=null,this.lastPathTarget=i.clone(),this.lastPathTime=s,[]):(this.findBFSPath(i),this.lastPathTarget=i.clone(),this.lastPathTime=s,[])}GetBFSMovementDirection(){if(!this.bfsDistanceGrid){const h=he.GetPlayer();if(h){const b=h.Position.clone();b.x-=this.Position.x,b.y-=this.Position.y;const x=Math.sqrt(b.x*b.x+b.y*b.y);if(console.log(`${this.constructor.name} GetBFSMovementDirection: Direct movement - direction (${b.x},${b.y}), magnitude ${x}`),x>.1){const g=b.normalize();return console.log(`${this.constructor.name} GetBFSMovementDirection: Normalized direction (${g.x},${g.y})`),g}}return console.log(`${this.constructor.name} GetBFSMovementDirection: No direct movement - too close or no player`),null}const i=Math.floor((this.Position.x-this.bfsRoomLeft)/this.bfsCellSize),t=Math.floor((this.Position.y-this.bfsRoomTop)/this.bfsCellSize),s=Math.max(0,Math.min(this.bfsGridWidth-1,i)),r=Math.max(0,Math.min(this.bfsGridHeight-1,t));if(console.log(`${this.constructor.name} GetBFSMovementDirection: pos=(${this.Position.x},${this.Position.y}), grid=(${s},${r})`),this.bfsDistanceGrid[r][s]===0)return console.log(`${this.constructor.name} GetBFSMovementDirection: At target (distance 0)`),null;const a=this.bfsDistanceGrid[r][s];console.log(`${this.constructor.name} GetBFSMovementDirection: Current distance = ${a}`);const l=[{dx:0,dy:1},{dx:1,dy:0},{dx:0,dy:-1},{dx:-1,dy:0}],c=[{dx:1,dy:1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:-1,dy:-1}];let y=null,v=a;for(const h of l){const b=s+h.dx,x=r+h.dy;if(b<0||b>=this.bfsGridWidth||x<0||x>=this.bfsGridHeight)continue;const g=this.bfsDistanceGrid[x][b];console.log(`${this.constructor.name} GetBFSMovementDirection: Cardinal (${h.dx},${h.dy}) -> distance ${g}`),g!==-1&&g<v&&(v=g,y=new $.Vector(h.dx,h.dy),console.log(`${this.constructor.name} GetBFSMovementDirection: New best cardinal direction (${h.dx},${h.dy}) with distance ${g}`))}if(!y)for(const h of c){const b=s+h.dx,x=r+h.dy;if(b<0||b>=this.bfsGridWidth||x<0||x>=this.bfsGridHeight)continue;const g=this.bfsDistanceGrid[x][b];console.log(`${this.constructor.name} GetBFSMovementDirection: Diagonal (${h.dx},${h.dy}) -> distance ${g}`),g!==-1&&g<v&&(v=g,y=new $.Vector(h.dx,h.dy),console.log(`${this.constructor.name} GetBFSMovementDirection: New best diagonal direction (${h.dx},${h.dy}) with distance ${g}`))}return console.log(`${this.constructor.name} GetBFSMovementDirection: Final direction = ${y?`(${y.x},${y.y})`:"null"}`),y}findBlockingObstacle(i){var l;const t=(l=he.GetLevel())==null?void 0:l.GetRoom();if(!t)return null;const s=t.GetEntities();let r=null,a=1/0;for(const c of s)if(c instanceof ye){const y=c,v=y.GetCollisionClass();if((v===te.SOLID||v===te.OBJECT||v===te.WALL)&&this.isObstacleBetween(this.Position,i,y)){const h=Math.sqrt((y.Position.x-this.Position.x)**2+(y.Position.y-this.Position.y)**2);h<a&&(a=h,r=y)}}return r}isObstacleBetween(i,t,s){const r=s.Position,a=s.CollisionRadius||12,l=Math.sqrt((t.x-i.x)**2+(t.y-i.y)**2);if(l===0)return!1;const c=Math.max(0,Math.min(1,((r.x-i.x)*(t.x-i.x)+(r.y-i.y)*(t.y-i.y))/(l*l))),y=new $.Vector(i.x+c*(t.x-i.x),i.y+c*(t.y-i.y));return Math.sqrt((y.x-r.x)**2+(y.y-r.y)**2)<a+this.CollisionRadius+5}findObstacleAvoidancePath(i,t){var b;const s=i.Position,a=(i.CollisionRadius||12)+this.CollisionRadius+25,l=this.Position.clone().sub(s).normalize(),c=new $.Vector(-l.y,l.x),y=new $.Vector(l.y,-l.x),v=[a,a+20,a+40,a+60],h=[0,30,60,90,120,150,180,210,240,270,300,330];for(const x of v)for(const g of h){const T=c.clone().rotate(g),E=y.clone().rotate(g),k=s.clone().add(T.scale(x)),D=s.clone().add(E.scale(x)),_=Math.sqrt((k.x-t.x)**2+(k.y-t.y)**2),P=Math.sqrt((D.x-t.x)**2+(D.y-t.y)**2),G=_<P?k:D;if(Ge(this.Position,G,this.CollisionRadius,this)){const O=(b=he.GetLevel())==null?void 0:b.GetRoom();if(O){const L=O.GetEntities();let A=!1;for(const u of L)if(u instanceof ye&&u!==i){const R=u,I=R.GetCollisionClass();if(I===te.SOLID||I===te.OBJECT||I===te.WALL){const U=Math.sqrt((G.x-R.Position.x)**2+(G.y-R.Position.y)**2),W=(R.CollisionRadius||12)+this.CollisionRadius+20;if(U<W){A=!0;break}}}if(A)continue}if(Ge(G,t,this.CollisionRadius,this)){const L=[G,t];if(this.validatePath(L))return L}else{const L=[G];if(this.validatePath(L))return L}}}return[]}findWaypointPath(i){var a;const t=(a=he.GetLevel())==null?void 0:a.GetRoom();if(!t)return[];const s=t.GetEntities(),r=[];for(const l of s)if(l instanceof ye){const c=l,y=c.GetCollisionClass();if(y===te.SOLID||y===te.OBJECT||y===te.WALL){const v=c.Position,b=(c.CollisionRadius||12)+this.CollisionRadius+15,x=[0,45,90,135,180,225,270,315];for(const g of x){const T=v.clone().add(new $.Vector(Math.cos(g*Math.PI/180)*b,Math.sin(g*Math.PI/180)*b));r.push(T)}}}for(const l of r)if(Ge(this.Position,l,this.CollisionRadius,this)&&Ge(l,i,this.CollisionRadius,this)){const c=[l,i];if(this.validatePath(c))return c}return[]}findFallbackPath(i){const t=this.TargetDirection(i),s=Math.sqrt((this.Position.x-i.x)**2+(this.Position.y-i.y)**2),r=[0,-15,15,-30,30,-45,45,-60,60,-75,75,-90,90,-105,105,-120,120,-135,135,-150,150,-165,165,180],a=[15,20,25,30,35,40,50,60];for(const l of a)for(const c of r){const y=t.clone().rotate(c),v=this.Position.clone().add(y.scale(l));if(Ge(this.Position,v,this.CollisionRadius,this)&&Math.sqrt((v.x-i.x)**2+(v.y-i.y)**2)<s){const b=[v];if(this.validatePath(b))return b}}for(const l of a)for(const c of r){const y=t.clone().rotate(c),v=this.Position.clone().add(y.scale(l));if(Ge(this.Position,v,this.CollisionRadius,this)){const h=[v];if(this.validatePath(h))return h}}return[]}validatePath(i){if(!i||i.length===0)return yt.IsPaused(),!1;let t=this.Position;for(let s=0;s<i.length;s++){const r=i[s],a=Math.sqrt((r.x-t.x)**2+(r.y-t.y)**2),l=Math.max(2,Math.floor(a/30));for(let c=0;c<=l;c++){const y=c/l,v=new $.Vector(t.x+y*(r.x-t.x),t.y+y*(r.y-t.y));if(!Ge(t,v,this.CollisionRadius,this))return!1}t=r}return!0}findBFSPath(i){var t;try{const s=(t=he.GetLevel())==null?void 0:t.GetRoom();if(!s)return[];console.log(`${this.constructor.name} Using room: ${s.constructor.name}`);const r=15,a=9,l=26,c=26,y=26,v=Math.floor((this.Position.x-c)/l),h=Math.floor((this.Position.y-y)/l),b=Math.floor((i.x-c)/l),x=Math.floor((i.y-y)/l);console.log(`${this.constructor.name} BFS: Raw conversion - pos(${this.Position.x},${this.Position.y}) -> (${v},${h}), roomLeft=${c}, roomTop=${y}, cellSize=${l}`);const g=Math.max(0,Math.min(r-1,v)),T=Math.max(0,Math.min(a-1,h)),E=Math.max(0,Math.min(r-1,b)),k=Math.max(0,Math.min(a-1,x));console.log(`${this.constructor.name} BFS inputs: start=(${g},${T}), end=(${E},${k})`),console.log(`${this.constructor.name} BFS: Entity position (${this.Position.x},${this.Position.y}) -> grid (${g},${T})`);const D=[];for(let A=0;A<a;A++){D[A]=[];for(let u=0;u<r;u++)D[A][u]=0}for(let A=0;A<2;A++)for(let u=0;u<r;u++)D[A][u]=-1;for(let A=a-2;A<a;A++)for(let u=0;u<r;u++)D[A][u]=-1;for(let A=0;A<a;A++)for(let u=0;u<2;u++)D[A][u]=-1;for(let A=0;A<a;A++)for(let u=r-2;u<r;u++)D[A][u]=-1;const _=s.GetEntities();let P=0;if(_.forEach(A=>{if(A!==this&&A instanceof ye){const u=A.GetCollisionClass();if(u===te.SOLID||u===te.OBJECT||u===te.WALL){P++;const I=Math.floor((A.Position.x-c)/l),U=Math.floor((A.Position.y-y)/l);I>=0&&I<r&&U>=0&&U<a&&(D[U][I]=-1,console.log(`${this.constructor.name} BFS: Marked obstacle at grid (${I},${U}) for entity at (${A.Position.x},${A.Position.y})`))}}}),console.log(`${this.constructor.name} Marked ${P} obstacles in BFS grid`),console.log(`${this.constructor.name} BFS: Start point (${g},${T}) has value ${D[T][g]}`),D[T][g]===-1)return console.log(`${this.constructor.name} BFS: Start point is on obstacle - entity at (${this.Position.x},${this.Position.y}) maps to grid (${g},${T})`),[];if(D[k][E]===-1)return console.log(`${this.constructor.name} BFS: End point (${E},${k}) is on obstacle - target at (${i.x},${i.y})`),[];const G=[];for(let A=0;A<a;A++){G[A]=[];for(let u=0;u<r;u++)G[A][u]=-1}const O=[];O.push([E,k,0]),G[k][E]=0;const L=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];for(;O.length>0;){const[A,u,R]=O.shift();for(const[I,U]of L){const F=A+I,W=u+U;F<0||F>=r||W<0||W>=a||G[W][F]!==-1||D[W][F]===-1||(G[W][F]=R+1,O.push([F,W,R+1]))}}return G[T][g]===-1?(console.log(`${this.constructor.name} BFS: No path found`),[]):(this.bfsDistanceGrid=G,this.bfsGridWidth=r,this.bfsGridHeight=a,this.bfsCellSize=l,this.bfsRoomLeft=c,this.bfsRoomTop=y,console.log(`${this.constructor.name} BFS distance field created successfully`),[])}catch(s){return console.log(`${this.constructor.name} BFS error:`,s),this.findSimplePath(i)}}findSimplePath(i){if(Ge(this.Position,i,this.CollisionRadius,this))return[i];const t=[0,45,90,135,180,225,270,315],s=[30,50,70];for(const r of s)for(const a of t){const l=new $.Vector(Math.cos(a*Math.PI/180),Math.sin(a*Math.PI/180)),c=this.Position.clone().add(l.scale(r));if(Ge(this.Position,c,this.CollisionRadius,this)&&Ge(c,i,this.CollisionRadius,this))return[c,i]}return[i]}validateAStarPath(i){var s;const t=(s=he.GetLevel())==null?void 0:s.GetRoom();if(!t)return[];for(let r=0;r<i.length;r++){const a=i[r],l=t.GetEntities();for(const c of l)if(c instanceof ye){const y=c.GetCollisionClass();if((y===te.SOLID||y===te.OBJECT||y===te.WALL)&&Math.sqrt((a.x-c.Position.x)**2+(a.y-c.Position.y)**2)<5)return[]}}return i}drawAStarPath(i,t){if(!(i.length<2)){C.context.strokeStyle=t,C.context.lineWidth=3,C.context.beginPath(),C.context.moveTo(i[0].x,i[0].y);for(let s=1;s<i.length;s++)C.context.lineTo(i[s].x,i[s].y);C.context.stroke(),C.context.lineWidth=1}}DrawLineOfSight(i,t){const s=new $.Box(this.Position,t,this.DistanceTo(i)),r=this.TargetDirection(i),a=Math.atan2(r.x,r.y),l=s.toPolygon();l.rotate(-a),this.LineOfSight(i,t)?C.context.strokeStyle="yellow":C.context.strokeStyle="red",C.context.beginPath(),C.context.moveTo(this.Position.x,this.Position.y),l.points.forEach(c=>{C.context.lineTo(this.Position.x+c.x,this.Position.y+c.y)}),C.context.lineTo(this.Position.x,this.Position.y),C.context.stroke()}LineOfSight(i,t){return Ge(this.Position,i,t||1,this)}Collision(i,t){if(super.Collision(i,t),t&&i instanceof tt){const s=this.Position.clone().sub(i.Position),r=Math.sqrt(s.x*s.x+s.y*s.y),a=i.CollisionRadius||8;if(r<this.CollisionRadius+a){if(r>0)s.x=s.x/r,s.y=s.y/r;else{s.x=Math.random()-.5,s.y=Math.random()-.5;const v=Math.sqrt(s.x*s.x+s.y*s.y);s.x=s.x/v,s.y=s.y/v}const y=this.CollisionRadius+a-r;if(y>0){const v=s.clone().scale(y);this.Position.add(v)}}}else if(t&&i instanceof ye&&!this.hasTrait("flying")){const s=i.GetCollisionClass();if(s===te.SOLID||s===te.OBJECT||s===te.WALL){const r=Math.sqrt((this.Position.x-i.Position.x)**2+(this.Position.y-i.Position.y)**2),a=i.CollisionRadius||12,l=this.CollisionRadius+a+2;if(r<l){const c=this.Position.clone().sub(i.Position);if(c.x!==0||c.y!==0){const y=Math.sqrt(c.x**2+c.y**2);c.x=c.x/y,c.y=c.y/y;const v=c.clone().scale(l-r);this.Position.add(v)}}}}}}class ui extends Me{Update(e){super.Update(e),this.Hitbox&&(this.Hitbox.pos=this.Position)}}class fi extends Me{Update(e){super.Update(e),this.Hitbox&&(this.Hitbox.pos=this.Position)}}class ye extends Me{constructor(i){super(i);m(this,"GridCollisionClass",te.OBJECT);m(this,"GridEntityType");m(this,"Variant",0);this.SetBaseMass(1e3)}Collision(i,t){if(i instanceof ye)return;const s=this.Position.clone();super.Collision(i,t),this.Position=s}Destroy(i){return!1}GetCollisionClass(){return this.GridCollisionClass}GetGridIndex(){return 0}GetType(){return this.GridEntityType}GetVariant(){return this.Variant}Hurt(i){return!1}Render(){super.Render()}SetGridCollisionClass(i){return this.GridCollisionClass=i,this}SetType(i){return this.GridEntityType=i,this}SetVariant(i){return this.Variant=i,this}Update(i){super.Update(i)}}class pt{constructor(){m(this,"entities",[])}BeforeEnter(){}Enter(){}Exit(){}Update(e){}Render(){}TransitionIn(e,i){return!1}TransitionOut(e,i){return!1}}var Je={},ne={},Gt={exports:{}};(function(f){var e;function i(n,o){return n.b===o.b&&n.a===o.a}function t(n,o){return n.b<o.b||n.b===o.b&&n.a<=o.a}function s(n,o,d){var p=o.b-n.b,w=d.b-o.b;return 0<p+w?p<w?o.a-n.a+p/(p+w)*(n.a-d.a):o.a-d.a+w/(p+w)*(d.a-n.a):0}function r(n,o,d){var p=o.b-n.b,w=d.b-o.b;return 0<p+w?(o.a-d.a)*p+(o.a-n.a)*w:0}function a(n,o){return n.a<o.a||n.a===o.a&&n.b<=o.b}function l(n,o,d){var p=o.a-n.a,w=d.a-o.a;return 0<p+w?p<w?o.b-n.b+p/(p+w)*(n.b-d.b):o.b-d.b+w/(p+w)*(d.b-n.b):0}function c(n,o,d){var p=o.a-n.a,w=d.a-o.a;return 0<p+w?(o.b-d.b)*p+(o.b-n.b)*w:0}function y(n){return t(n.b.a,n.a)}function v(n){return t(n.a,n.b.a)}function h(n,o,d,p){return n=0>n?0:n,d=0>d?0:d,n<=d?d===0?(o+p)/2:o+n/(n+d)*(p-o):p+d/(n+d)*(o-p)}function b(n){var o=k(n.b);return _(o,n.c),_(o.b,n.c),P(o,n.a),o}function x(n,o){var d=!1,p=!1;n!==o&&(o.a!==n.a&&(p=!0,O(o.a,n.a)),o.d!==n.d&&(d=!0,L(o.d,n.d)),D(o,n),p||(_(o,n.a),n.a.c=n),d||(P(o,n.d),n.d.a=n))}function g(n){var o=n.b,d=!1;n.d!==n.b.d&&(d=!0,L(n.d,n.b.d)),n.c===n?O(n.a,null):(n.b.d.a=ue(n),n.a.c=n.c,D(n,ue(n)),d||P(n,n.d)),o.c===o?(O(o.a,null),L(o.d,null)):(n.d.a=ue(o),o.a.c=o.c,D(o,ue(o))),G(n)}function T(n){var o=k(n),d=o.b;return D(o,n.e),o.a=n.b.a,_(d,o.a),o.d=d.d=n.d,o=o.b,D(n.b,ue(n.b)),D(n.b,o),n.b.a=o.a,o.b.a.c=o.b,o.b.d=n.b.d,o.f=n.f,o.b.f=n.b.f,o}function E(n,o){var d=!1,p=k(n),w=p.b;return o.d!==n.d&&(d=!0,L(o.d,n.d)),D(p,n.e),D(w,o),p.a=n.b.a,w.a=o.a,p.d=w.d=n.d,n.d.a=w,d||P(p,n.d),p}function k(n){var o=new Ze,d=new Ze,p=n.b.h;return d.h=p,p.b.h=o,o.h=n,n.b.h=d,o.b=d,o.c=o,o.e=d,d.b=o,d.c=d,d.e=o}function D(n,o){var d=n.c,p=o.c;d.b.e=o,p.b.e=n,n.c=p,o.c=d}function _(n,o){var d=o.f,p=new it(o,d);d.e=p,o.f=p,d=p.c=n;do d.a=p,d=d.c;while(d!==n)}function P(n,o){var d=o.d,p=new xt(o,d);d.b=p,o.d=p,p.a=n,p.c=o.c,d=n;do d.d=p,d=d.e;while(d!==n)}function G(n){var o=n.h;n=n.b.h,o.b.h=n,n.b.h=o}function O(n,o){var d=n.c,p=d;do p.a=o,p=p.c;while(p!==d);d=n.f,p=n.e,p.f=d,d.e=p}function L(n,o){var d=n.a,p=d;do p.d=o,p=p.e;while(p!==d);d=n.d,p=n.b,p.d=d,d.b=p}function A(n){var o=0;return Math.abs(n[1])>Math.abs(n[0])&&(o=1),Math.abs(n[2])>Math.abs(n[o])&&(o=2),o}var u=4*1e150;function R(n,o){n.f+=o.f,n.b.f+=o.b.f}function I(n,o,d){return n=n.a,o=o.a,d=d.a,o.b.a===n?d.b.a===n?t(o.a,d.a)?0>=r(d.b.a,o.a,d.a):0<=r(o.b.a,d.a,o.a):0>=r(d.b.a,n,d.a):d.b.a===n?0<=r(o.b.a,n,o.a):(o=s(o.b.a,n,o.a),n=s(d.b.a,n,d.a),o>=n)}function U(n){n.a.i=null;var o=n.e;o.a.c=o.c,o.c.a=o.a,n.e=null}function F(n,o){g(n.a),n.c=!1,n.a=o,o.i=n}function W(n){var o=n.a.a;do n=Re(n);while(n.a.a===o);return n.c&&(o=E(me(n).a.b,n.a.e),F(n,o),n=Re(n)),n}function B(n,o,d){var p=new st;return p.a=d,p.e=Ye(n.f,o.e,p),d.i=p}function V(n,o){switch(n.s){case 100130:return(o&1)!==0;case 100131:return o!==0;case 100132:return 0<o;case 100133:return 0>o;case 100134:return 2<=o||-2>=o}return!1}function X(n){var o=n.a,d=o.d;d.c=n.d,d.a=o,U(n)}function z(n,o,d){for(n=o,o=o.a;n!==d;){n.c=!1;var p=me(n),w=p.a;if(w.a!==o.a){if(!p.c){X(n);break}w=E(o.c.b,w.b),F(p,w)}o.c!==w&&(x(ue(w),w),x(o,w)),X(n),o=p.a,n=p}return o}function ee(n,o,d,p,w,M){var N=!0;do B(n,o,d.b),d=d.c;while(d!==p);for(w===null&&(w=me(o).a.b.c);p=me(o),d=p.a.b,d.a===w.a;)d.c!==w&&(x(ue(d),d),x(ue(w),d)),p.f=o.f-d.f,p.d=V(n,p.f),o.b=!0,!N&&Ce(n,o)&&(R(d,w),U(o),g(w)),N=!1,o=p,w=d;o.b=!0,M&&Oe(n,o)}function ae(n,o,d,p,w){var M=[o.g[0],o.g[1],o.g[2]];o.d=null,o.d=n.o&&n.o(M,d,p,n.c)||null,o.d===null&&(w?n.n||(De(n,100156),n.n=!0):o.d=d[0])}function be(n,o,d){var p=[null,null,null,null];p[0]=o.a.d,p[1]=d.a.d,ae(n,o.a,p,[.5,.5,0,0],!1),x(o,d)}function Ee(n,o,d,p,w){var M=Math.abs(o.b-n.b)+Math.abs(o.a-n.a),N=Math.abs(d.b-n.b)+Math.abs(d.a-n.a),H=w+1;p[w]=.5*N/(M+N),p[H]=.5*M/(M+N),n.g[0]+=p[w]*o.g[0]+p[H]*d.g[0],n.g[1]+=p[w]*o.g[1]+p[H]*d.g[1],n.g[2]+=p[w]*o.g[2]+p[H]*d.g[2]}function Ce(n,o){var d=me(o),p=o.a,w=d.a;if(t(p.a,w.a)){if(0<r(w.b.a,p.a,w.a))return!1;if(!i(p.a,w.a))T(w.b),x(p,ue(w)),o.b=d.b=!0;else if(p.a!==w.a){var d=n.e,M=p.a.h;if(0<=M){var d=d.b,N=d.d,H=d.e,Y=d.c,J=Y[M];N[J]=N[d.a],Y[N[J]]=J,J<=--d.a&&(1>=J||t(H[N[J>>1]],H[N[J]])?Qe(d,J):It(d,J)),H[M]=null,Y[M]=d.b,d.b=M}else for(d.c[-(M+1)]=null;0<d.a&&d.c[d.d[d.a-1]]===null;)--d.a;be(n,ue(w),p)}}else{if(0>r(p.b.a,w.a,p.a))return!1;Re(o).b=o.b=!0,T(p.b),x(ue(w),p)}return!0}function Ae(n,o){var d=me(o),p=o.a,w=d.a,M=p.a,N=w.a,H=p.b.a,Y=w.b.a,J=new it;if(r(H,n.a,M),r(Y,n.a,N),M===N||Math.min(M.a,H.a)>Math.max(N.a,Y.a))return!1;if(t(M,N)){if(0<r(Y,M,N))return!1}else if(0>r(H,N,M))return!1;var de=H,se=M,re=Y,pe=N,Z,fe;if(t(de,se)||(Z=de,de=se,se=Z),t(re,pe)||(Z=re,re=pe,pe=Z),t(de,re)||(Z=de,de=re,re=Z,Z=se,se=pe,pe=Z),t(re,se)?t(se,pe)?(Z=s(de,re,se),fe=s(re,se,pe),0>Z+fe&&(Z=-Z,fe=-fe),J.b=h(Z,re.b,fe,se.b)):(Z=r(de,re,se),fe=-r(de,pe,se),0>Z+fe&&(Z=-Z,fe=-fe),J.b=h(Z,re.b,fe,pe.b)):J.b=(re.b+se.b)/2,a(de,se)||(Z=de,de=se,se=Z),a(re,pe)||(Z=re,re=pe,pe=Z),a(de,re)||(Z=de,de=re,re=Z,Z=se,se=pe,pe=Z),a(re,se)?a(se,pe)?(Z=l(de,re,se),fe=l(re,se,pe),0>Z+fe&&(Z=-Z,fe=-fe),J.a=h(Z,re.a,fe,se.a)):(Z=c(de,re,se),fe=-c(de,pe,se),0>Z+fe&&(Z=-Z,fe=-fe),J.a=h(Z,re.a,fe,pe.a)):J.a=(re.a+se.a)/2,t(J,n.a)&&(J.b=n.a.b,J.a=n.a.a),de=t(M,N)?M:N,t(de,J)&&(J.b=de.b,J.a=de.a),i(J,M)||i(J,N))return Ce(n,o),!1;if(!i(H,n.a)&&0<=r(H,n.a,J)||!i(Y,n.a)&&0>=r(Y,n.a,J)){if(Y===n.a)return T(p.b),x(w.b,p),o=W(o),p=me(o).a,z(n,me(o),d),ee(n,o,ue(p),p,p,!0),!0;if(H===n.a){T(w.b),x(p.e,ue(w)),M=d=o,N=M.a.b.a;do M=Re(M);while(M.a.b.a===N);return o=M,M=me(o).a.b.c,d.a=ue(w),w=z(n,d,null),ee(n,o,w.c,p.b.c,M,!0),!0}return 0<=r(H,n.a,J)&&(Re(o).b=o.b=!0,T(p.b),p.a.b=n.a.b,p.a.a=n.a.a),0>=r(Y,n.a,J)&&(o.b=d.b=!0,T(w.b),w.a.b=n.a.b,w.a.a=n.a.a),!1}return T(p.b),T(w.b),x(ue(w),p),p.a.b=J.b,p.a.a=J.a,p.a.h=St(n.e,p.a),p=p.a,w=[0,0,0,0],J=[M.d,H.d,N.d,Y.d],p.g[0]=p.g[1]=p.g[2]=0,Ee(p,M,H,w,0),Ee(p,N,Y,w,2),ae(n,p,J,w,!0),Re(o).b=o.b=d.b=!0,!1}function Oe(n,o){for(var d=me(o);;){for(;d.b;)o=d,d=me(d);if(!o.b&&(d=o,o=Re(o),o===null||!o.b))break;o.b=!1;var p=o.a,w=d.a,M;if(M=p.b.a!==w.b.a)e:{M=o;var N=me(M),H=M.a,Y=N.a,J=void 0;if(t(H.b.a,Y.b.a)){if(0>r(H.b.a,Y.b.a,H.a)){M=!1;break e}Re(M).b=M.b=!0,J=T(H),x(Y.b,J),J.d.c=M.d}else{if(0<r(Y.b.a,H.b.a,Y.a)){M=!1;break e}M.b=N.b=!0,J=T(Y),x(H.e,Y.b),J.b.d.c=M.d}M=!0}if(M&&(d.c?(U(d),g(w),d=me(o),w=d.a):o.c&&(U(o),g(p),o=Re(d),p=o.a)),p.a!==w.a){if(p.b.a===w.b.a||o.c||d.c||p.b.a!==n.a&&w.b.a!==n.a)Ce(n,o);else if(Ae(n,o))break}p.a===w.a&&p.b.a===w.b.a&&(R(w,p),U(o),g(p),o=Re(d))}}function xe(n,o){n.a=o;for(var d=o.c;d.i===null;)if(d=d.c,d===o.c){var d=n,p=o,N=new st;N.a=p.c.b;var w=d.f,H=w.a;do H=H.a;while(H.b!==null&&!w.c(w.b,N,H.b));var w=H.b,M=me(w),N=w.a,H=M.a;if(r(N.b.a,p,N.a)===0)N=w.a,i(N.a,p)||i(N.b.a,p)||(T(N.b),w.c&&(g(N.c),w.c=!1),x(p.c,N),xe(d,p));else{var Y=t(H.b.a,N.b.a)?w:M,M=void 0;w.d||Y.c?(Y===w?M=E(p.c.b,N.e):M=E(H.b.c.b,p.c).b,Y.c?F(Y,M):(N=d,w=B(d,w,M),w.f=Re(w).f+w.a.f,w.d=V(N,w.f)),xe(d,p)):ee(d,w,p.c,p.c,null,!0)}return}if(d=W(d.i),N=me(d),w=N.a,N=z(n,N,null),N.c===w){var w=N,N=w.c,H=me(d),M=d.a,Y=H.a,J=!1;M.b.a!==Y.b.a&&Ae(n,d),i(M.a,n.a)&&(x(ue(N),M),d=W(d),N=me(d).a,z(n,me(d),H),J=!0),i(Y.a,n.a)&&(x(w,ue(Y)),w=z(n,H,null),J=!0),J?ee(n,d,w.c,N,N,!0):(t(Y.a,M.a)?p=ue(Y):p=M,p=E(w.c.b,p),ee(n,d,p,p.c,p.c,!1),p.b.i.c=!0,Oe(n,d))}else ee(n,d,N.c,w,w,!0)}function ke(n,o){var d=new st,p=b(n.b);p.a.b=u,p.a.a=o,p.b.a.b=-u,p.b.a.a=o,n.a=p.b.a,d.a=p,d.f=0,d.d=!1,d.c=!1,d.h=!0,d.b=!1,p=n.f,p=Ye(p,p.a,d),d.e=p}function He(n){this.a=new ze,this.b=n,this.c=I}function Ye(n,o,d){do o=o.c;while(o.b!==null&&!n.c(n.b,o.b,d));return n=new ze(d,o.a,o),o.a.c=n,o.a=n}function ze(n,o,d){this.b=n||null,this.a=o||this,this.c=d||this}function oe(){this.d=Ne,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}var Ne=0;e=oe.prototype,e.x=function(){Te(this,Ne)},e.B=function(n,o){switch(n){case 100142:return;case 100140:switch(o){case 100130:case 100131:case 100132:case 100133:case 100134:this.s=o;return}break;case 100141:this.m=!!o;return;default:De(this,100900);return}De(this,100901)},e.y=function(n){switch(n){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:De(this,100900)}return!1},e.A=function(n,o,d){this.j[0]=n,this.j[1]=o,this.j[2]=d},e.z=function(n,o){var d=o||null;switch(n){case 100100:case 100106:this.h=d;break;case 100104:case 100110:this.l=d;break;case 100101:case 100107:this.k=d;break;case 100102:case 100108:this.i=d;break;case 100103:case 100109:this.p=d;break;case 100105:case 100111:this.o=d;break;case 100112:this.r=d;break;default:De(this,100900)}},e.C=function(n,o){var d=!1,p=[0,0,0];Te(this,2);for(var w=0;3>w;++w){var M=n[w];-1e150>M&&(M=-1e150,d=!0),1e150<M&&(M=1e150,d=!0),p[w]=M}d&&De(this,100155),d=this.q,d===null?(d=b(this.b),x(d,d.b)):(T(d),d=d.e),d.a.d=o,d.a.g[0]=p[0],d.a.g[1]=p[1],d.a.g[2]=p[2],d.f=1,d.b.f=-1,this.q=d},e.u=function(n){Te(this,Ne),this.d=1,this.b=new Xt,this.c=n},e.t=function(){Te(this,1),this.d=2,this.q=null},e.v=function(){Te(this,2),this.d=1},e.w=function(){Te(this,1),this.d=Ne;var n=this.j[0],o=this.j[1],d=this.j[2],p=!1,w=[n,o,d];if(n===0&&o===0&&d===0){for(var o=[-2*1e150,-2*1e150,-2*1e150],M=[2*1e150,2*1e150,2*1e150],d=[],N=[],p=this.b.c,n=p.e;n!==p;n=n.e)for(var H=0;3>H;++H){var Y=n.g[H];Y<M[H]&&(M[H]=Y,N[H]=n),Y>o[H]&&(o[H]=Y,d[H]=n)}if(n=0,o[1]-M[1]>o[0]-M[0]&&(n=1),o[2]-M[2]>o[n]-M[n]&&(n=2),M[n]>=o[n])w[0]=0,w[1]=0,w[2]=1;else{for(o=0,M=N[n],d=d[n],N=[0,0,0],M=[M.g[0]-d.g[0],M.g[1]-d.g[1],M.g[2]-d.g[2]],H=[0,0,0],n=p.e;n!==p;n=n.e)H[0]=n.g[0]-d.g[0],H[1]=n.g[1]-d.g[1],H[2]=n.g[2]-d.g[2],N[0]=M[1]*H[2]-M[2]*H[1],N[1]=M[2]*H[0]-M[0]*H[2],N[2]=M[0]*H[1]-M[1]*H[0],Y=N[0]*N[0]+N[1]*N[1]+N[2]*N[2],Y>o&&(o=Y,w[0]=N[0],w[1]=N[1],w[2]=N[2]);0>=o&&(w[0]=w[1]=w[2]=0,w[A(M)]=1)}p=!0}for(N=A(w),n=this.b.c,o=(N+1)%3,d=(N+2)%3,N=0<w[N]?1:-1,w=n.e;w!==n;w=w.e)w.b=w.g[o],w.a=N*w.g[d];if(p){for(w=0,p=this.b.a,n=p.b;n!==p;n=n.b)if(o=n.a,!(0>=o.f))do w+=(o.a.b-o.b.a.b)*(o.a.a+o.b.a.a),o=o.e;while(o!==n.a);if(0>w)for(w=this.b.c,p=w.e;p!==w;p=p.e)p.a=-p.a}for(this.n=!1,w=this.b.b,n=w.h;n!==w;n=p)p=n.h,o=n.e,i(n.a,n.b.a)&&n.e.e!==n&&(be(this,o,n),g(n),n=o,o=n.e),o.e===n&&(o!==n&&((o===p||o===p.b)&&(p=p.h),g(o)),(n===p||n===p.b)&&(p=p.h),g(n));for(this.e=w=new jt,p=this.b.c,n=p.e;n!==p;n=n.e)n.h=St(w,n);for(Jt(w),this.f=new He(this),ke(this,-u),ke(this,u);(w=Et(this.e))!==null;){for(;;){e:if(n=this.e,n.a===0)p=at(n.b);else if(p=n.c[n.d[n.a-1]],n.b.a!==0&&(n=at(n.b),t(n,p))){p=n;break e}if(p===null||!i(p,w))break;p=Et(this.e),be(this,w.c,p.c)}xe(this,w)}for(this.a=this.f.a.a.b.a.a,w=0;(p=this.f.a.a.b)!==null;)p.h||++w,U(p);for(this.f=null,w=this.e,w.b=null,w.d=null,this.e=w.c=null,w=this.b,n=w.a.b;n!==w.a;n=p)p=n.b,n=n.a,n.e.e===n&&(R(n.c,n),g(n));if(!this.n){if(w=this.b,this.m)for(n=w.b.h;n!==w.b;n=p)p=n.h,n.b.d.c!==n.d.c?n.f=n.d.c?1:-1:g(n);else for(n=w.a.b;n!==w.a;n=p)if(p=n.b,n.c){for(n=n.a;t(n.b.a,n.a);n=n.c.b);for(;t(n.a,n.b.a);n=n.e);for(o=n.c.b,d=void 0;n.e!==o;)if(t(n.b.a,o.a)){for(;o.e!==n&&(y(o.e)||0>=r(o.a,o.b.a,o.e.b.a));)d=E(o.e,o),o=d.b;o=o.c.b}else{for(;o.e!==n&&(v(n.c.b)||0<=r(n.b.a,n.a,n.c.b.a));)d=E(n,n.c.b),n=d.b;n=n.e}for(;o.e.e!==n;)d=E(o.e,o),o=d.b}if(this.h||this.i||this.k||this.l)if(this.m){for(w=this.b,p=w.a.b;p!==w.a;p=p.b)if(p.c){this.h&&this.h(2,this.c),n=p.a;do this.k&&this.k(n.a.d,this.c),n=n.e;while(n!==p.a);this.i&&this.i(this.c)}}else{for(w=this.b,p=!!this.l,n=!1,o=-1,d=w.a.d;d!==w.a;d=d.d)if(d.c){n||(this.h&&this.h(4,this.c),n=!0),N=d.a;do p&&(M=N.b.d.c?0:1,o!==M&&(o=M,this.l&&this.l(!!o,this.c))),this.k&&this.k(N.a.d,this.c),N=N.e;while(N!==d.a)}n&&this.i&&this.i(this.c)}if(this.r){for(w=this.b,n=w.a.b;n!==w.a;n=p)if(p=n.b,!n.c){o=n.a,d=o.e,N=void 0;do N=d,d=N.e,N.d=null,N.b.d===null&&(N.c===N?O(N.a,null):(N.a.c=N.c,D(N,ue(N))),M=N.b,M.c===M?O(M.a,null):(M.a.c=M.c,D(M,ue(M))),G(N));while(N!==o);o=n.d,n=n.b,n.d=o,o.b=n}this.r(this.b),this.c=this.b=null;return}}this.b=this.c=null};function Te(n,o){if(n.d!==o)for(;n.d!==o;)if(n.d<o)switch(n.d){case Ne:De(n,100151),n.u(null);break;case 1:De(n,100152),n.t()}else switch(n.d){case 2:De(n,100154),n.v();break;case 1:De(n,100153),n.w()}}function De(n,o){n.p&&n.p(o,n.c)}function xt(n,o){this.b=n||this,this.d=o||this,this.a=null,this.c=!1}function Ze(){this.h=this,this.i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function ue(n){return n.b.e}function Xt(){this.c=new it,this.a=new xt,this.b=new Ze,this.d=new Ze,this.b.b=this.d,this.d.b=this.b}function it(n,o){this.e=n||this,this.f=o||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function jt(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new Zt}function Jt(n){n.d=[];for(var o=0;o<n.a;o++)n.d[o]=o;n.d.sort(function(d){return function(p,w){return t(d[p],d[w])?1:-1}}(n.c)),n.e=!0,Qt(n.b)}function St(n,o){if(n.e){var d=n.b,p=++d.a;2*p>d.f&&(d.f*=2,d.c=wt(d.c,d.f+1));var w;return d.b===0?w=p:(w=d.b,d.b=d.c[d.b]),d.e[w]=o,d.c[w]=p,d.d[p]=w,d.h&&It(d,p),w}return d=n.a++,n.c[d]=o,-(d+1)}function Et(n){if(n.a===0)return Tt(n.b);var o=n.c[n.d[n.a-1]];if(n.b.a!==0&&t(at(n.b),o))return Tt(n.b);do--n.a;while(0<n.a&&n.c[n.d[n.a-1]]===null);return o}function Zt(){this.d=wt([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function wt(n,o){for(var d=Array(o),p=0;p<n.length;p++)d[p]=n[p];for(;p<o;p++)d[p]=0;return d}function Qt(n){for(var o=n.a;1<=o;--o)Qe(n,o);n.h=!0}function at(n){return n.e[n.d[1]]}function Tt(n){var o=n.d,d=n.e,p=n.c,w=o[1],M=d[w];return 0<n.a&&(o[1]=o[n.a],p[o[1]]=1,d[w]=null,p[w]=n.b,n.b=w,0<--n.a&&Qe(n,1)),M}function Qe(n,o){for(var d=n.d,p=n.e,w=n.c,M=o,N=d[M];;){var H=M<<1;H<n.a&&t(p[d[H+1]],p[d[H]])&&(H+=1);var Y=d[H];if(H>n.a||t(p[N],p[Y])){d[M]=N,w[N]=M;break}d[M]=Y,w[Y]=M,M=H}}function It(n,o){for(var d=n.d,p=n.e,w=n.c,M=o,N=d[M];;){var H=M>>1,Y=d[H];if(H===0||t(p[Y],p[N])){d[M]=N,w[N]=M;break}d[M]=Y,w[Y]=M,M=H}}function st(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function me(n){return n.e.c.b}function Re(n){return n.e.a.b}rt.libtess={GluTesselator:oe,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},oe.prototype.gluDeleteTess=oe.prototype.x,oe.prototype.gluTessProperty=oe.prototype.B,oe.prototype.gluGetTessProperty=oe.prototype.y,oe.prototype.gluTessNormal=oe.prototype.A,oe.prototype.gluTessCallback=oe.prototype.z,oe.prototype.gluTessVertex=oe.prototype.C,oe.prototype.gluTessBeginPolygon=oe.prototype.u,oe.prototype.gluTessBeginContour=oe.prototype.t,oe.prototype.gluTessEndContour=oe.prototype.v,oe.prototype.gluTessEndPolygon=oe.prototype.w,f.exports=rt.libtess})(Gt);var mi=Gt.exports,ce={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.cross=pi;Ue.length=kt;Ue.dot=gi;Ue.normalize=vi;Ue.add=yi;Ue.subtract=Dt;function pi(f,e){return f=f.length===2?[f[0],f[1],0]:f,e=e.length===2?[e[0],e[1],0]:e,[f[1]*e[2]-f[2]*e[1],f[2]*e[0]-f[0]*e[2],f[0]*e[1]-f[1]*e[0]]}function kt(f){return Math.sqrt(f.slice(0,3).reduce(function(e,i,t){return e+i*i},0))}function gi(f,e){return f.reduce(function(i,t,s){return i+t*e[s]},0)}function vi(f){var e=kt(f);return f.slice(0,3).map(function(i){return i/e})}function yi(f,e){return f.slice(0,3).map(function(i,t){return i+e[t]})}function Dt(f,e){return f.slice(0,3).map(function(i,t){return i-e[t]})}Ue.sub=Dt;var Lt;function Ot(){if(Lt)return ce;Lt=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.WINDING_CW=ce.WINDING_CCW=ce.WINDING_UNKNOWN=void 0;var f=function(){function L(A,u){var R=[],I=!0,U=!1,F=void 0;try{for(var W=A[Symbol.iterator](),B;!(I=(B=W.next()).done)&&(R.push(B.value),!(u&&R.length===u));I=!0);}catch(V){U=!0,F=V}finally{try{!I&&W.return&&W.return()}finally{if(U)throw F}}return R}return function(A,u){if(Array.isArray(A))return A;if(Symbol.iterator in Object(A))return L(A,u);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();ce.ccw=y,ce.normal=v,ce.area=h,ce.centroid=b,ce.is_ccw=x,ce.is_cw=g,ce.winding=T,ce.bounds=E,ce.ensure_cw=k,ce.ensure_ccw=D,ce.triangulate=_,ce.subtract=P,ce.union=G,ce.intersection=O;var e=Mt(),i=r(e),t=Ue,s=r(t);function r(L){if(L&&L.__esModule)return L;var A={};if(L!=null)for(var u in L)Object.prototype.hasOwnProperty.call(L,u)&&(A[u]=L[u]);return A.default=L,A}var a=ce.WINDING_UNKNOWN=0,l=ce.WINDING_CCW=1,c=ce.WINDING_CW=2;function y(L,A,u){return(A[0]-L[0])*(u[1]-L[1])-(u[0]-L[0])*(A[1]-L[1])}function v(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(L.length<3)return null;var u=L.map(function(z){return z.length>=3?z:[z[0],z[1],0]});if(!A){var R=f(u,3),I=R[0],U=R[1],F=R[2],W=s.subtract(U,I),B=s.subtract(F,I),V=s.normalize(s.cross(W,B));if(V.some(function(z){return isNaN(z)})){if(L.length===3)return null}else return V}var X=[0,0,0];return u.forEach(function(z,ee){var ae=u[(ee+1)%L.length];X[0]=X[0]+(z[1]-ae[1])*(z[2]+ae[2]),X[1]=X[1]+(z[2]-ae[2])*(z[0]+ae[0]),X[2]=X[2]+(z[0]-ae[0])*(z[1]+ae[1])}),X=s.normalize(X),X.some(function(z){return isNaN(z)})?null:X}function h(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(L.length<3)return 0;if(L[0].length<3)return L.reduce(function(B,V,X){var z=L[X+1]||L[0];return B+V[0]*z[1]-z[0]*V[1]},0)/2;var u=L.length,R=A||v(L),I=[0,0,0];if(!R)return 0;for(var U=0;U<u;++U){var F=L[U],W=L[(U+1)%u];I=s.add(I,s.cross(F,W))}return s.dot(I,R)/2}function b(L){var A=L.reduce(function(F,W,B){var V=f(F,2),X=V[0],z=V[1],ee=L[B+1]||L[0],ae=W[0]*ee[1]-ee[0]*W[1];return[X+(W[0]+ee[0])*ae,z+(W[1]+ee[1])*ae]},[0,0]),u=f(A,2),R=u[0],I=u[1],U=h(L);return R!==0&&(R=R/(Math.abs(U)*6)),I!==0&&(I=I/(Math.abs(U)*6)),U<0&&(R=-R,I=-I),[R,I]}function x(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return h(L,A)>0}function g(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return h(L,A)<0}function T(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,u=h(L,A);return u<0?c:u>0?l:a}function E(L){var A=[Number.MAX_VALUE,Number.MAX_VALUE],u=[-Number.MAX_VALUE,-Number.MAX_VALUE];return L.forEach(function(R){for(var I=0;I<Math.min(3,R.length);++I)A[I]=Math.min(A[I],R[I]),u[I]=Math.max(u[I],R[I])}),{xMin:A[0],yMin:A[1],xMax:u[0],yMax:u[1]}}function k(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return x(L,A)&&L.reverse(),L}function D(L){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return g(L,A)&&L.reverse(),L}function _(L,A){if(!L||L.length<3)return L;var u=E(L);A=A.filter(function(I){var U=E(I),F=U.xMin>u.xMax||U.yMin>u.yMax||U.xMax<u.xMin||U.yMax<u.yMin;return!F});var R={polygons:[L],holes:A};return i.run(R).reduce(function(I,U){return I.concat(U)},[])}function P(){for(var L=arguments.length,A=Array(L),u=0;u<L;u++)A[u]=arguments[u];var R={polygons:[D(A[0])],holes:A.slice(1).map(function(I){return k(I)}),boundaryOnly:!0,autoWinding:!1};return i.run(R)}function G(){for(var L=arguments.length,A=Array(L),u=0;u<L;u++)A[u]=arguments[u];var R={polygons:A.map(function(I){return D(I)}),boundaryOnly:!0,autoWinding:!1};return i.run(R)}function O(L,A){var u={polygons:[D(L),D(A)],boundaryOnly:!0,windingRule:i.GLU_TESS_WINDING_ABS_GEQ_TWO,autoWinding:!1};return i.run(u)}return ce}var Ct;function Mt(){if(Ct)return ne;Ct=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Tesselator=ne.DEFAULT_OPTIONS=ne.GLU_TESS_WINDING_ABS_GEQ_TWO=ne.GLU_TESS_WINDING_NEGATIVE=ne.GLU_TESS_WINDING_POSITIVE=ne.GLU_TESS_WINDING_NONZERO=ne.GLU_TESS_WINDING_ODD=ne.GL_TRIANGLE_FAN=ne.GL_TRIANGLE_STRIP=ne.GL_TRIANGLES=ne.GL_LINE_LOOP=void 0;var f=function(){function P(G,O){var L=[],A=!0,u=!1,R=void 0;try{for(var I=G[Symbol.iterator](),U;!(A=(U=I.next()).done)&&(L.push(U.value),!(O&&L.length===O));A=!0);}catch(F){u=!0,R=F}finally{try{!A&&I.return&&I.return()}finally{if(u)throw R}}return L}return function(G,O){if(Array.isArray(G))return G;if(Symbol.iterator in Object(G))return P(G,O);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=function(){function P(G,O){for(var L=0;L<O.length;L++){var A=O[L];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(G,A.key,A)}}return function(G,O,L){return O&&P(G.prototype,O),L&&P(G,L),G}}();ne.run=_;var i=mi,t=Ot();function s(P,G){if(!(P instanceof G))throw new TypeError("Cannot call a class as a function")}function r(P,G){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return G&&(typeof G=="object"||typeof G=="function")?G:P}function a(P,G){if(typeof G!="function"&&G!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof G);P.prototype=Object.create(G&&G.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),G&&(Object.setPrototypeOf?Object.setPrototypeOf(P,G):P.__proto__=G)}var l=i.primitiveType.GL_LINE_LOOP,c=i.primitiveType.GL_TRIANGLES,y=i.primitiveType.GL_TRIANGLE_STRIP,v=i.primitiveType.GL_TRIANGLE_FAN;ne.GL_LINE_LOOP=l,ne.GL_TRIANGLES=c,ne.GL_TRIANGLE_STRIP=y,ne.GL_TRIANGLE_FAN=v;var h=i.windingRule.GLU_TESS_WINDING_ODD,b=i.windingRule.GLU_TESS_WINDING_NONZERO,x=i.windingRule.GLU_TESS_WINDING_POSITIVE,g=i.windingRule.GLU_TESS_WINDING_NEGATIVE,T=i.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO;ne.GLU_TESS_WINDING_ODD=h,ne.GLU_TESS_WINDING_NONZERO=b,ne.GLU_TESS_WINDING_POSITIVE=x,ne.GLU_TESS_WINDING_NEGATIVE=g,ne.GLU_TESS_WINDING_ABS_GEQ_TWO=T;var E=ne.DEFAULT_OPTIONS={polygons:[],holes:[],windingRule:x,boundaryOnly:!1,normal:null,autoWinding:!0},k=ne.Tesselator=function(P){a(G,P);function G(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;s(this,G);var L=r(this,(G.__proto__||Object.getPrototypeOf(G)).call(this));return L._vsize=O,L._current=[],L._out=[],L._primitiveType=0,L.gluTessCallback(i.gluEnum.GLU_TESS_VERTEX_DATA,L._vertex),L.gluTessCallback(i.gluEnum.GLU_TESS_BEGIN,L._begin),L.gluTessCallback(i.gluEnum.GLU_TESS_END,L._end),L.gluTessCallback(i.gluEnum.GLU_TESS_ERROR,L._error),L.gluTessCallback(i.gluEnum.GLU_TESS_COMBINE,L._combine),L.gluTessCallback(i.gluEnum.GLU_TESS_EDGE_FLAG,L._edge),L}return e(G,[{key:"start",value:function(L,A){this._current=[],this._out=[],this.gluTessBeginPolygon();var u=!0,R=!1,I=void 0;try{for(var U=L[Symbol.iterator](),F;!(u=(F=U.next()).done);u=!0){var W=F.value;this.gluTessBeginContour();var B=!0,V=!1,X=void 0;try{for(var z=W[Symbol.iterator](),ee;!(B=(ee=z.next()).done);B=!0){var ae=ee.value;this.gluTessVertex(ae,ae)}}catch(Te){V=!0,X=Te}finally{try{!B&&z.return&&z.return()}finally{if(V)throw X}}this.gluTessEndContour()}}catch(Te){R=!0,I=Te}finally{try{!u&&U.return&&U.return()}finally{if(R)throw I}}var be=!0,Ee=!1,Ce=void 0;try{for(var Ae=A[Symbol.iterator](),Oe;!(be=(Oe=Ae.next()).done);be=!0){var xe=Oe.value;this.gluTessBeginContour();var ke=!0,He=!1,Ye=void 0;try{for(var ze=xe[Symbol.iterator](),oe;!(ke=(oe=ze.next()).done);ke=!0){var Ne=oe.value;this.gluTessVertex(Ne,Ne)}}catch(Te){He=!0,Ye=Te}finally{try{!ke&&ze.return&&ze.return()}finally{if(He)throw Ye}}this.gluTessEndContour()}}catch(Te){Ee=!0,Ce=Te}finally{try{!be&&Ae.return&&Ae.return()}finally{if(Ee)throw Ce}}this.gluTessEndPolygon()}},{key:"run",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E,A=Object.assign({},E,L),u=A.polygons,R=A.holes,I=A.autoWinding,U=A.boundaryOnly;if(!u||!u.length)throw new Error("need at least a single polygon");I&&(u=u.filter(function(z){return Math.abs((0,t.area)(z))>0}).map(function(z){return(0,t.is_cw)(z)&&z.reverse(),z}),R=R.filter(function(z){return Math.abs((0,t.area)(z))>0}).map(function(z){return(0,t.is_ccw)(z)&&z.reverse(),z}));var F=A.normal?A.normal:(0,t.normal)(u[0],!0),W=f(F,3),B=W[0],V=W[1],X=W[2];return this.gluTessNormal(B,V,X),this.gluTessProperty(i.gluEnum.GLU_TESS_BOUNDARY_ONLY,U),this.gluTessProperty(i.gluEnum.GLU_TESS_WINDING_RULE,A.windingRule),this.start(u,R),this._out}},{key:"_begin",value:function(L){this._primitiveType=L,this._current=[]}},{key:"_end_fan",value:function(){for(var L=this._current.shift(),A=this._current.shift();this._current.length;){var u=this._current.shift();this._out.push(L,A,u),A=u}}},{key:"_end_strip",value:function(){for(var L=this._current.shift(),A=this._current.shift();this._current.length;){var u=this._current.shift();this._out.push(L,A,u),L=A,A=u}}},{key:"_end",value:function(){switch(this._primitiveType){case v:this._end_fan();break;case y:this._end_strip();break;case c:case l:default:this._out.push(this._current);break}}},{key:"_vertex",value:function(L){this._current.push(L)}},{key:"_edge",value:function(){}},{key:"_error",value:function(L){console.error("error number: "+L)}},{key:"_combine",value:function(L,A,u){for(var R=0;R<4;++R)if(!A[R]){A[R]=new Array(this._vsize);for(var I=0;I<this._vsize;++I)A[R][I]=0}for(var U=new Array(this._vsize),F=0;F<this._vsize;++F)U[F]=A[0][F]*u[0]+A[1][F]*u[1]+A[2][F]*u[2]+A[3][F]*u[3];return U}}]),G}(i.GluTesselator);function D(P){for(var G=[],O=0;O<P.length;O+=3)G.push([P[O],P[O+1],P[O+2]]);return G}function _(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E,G=new k(P.vertexSize),O=G.run(P);return P.boundaryOnly?O:O.map(D)}return ne}var gt;Object.defineProperty(Je,"__esModule",{value:!0});Je.tesselator=gt=Je.polygon=void 0;var bi=Mt(),Ut=_t(bi),xi=Ot(),Nt=_t(xi);function _t(f){if(f&&f.__esModule)return f;var e={};if(f!=null)for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(e[i]=f[i]);return e.default=f,e}gt=Je.polygon=Nt;Je.tesselator=Ut;typeof window<"u"&&(window.PolygonTools={polygon:Nt,tesselator:Ut,version:window.polygon_tools_version||"",build:window.polygon_tools_rev||""});const Si={BackdropMediaName:"LevelBackdrop",Type:mt.DEFAULT,Doors:{},ID:0};class Ei extends pt{constructor(i){super();m(this,"backdrop");m(this,"config");m(this,"gridEntities",[]);m(this,"GridEntityTemplate",[K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,S,S,S,S,S,S,S,S,S,S,S,S,S,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K,K]);m(this,"roomId");m(this,"layoutId");m(this,"WallsReplaced");m(this,"walls",[]);this.config=Object.assign(Si,i),this.roomId=this.config.ID,this.GenerateBackdrop();for(let t=0;t<this.GridEntityTemplate.length;t++)this.GridEntityTemplate[t]!==S&&(this.gridEntities[t]=new this.GridEntityTemplate[t](Wt(t)));this.gridEntities.forEach(t=>{t.Enter()})}get ID(){return this.roomId}get LayoutID(){return this.layoutId??"UNKNOWN"}GenerateBackdrop(){const i=document.createElement("canvas");i.height=C.height,i.width=C.width;const t=i.getContext("2d");t.imageSmoothingEnabled=!1;const s=j.getImage(this.config.BackdropMediaName),r=[{item:new $.Vector(0,0),weight:80},{item:new $.Vector(9*26,0),weight:15},{item:new $.Vector(0,6*26),weight:5}],a=Se(r);t.drawImage(s,a.x,a.y,52,52,0,0,52,52);for(let x=2;x<9;x++){const g=Se(r);t.drawImage(s,g.x+x*26,g.y,26,52,x*26,0,26,52)}for(let x=10;x<16;x++){const g=Se(r);t.save(),t.scale(-1,1),t.drawImage(s,g.x+(17-x)*26,g.y,26,52,x*26*-1,0,26,52),t.restore()}const l=Se(r);t.save(),t.scale(-1,1),t.drawImage(s,l.x,l.y,52,52,17*26*-1,0,52,52),t.restore();for(let x=2;x<6;x++){const g=Se(r);t.drawImage(s,g.x,g.y+x*26,52,26,0,x*26,52,26);const T=Se(r);t.save(),t.scale(-1,1),t.drawImage(s,T.x,T.y+x*26,52,26,17*26*-1,x*26,52,26),t.restore()}for(let x=6;x<10;x++){const g=Se(r);t.save(),t.scale(1,-1),t.drawImage(s,g.x,g.y+(11-x)*26,52,26,0,x*26*-1,52,26),t.restore();const T=Se(r);t.save(),t.scale(-1,-1),t.drawImage(s,T.x,T.y+(11-x)*26,52,26,17*26*-1,x*26*-1,52,26),t.restore()}const c=Se(r);t.save(),t.scale(1,-1),t.drawImage(s,c.x,c.y,52,52,0,11*26*-1,52,52),t.restore();for(let x=2;x<9;x++){const g=Se(r);t.save(),t.scale(1,-1),t.drawImage(s,g.x+x*26,g.y,26,52,x*26,11*26*-1,26,52),t.restore()}for(let x=10;x<16;x++){const g=Se(r);t.save(),t.scale(-1,-1),t.drawImage(s,g.x+(17-x)*26,g.y,26,52,x*26*-1,11*26*-1,26,52),t.restore()}const y=Se(r);t.save(),t.scale(-1,-1),t.drawImage(s,y.x,y.y,52,52,17*26*-1,11*26*-1,52,52),t.restore();const v=[{item:new $.Vector(52,52),weight:100},{item:new $.Vector(286,52),weight:100},{item:new $.Vector(52,208),weight:100},{item:new $.Vector(286,208),weight:100},{item:new $.Vector(52,364),weight:100},{item:new $.Vector(286,364),weight:100}];let h=Se(v);for(let x=0;x<7;x++)for(let g=0;g<4;g++)t.drawImage(s,h.x+x*26,h.y+g*26,26,26,(x+2)*26,(g+2)*26,26,26);h=Se(v);for(let x=7;x<13;x++)for(let g=0;g<4;g++)t.save(),t.scale(-1,1),t.drawImage(s,h.x+(12-x)*26,h.y+g*26,26,26,(x+3)*26*-1,(g+2)*26,26,26),t.restore();h=Se(v);for(let x=0;x<7;x++)for(let g=4;g<8;g++)t.save(),t.scale(1,-1),t.drawImage(s,h.x+x*26,h.y+(7-g)*26,26,26,(x+2)*26,(g+2)*26*-1,26,26),t.restore();h=Se(v);for(let x=7;x<13;x++)for(let g=4;g<8;g++)t.save(),t.scale(-1,-1),t.drawImage(s,h.x+(12-x)*26,h.y+(7-g)*26,26,26,(x+3)*26*-1,(g+2)*26*-1,26,26),t.restore();const b=document.createElement("img");b.src=i.toDataURL(),this.backdrop=b}GetEntities(){return this.gridEntities.concat(this.entities)}GetNonGridEntities(){return this.entities}SetNonGridEntities(i){this.entities=i}AddEntity(i){this.entities.push(i)}RemoveEntity(i){const t=[];this.entities.forEach(s=>{i!==s&&t.push(s)}),this.entities=t}SetGridEntity(i,t){this.gridEntities[i]=t}SetLayoutID(i){this.layoutId=i}Update(i){this.gridEntities.forEach(t=>{t.Update(i)}),this.entities.forEach(t=>{t.Update(i)})}BeforeEnter(){if(this.gridEntities.forEach(i=>{i.Update(0)}),!this.WallsReplaced){let i={};for(let t=0;t<this.GridEntityTemplate.length;t++)if(this.gridEntities[t]instanceof K){let s=!1;for(const r in i)(t%15!==0&&i[r].includes(t-1)||i[r].includes(t-15))&&(i[r].push(t),s=!0);s||(i[Object.keys(i).length]=[t])}i={},this.gridEntities[Xe.UP]instanceof K?i[Object.keys(i).length]=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]:(i[Object.keys(i).length]=[0,1,2,3,4,5,6],i[Object.keys(i).length]=[8,9,10,11,12,13,14]),this.gridEntities[Xe.RIGHT]instanceof K?i[Object.keys(i).length]=[29,44,59,74,89,104,119]:(i[Object.keys(i).length]=[29,44,59],i[Object.keys(i).length]=[89,104,119]),this.gridEntities[Xe.DOWN]instanceof K?i[Object.keys(i).length]=[120,121,122,123,124,125,126,127,128,129,130,131,132,133,134]:(i[Object.keys(i).length]=[120,121,122,123,124,125,126],i[Object.keys(i).length]=[128,129,130,131,132,133,134]),this.gridEntities[Xe.LEFT]instanceof K?i[Object.keys(i).length]=[15,30,45,60,75,90,105]:(i[Object.keys(i).length]=[15,30,45],i[Object.keys(i).length]=[75,90,105]);for(const t in i){const s=[];for(const l in i[t]){const c=this.gridEntities[i[t][l]].Position;this.gridEntities[i[t][l]].SetHitbox(),s.push([[c.x,c.y],[c.x+26,c.y],[c.x+26,c.y+26],[c.x,c.y+26]])}const r=gt.union(...s)[0],a=[];a.push(new $.Vector(r[0][0],r[0][1]));for(let l=1;l<r.length-1;l++)!(r[l][0]===r[l-1][0]&&r[l][0]===r[l+1][0])&&!(r[l][1]===r[l-1][1]&&r[l][1]===r[l+1][1])&&a.push(new $.Vector(r[l][0],r[l][1]));this.gridEntities.push(new Ti(new $.Vector(a[0].x,a[0].y),new $.Polygon(new $.Vector(0,0),a)))}this.WallsReplaced=!0}}Enter(){}Render(){C.context.drawImage(this.backdrop,0,0),j.draw("RoomShading",0,0)}}class wi{constructor(e){m(this,"name");m(this,"tasks",[]);this.name=e,this.tasks=[]}finalize(){this.tasks.forEach(e=>e()),this.tasks.length=0}queue(e){this.tasks.push(e)}Enter(e){}collides(e,i){}obstruct(e,i,t){}update(e,i){}render(e,i){}}const Ve=class Ve{constructor(){m(this,"Black",0);m(this,"Red",8);m(this,"Green",16);m(this,"Blue",24);m(this,"Yellow",32);m(this,"Pink",40);m(this,"White",56);m(this,"letters",[]);m(this,"charHeight",8);m(this,"charWidth",8);for(let e=32;e<127;e++)this.letters[e]={x:(e-32)*8,y:0}}static initialize(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}write(e,i,t,s){const r=j.getImage("font");if(r)for(let a=0;a<e.length;a++){const l=e.charCodeAt(a);C.context.drawImage(r,this.letters[l].x,this.letters[l].y+i,this.charWidth,this.charHeight,t+this.charWidth*(a+1),s,this.charWidth,this.charHeight)}}};m(Ve,"instance");let ot=Ve;const Ni=ot.initialize();class vt extends fi{constructor(i,t,s,r,a){super(i);m(this,"start");m(this,"distance",160);m(this,"current",0);m(this,"height",-20);m(this,"speed",7.5);m(this,"CollisionRadius",5);m(this,"Burst",!1);switch(this.parent=r,this.start=i,s){case le.UP:this.Velocity=t.clone().add(new $.Vector(0,-10));break;case le.DOWN:this.height=0,this.Velocity=t.clone().add(new $.Vector(0,10));break;case le.LEFT:this.Velocity=t.clone().add(new $.Vector(-10,0));break;case le.RIGHT:this.Velocity=t.clone().add(new $.Vector(10,0));break;default:this.Velocity=this.TargetDirection(a.Position)}r instanceof lt?this.SetAnimation(j.getAnimation("Tear")):this.SetAnimation(j.getAnimation("BloodTear")),this.SetHitbox(new $.Circle(this.Position,this.CollisionRadius)),this.SetBaseMass(100),this.addTrait(new Ft(8))}Collision(i){if(i!==this.parent){if(i instanceof ye){i.GetCollisionClass()!==te.NONE&&i.GetCollisionClass()!==te.PIT&&this.Explode();return}i instanceof lt&&i.Hurt(10),!(i instanceof vt)&&this.Explode()}}Explode(){this.Burst=!0,this.SetAnimation(j.getAnimation("Poof")),this.GetAnimation().Enter(),this.GetAnimation().Play("Poof",!0),this.SetHitbox(null)}Update(i){const t=this.GetAnimation();if(!this.Burst){this.current+=this.speed,this.height+=.75;const s=ki(this.current,this.start,this.Velocity);t.yOffset=this.height,this.Position=s,this.Hitbox.pos=s,this.current>=this.distance&&this.Explode()}t.Update(s=>{s&&t.GetAnimationName()=="Poof"&&this.remove()})}IsVisible(){return!this.Burst}GetRenderOrder(){return 1e4}}class S extends Me{}class lt extends ui{constructor(){super(new $.Vector(C.width/2,C.height/2+50));m(this,"body");m(this,"head");m(this,"hearts",[we.FULL,we.FULL,we.FULL]);m(this,"bombs",1);m(this,"coins",0);m(this,"keys",0);m(this,"moving",!1);m(this,"speed",4);m(this,"damage",3.5);m(this,"crying",!1);m(this,"tearDelay",0);m(this,"rightEye",!1);m(this,"damageCooldown",0);m(this,"bodyDirection");m(this,"headDirection");m(this,"pickupItem",null);m(this,"Dead",!1);m(this,"eyeDots",{[je.RIGHT]:new $.Vector(0,0),[je.LEFT]:new $.Vector(0,0)});m(this,"eyeOffsets",{[je.RIGHT]:{[le.DOWN]:new $.Vector(1,0),[le.RIGHT]:new $.Vector(0,0),[le.UP]:new $.Vector(-0,-4),[le.LEFT]:new $.Vector(0,0)},[je.LEFT]:{[le.DOWN]:new $.Vector(-1,0),[le.RIGHT]:new $.Vector(-1,0),[le.UP]:new $.Vector(1,-4),[le.LEFT]:new $.Vector(-4,0)}});m(this,"shotSpeed",1);m(this,"tearRange",260);this.addTrait(new Ft(18)),this.SetHitbox(new $.Circle(this.Position,7)),this.body=j.getAnimation("IsaacBody"),this.head=j.getAnimation("IsaacHead"),this.SetBaseMass(1),this.SetBaseFriction(.45),this.SetBaseElasticity(0)}setPosition(i,t){i>0&&i<C.width&&t>0&&t<C.height&&(this.Position=new $.Vector(i,t))}Enter(){this.body.Enter(),this.head.Enter(),this.setPosition(C.width/2,C.height/2+50)}Collision(i,t){i.Parent}Update(i){if(!he.transitioning){if(this.damageCooldown>0&&this.damageCooldown--,this.moving=!1,this.crying=!1,this.bodyDirection=le.DOWN,this.headDirection=le.DOWN,this.Acceleration.x=0,this.Acceleration.y=0,!this.Dead){if(Pe.IsActionPressed(q.WALK_LEFT)&&(this.moving=!0,this.bodyDirection=this.headDirection=le.LEFT,this.Acceleration.x=-this.speed),Pe.IsActionPressed(q.WALK_RIGHT)&&(this.moving=!0,this.bodyDirection=this.headDirection=le.RIGHT,this.Acceleration.x=this.speed),Pe.IsActionPressed(q.WALK_UP)&&(this.moving=!0,this.bodyDirection=this.headDirection=le.UP,this.Acceleration.y=-this.speed),Pe.IsActionPressed(q.WALK_DOWN)&&(this.moving=!0,this.bodyDirection=this.headDirection=le.DOWN,this.Acceleration.y=this.speed),Pe.IsActionPressed(q.SHOOT_LEFT)&&(this.headDirection=le.LEFT,this.crying=!0),Pe.IsActionPressed(q.SHOOT_UP)&&(this.headDirection=le.UP,this.crying=!0),Pe.IsActionPressed(q.SHOOT_RIGHT)&&(this.headDirection=le.RIGHT,this.crying=!0),Pe.IsActionPressed(q.SHOOT_DOWN)&&(this.headDirection=le.DOWN,this.crying=!0),Pe.IsKeyPressedOnce("KeyK")&&this.head.Play("Hit",!0),this.Acceleration.normalize().scale(this.speed),this.Velocity.add(this.Acceleration),this.Velocity.scale(1-this.Friction),this.Position.add(this.Velocity),this.Position.x=qe(this.Position.x,20,C.width-20),this.Position.y=qe(this.Position.y,20,C.height-20),this.tearDelay>0&&(this.tearDelay-=1),this.crying)if(this.tearDelay>0||["HeadUp","HeadDown","HeadLeft","HeadRight"].indexOf(this.head.GetAnimationName())===-1)this.crying=!1;else{this.rightEye=!this.rightEye,this.tearDelay=13;const t=this.eyeOffsets[this.rightEye?1:-1][this.headDirection],s=new vt(this.Position.clone().add(t),this.Velocity,this.headDirection,this);s.Enter(),he.GetLevel().GetRoom().AddEntity(s)}this.moving?(this.body.GetAnimationName()!==`Walk${this.bodyDirection}`||!this.body.IsPlaying())&&this.body.Play(`Walk${this.bodyDirection}`,!0):(this.body.Stop(),this.body.SetFrame(0,"WalkDown")),this.crying?this.head.SetFrame(2,`Head${this.headDirection}`):this.tearDelay>=10?this.head.SetFrame(2,`Head${this.headDirection}`):this.head.SetFrame(0,`Head${this.headDirection}`)}this.head.Update(t=>{t&&this.head.GetAnimationName()==="Death"?(he.BeforeEnter(),yt.Transition(new Ii)):t&&this.head.GetAnimationName()==="Pickup"&&(this.pickupItem=null)}),this.body.Update(),this.head.OnNullItem((t,s)=>{if(s)switch(t){case 0:this.pickupItem&&(this.pickupItem.xOffset=s.xPosition,this.pickupItem.yOffset=s.yPosition);break}}),super.Update(i)}}HasPickupItem(){return this.pickupItem!==null}GetNullItemPosition(){var i,t;return this.Position.clone().add(new $.Vector((i=this.pickupItem)==null?void 0:i.xOffset,((t=this.pickupItem)==null?void 0:t.yOffset)+25))}Pickup(i){this.pickupItem=i}Play(i){this.head.Play(i,!0)}Hurt(i){if(this.damageCooldown!==0||this.Dead)return;this.head.GetAnimationName()!=="Hit"&&this.head.Play("Hit",!0),this.damageCooldown=30;let t=this.GetHearts()-.5;const s=[];for(let r=0;r<this.GetMaxHearts();r++)t>=1?(s.push(we.FULL),t-=1):t===.5?(s.push(we.HALF),t-=.5):s.push(we.EMPTY);this.hearts=s,this.GetHearts()<=0&&this.Die()}Die(){this.damageCooldown=0,this.Dead=!0,this.head.Play("Death",!0)}Render(){super.Render(),this.damageCooldown>0&&(C.context.save(),this.damageCooldown%3===0&&(C.context.filter="brightness(50%)")),["HeadUp","HeadDown","HeadLeft","HeadRight"].indexOf(this.head.GetAnimationName())!==-1&&this.body.Render(this.Position),this.head.Render(this.Position),this.damageCooldown>0&&C.context.restore()}GetBlackHearts(){return[...this.hearts].filter(i=>i===we.BLACK).map(i=>1).reduce((i,t)=>i+t,0)}GetHearts(){return[...this.hearts].filter(i=>i===we.FULL||i===we.HALF).map(i=>i===we.HALF?.5:1).reduce((i,t)=>i+t,0)}GetMaxHearts(){return[...this.hearts].filter(i=>i===we.FULL||i===we.HALF||i===we.EMPTY).length}GetSoulHearts(){return[...this.hearts].filter(i=>i===we.SOUL).map(i=>1).reduce((i,t)=>i+t,0)}GetBombs(){return qe(this.bombs,0,99)}GetCoins(){return qe(this.coins,0,99)}GetKeys(){return qe(this.keys,0,99)}GetDamageCooldown(){return this.damageCooldown}GetDamage(){return this.damage}}class K extends ye{constructor(e){super(e),this.SetHitbox(new $.Box(this.Position,26,26).toPolygon()),this.SetBaseMass(100),this.SetGridCollisionClass(te.WALL)}}class Ti extends ye{constructor(e,i){super(e),this.SetHitbox(i),this.SetBaseMass(100),this.SetGridCollisionClass(te.WALL)}}class Ii extends pt{constructor(){super();m(this,"loadImageIndex");m(this,"loadingImageV1");m(this,"loadingImageV2");m(this,"currentImage");m(this,"counter",0);m(this,"nextScene");m(this,"level",null);m(this,"levelGenerationComplete",!1);m(this,"displayFrames",20);this.loadImageIndex=String(Math.floor(Math.random()*6)+1).padStart(2,"0"),this.loadingImageV1=`LoadImage0${this.loadImageIndex}`,this.loadingImageV2=`LoadImage0${this.loadImageIndex}.2`,this.currentImage=this.loadingImageV1,this.nextScene=he}Enter(){this.counter=1,this.generateLevelAsync()}Update(i){this.currentImage=this.counter%4===0?this.loadingImageV1:this.loadingImageV2,this.counter>0&&this.counter++,this.levelGenerationComplete&&this.counter>=this.displayFrames&&(this.level&&this.nextScene.setLevel(this.level),yt.Transition(this.nextScene))}Render(){C.context.fillStyle="#000",C.context.fillRect(0,0,C.width,C.height);const i=j.getImage(this.currentImage);i&&j.draw(this.currentImage,C.width/2-i.width/2,C.height/2-i.height/2)}TransitionOut(i,t){return Bt.CrossFade(this,this.nextScene,30,i,t)}generateLevelAsync(){setTimeout(()=>{try{this.level=new ct,this.levelGenerationComplete=!0}catch(i){console.error("Level generation failed:",i),this.level=new ct,this.levelGenerationComplete=!0}},0)}}const Ai={Grid:[S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S]};class Li extends Ei{constructor(e){super(e);const i=Ai;for(let t=0;t<14;t++)for(let s=0;s<11;s++)if(i.Grid[s*11+t]!==S)try{const r=i.Grid[s*11+t];if(typeof r!="function"){console.error(`Start Room Layout Error: Entity at position (${t}, ${s}) is not a constructor.`,{roomLayout:i.LayoutID||"Unknown",position:{x:t,y:s},gridIndex:s*11+t,entityType:r,layoutGrid:i.Grid});continue}const a=new r(Wt(s*11+t));this.SetGridEntity(s*11+t,a),a.Enter()}catch(r){console.error(`Start Room Layout Error: Failed to create entity at position (${t}, ${s}).`,{roomLayout:i.LayoutID||"Unknown",position:{x:t,y:s},gridIndex:s*11+t,entityType:i.Grid[s*11+t],error:r.message,layoutGrid:i.Grid});continue}}Render(){super.Render();const e=j.getImage("instructions");C.context.save(),C.context.globalCompositeOperation="multiply",C.context.globalAlpha=.5,j.draw("instructions",C.width/2-e.width/2,C.height/2-e.height/2),C.context.restore()}}const _i=[{name:"IsaacBody",src:"resources/gfx/001.000_player.anm2"},{name:"IsaacHead",src:"resources/gfx/001.000_player.anm2"},{name:"Tear",src:"resources/gfx/002.000_tear.anm2"},{name:"Poof",src:"resources/gfx/1000.012_tear poofa.anm2"},{name:"BloodTear",src:"resources/gfx/002.001_blood tear.anm2"},{name:"BloodPoof",src:"resources/gfx/1000.002_blood explosion.anm2"},{name:"props",src:"resources/gfx/grid/props_01_basement.anm2"}],Fi=[{name:"luaminioutlined",src:"resources/font/luaminioutlined.fnt"},{name:"pftempestasevencondensed",src:"resources/font/pftempestasevencondensed.fnt"},{name:"teammeatfont10",src:"resources/font/teammeatfont10.fnt"},{name:"teammeatfont16bold",src:"resources/font/teammeatfont16bold.fnt"}],$i=[{name:"font",src:"images/font.gif"},{name:"TitleBackground",src:"images/titleScreen.png"},{name:"TitleLogo",src:"images/toilogo.png"},{name:"instructions",src:"custom_resources/gfx/controls.png"},{name:"shadow",src:"resources/gfx/shadow.png"},{name:"RoomShading",src:"resources/gfx/backdrop/shading.png"},{name:"hudpickups",src:"resources/gfx/ui/hudpickups.png"},{name:"ui_hearts",src:"resources/gfx/ui/ui_hearts.png"},{name:"ui_chargebar",src:"resources/gfx/ui/ui_chargebar.png"},{name:"hudstats",src:"resources/gfx/ui/hudstats2.png"},{name:"d6",src:"resources/gfx/items/collectibles/collectibles_105_dice.png"},{name:"LoadImage001",src:"resources/gfx/ui/loadimages/loadimages-001.png"},{name:"LoadImage001.2",src:"resources/gfx/ui/loadimages/loadimages-001_2.png"},{name:"LoadImage002",src:"resources/gfx/ui/loadimages/loadimages-002.png"},{name:"LoadImage002.2",src:"resources/gfx/ui/loadimages/loadimages-002_2.png"},{name:"LoadImage003",src:"resources/gfx/ui/loadimages/loadimages-003.png"},{name:"LoadImage003.2",src:"resources/gfx/ui/loadimages/loadimages-003_2.png"},{name:"LoadImage004",src:"resources/gfx/ui/loadimages/loadimages-004.png"},{name:"LoadImage004.2",src:"resources/gfx/ui/loadimages/loadimages-004_2.png"},{name:"LoadImage005",src:"resources/gfx/ui/loadimages/loadimages-005.png"},{name:"LoadImage005.2",src:"resources/gfx/ui/loadimages/loadimages-005_2.png"},{name:"LoadImage006",src:"resources/gfx/ui/loadimages/loadimages-006.png"},{name:"LoadImage006.2",src:"resources/gfx/ui/loadimages/loadimages-006_2.png"},{name:"LevelBackdrop",src:"resources/gfx/backdrop/01_basement.png"},{name:"Isaac",src:"images/characters/character_001_isaac.png"}];class Ft extends wi{constructor(i){super("shadow");m(this,"size",0);this.size=i}render(i){this.size>0&&i.IsVisible()&&(C.context.save(),C.context.globalAlpha=.25,j.draw("shadow",0,0,120,49,this.x(i),this.y(i),this.width(),this.height()),C.context.restore())}x(i){return i.Position.x-this.size/2}y(i){return i.Position.y-Math.floor(this.height()/2)}width(){return this.size}height(){return Math.floor(this.size/12*5)}}var $t={exports:{}};(function(f,e){/** @preserve SAT.js - Version 0.9.0 - Copyright 2012 - 2021 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */(function(i,t){f.exports=t()})(rt,function(){var i={};function t(u,R){this.x=u||0,this.y=R||0}i.Vector=t,i.V=t,t.prototype.copy=t.prototype.copy=function(u){return this.x=u.x,this.y=u.y,this},t.prototype.clone=t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.perp=t.prototype.perp=function(){var u=this.x;return this.x=this.y,this.y=-u,this},t.prototype.rotate=t.prototype.rotate=function(u){var R=this.x,I=this.y;return this.x=R*Math.cos(u)-I*Math.sin(u),this.y=R*Math.sin(u)+I*Math.cos(u),this},t.prototype.reverse=t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=t.prototype.normalize=function(){var u=this.len();return u>0&&(this.x=this.x/u,this.y=this.y/u),this},t.prototype.add=t.prototype.add=function(u){return this.x+=u.x,this.y+=u.y,this},t.prototype.sub=t.prototype.sub=function(u){return this.x-=u.x,this.y-=u.y,this},t.prototype.scale=t.prototype.scale=function(u,R){return this.x*=u,this.y*=typeof R<"u"?R:u,this},t.prototype.project=t.prototype.project=function(u){var R=this.dot(u)/u.len2();return this.x=R*u.x,this.y=R*u.y,this},t.prototype.projectN=t.prototype.projectN=function(u){var R=this.dot(u);return this.x=R*u.x,this.y=R*u.y,this},t.prototype.reflect=t.prototype.reflect=function(u){var R=this.x,I=this.y;return this.project(u).scale(2),this.x-=R,this.y-=I,this},t.prototype.reflectN=t.prototype.reflectN=function(u){var R=this.x,I=this.y;return this.projectN(u).scale(2),this.x-=R,this.y-=I,this},t.prototype.dot=t.prototype.dot=function(u){return this.x*u.x+this.y*u.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())};function s(u,R){this.pos=u||new t,this.r=R||0,this.offset=new t}i.Circle=s,s.prototype.getAABBAsBox=s.prototype.getAABBAsBox=function(){var u=this.r,R=this.pos.clone().add(this.offset).sub(new t(u,u));return new a(R,u*2,u*2)},s.prototype.getAABB=s.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},s.prototype.setOffset=s.prototype.setOffset=function(u){return this.offset=u,this};function r(u,R){this.pos=u||new t,this.angle=0,this.offset=new t,this.setPoints(R||[])}i.Polygon=r,r.prototype.setPoints=r.prototype.setPoints=function(u){var R=!this.points||this.points.length!==u.length;if(R){var I,U=this.calcPoints=[],F=this.edges=[],W=this.normals=[];for(I=0;I<u.length;I++){var B=u[I],V=I<u.length-1?u[I+1]:u[0];if(B!==V&&B.x===V.x&&B.y===V.y){u.splice(I,1),I-=1;continue}U.push(new t),F.push(new t),W.push(new t)}}return this.points=u,this._recalc(),this},r.prototype.setAngle=r.prototype.setAngle=function(u){return this.angle=u,this._recalc(),this},r.prototype.setOffset=r.prototype.setOffset=function(u){return this.offset=u,this._recalc(),this},r.prototype.rotate=r.prototype.rotate=function(u){for(var R=this.points,I=R.length,U=0;U<I;U++)R[U].rotate(u);return this._recalc(),this},r.prototype.translate=r.prototype.translate=function(u,R){for(var I=this.points,U=I.length,F=0;F<U;F++)I[F].x+=u,I[F].y+=R;return this._recalc(),this},r.prototype._recalc=function(){var u=this.calcPoints,R=this.edges,I=this.normals,U=this.points,F=this.offset,W=this.angle,B=U.length,V;for(V=0;V<B;V++){var X=u[V].copy(U[V]);X.x+=F.x,X.y+=F.y,W!==0&&X.rotate(W)}for(V=0;V<B;V++){var z=u[V],ee=V<B-1?u[V+1]:u[0],ae=R[V].copy(ee).sub(z);I[V].copy(ae).perp().normalize()}return this},r.prototype.getAABBAsBox=r.prototype.getAABBAsBox=function(){for(var u=this.calcPoints,R=u.length,I=u[0].x,U=u[0].y,F=u[0].x,W=u[0].y,B=1;B<R;B++){var V=u[B];V.x<I?I=V.x:V.x>F&&(F=V.x),V.y<U?U=V.y:V.y>W&&(W=V.y)}return new a(this.pos.clone().add(new t(I,U)),F-I,W-U)},r.prototype.getAABB=r.prototype.getAABB=function(){return this.getAABBAsBox().toPolygon()},r.prototype.getCentroid=r.prototype.getCentroid=function(){for(var u=this.calcPoints,R=u.length,I=0,U=0,F=0,W=0;W<R;W++){var B=u[W],V=W===R-1?u[0]:u[W+1],X=B.x*V.y-V.x*B.y;I+=(B.x+V.x)*X,U+=(B.y+V.y)*X,F+=X}return F=F*3,I=I/F,U=U/F,new t(I,U)};function a(u,R,I){this.pos=u||new t,this.w=R||0,this.h=I||0}i.Box=a,a.prototype.toPolygon=a.prototype.toPolygon=function(){var u=this.pos,R=this.w,I=this.h;return new r(new t(u.x,u.y),[new t,new t(R,0),new t(R,I),new t(0,I)])};function l(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}i.Response=l,l.prototype.clear=l.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var c=[],y=0;y<10;y++)c.push(new t);for(var v=[],y=0;y<5;y++)v.push([]);var h=new l,b=new a(new t,1e-6,1e-6).toPolygon();function x(u,R,I){for(var U=Number.MAX_VALUE,F=-Number.MAX_VALUE,W=u.length,B=0;B<W;B++){var V=u[B].dot(R);V<U&&(U=V),V>F&&(F=V)}I[0]=U,I[1]=F}function g(u,R,I,U,F,W){var B=v.pop(),V=v.pop(),X=c.pop().copy(R).sub(u),z=X.dot(F);if(x(I,F,B),x(U,F,V),V[0]+=z,V[1]+=z,B[0]>V[1]||V[0]>B[1])return c.push(X),v.push(B),v.push(V),!0;if(W){var ee=0;if(B[0]<V[0])if(W.aInB=!1,B[1]<V[1])ee=B[1]-V[0],W.bInA=!1;else{var ae=B[1]-V[0],be=V[1]-B[0];ee=ae<be?ae:-be}else if(W.bInA=!1,B[1]>V[1])ee=B[0]-V[1],W.aInB=!1;else{var ae=B[1]-V[0],be=V[1]-B[0];ee=ae<be?ae:-be}var Ee=Math.abs(ee);Ee<W.overlap&&(W.overlap=Ee,W.overlapN.copy(F),ee<0&&W.overlapN.reverse())}return c.push(X),v.push(B),v.push(V),!1}i.isSeparatingAxis=g;function T(u,R){var I=u.len2(),U=R.dot(u);return U<0?E:U>I?D:k}var E=-1,k=0,D=1;function _(u,R){var I=c.pop().copy(u).sub(R.pos).sub(R.offset),U=R.r*R.r,F=I.len2();return c.push(I),F<=U}i.pointInCircle=_;function P(u,R){b.pos.copy(u),h.clear();var I=A(b,R,h);return I&&(I=h.aInB),I}i.pointInPolygon=P;function G(u,R,I){var U=c.pop().copy(R.pos).add(R.offset).sub(u.pos).sub(u.offset),F=u.r+R.r,W=F*F,B=U.len2();if(B>W)return c.push(U),!1;if(I){var V=Math.sqrt(B);I.a=u,I.b=R,I.overlap=F-V,I.overlapN.copy(U.normalize()),I.overlapV.copy(U).scale(I.overlap),I.aInB=u.r<=R.r&&V<=R.r-u.r,I.bInA=R.r<=u.r&&V<=u.r-R.r}return c.push(U),!0}i.testCircleCircle=G;function O(u,R,I){for(var U=c.pop().copy(R.pos).add(R.offset).sub(u.pos),F=R.r,W=F*F,B=u.calcPoints,V=B.length,X=c.pop(),z=c.pop(),ee=0;ee<V;ee++){var ae=ee===V-1?0:ee+1,be=ee===0?V-1:ee-1,Ee=0,Ce=null;X.copy(u.edges[ee]),z.copy(U).sub(B[ee]),I&&z.len2()>W&&(I.aInB=!1);var Ae=T(X,z);if(Ae===E){X.copy(u.edges[be]);var Oe=c.pop().copy(U).sub(B[be]);if(Ae=T(X,Oe),Ae===D){var xe=z.len();if(xe>F)return c.push(U),c.push(X),c.push(z),c.push(Oe),!1;I&&(I.bInA=!1,Ce=z.normalize(),Ee=F-xe)}c.push(Oe)}else if(Ae===D){if(X.copy(u.edges[ae]),z.copy(U).sub(B[ae]),Ae=T(X,z),Ae===E){var xe=z.len();if(xe>F)return c.push(U),c.push(X),c.push(z),!1;I&&(I.bInA=!1,Ce=z.normalize(),Ee=F-xe)}}else{var ke=X.perp().normalize(),xe=z.dot(ke),He=Math.abs(xe);if(xe>0&&He>F)return c.push(U),c.push(ke),c.push(z),!1;I&&(Ce=ke,Ee=F-xe,(xe>=0||Ee<2*F)&&(I.bInA=!1))}Ce&&I&&Math.abs(Ee)<Math.abs(I.overlap)&&(I.overlap=Ee,I.overlapN.copy(Ce))}return I&&(I.a=u,I.b=R,I.overlapV.copy(I.overlapN).scale(I.overlap)),c.push(U),c.push(X),c.push(z),!0}i.testPolygonCircle=O;function L(u,R,I){var U=O(R,u,I);if(U&&I){var F=I.a,W=I.aInB;I.overlapN.reverse(),I.overlapV.reverse(),I.a=I.b,I.b=F,I.aInB=I.bInA,I.bInA=W}return U}i.testCirclePolygon=L;function A(u,R,I){for(var U=u.calcPoints,F=U.length,W=R.calcPoints,B=W.length,V=0;V<F;V++)if(g(u.pos,R.pos,U,W,u.normals[V],I))return!1;for(var V=0;V<B;V++)if(g(u.pos,R.pos,U,W,R.normals[V],I))return!1;return I&&(I.a=u,I.b=R,I.overlapV.copy(I.overlapN).scale(I.overlap)),!0}return i.testPolygonPolygon=A,i})})($t);var $=$t.exports;const _e={testCircleCircle:$.testCircleCircle,testCirclePolygon:$.testCirclePolygon,testPolygonCircle:$.testPolygonCircle,testPolygonPolygon:$.testPolygonPolygon,pointInCircle:$.pointInCircle};$.Vector.prototype.Null=new $.Vector(0,0);class ct{constructor(){m(this,"room");const e={BackdropMediaName:"LevelBackdrop",Type:mt.DEFAULT,Doors:{},ID:84};this.room=new Li(e)}GetRoom(){return this.room}}class Ci extends Me{constructor(){super();m(this,"fontOpacity",1)}Update(i){}Render(){j.draw("d6",0,0,32,32,10,25,32,32),j.draw("ui_chargebar",0,0,16,32,36,25,16,32),j.draw("ui_chargebar",16,0,16,32,36,25,16,32),j.draw("ui_chargebar",48,0,16,32,36,25,16,32),this.RenderHearts(),this.RenderConsumables(),this.RenderStats()}RenderHearts(){const i=he.GetPlayer().GetHearts(),t=he.GetPlayer().GetMaxHearts();let s=46,r=28;for(let a=1;a<=qe(t,0,12);a++)j.draw("ui_hearts",32,0,16,16,s,r,16,16),a<=i?j.draw("ui_hearts",0,0,16,16,s,r,16,16):a-i===.5&&j.draw("ui_hearts",16,0,16,16,s,r,16,16),s+=12,a===6&&(s=62,r+=10)}RenderConsumables(){const i=String(he.GetPlayer().GetCoins()).padStart(2,"0");j.draw("hudpickups",0,0,16,16,6,52,16,16),j.getFont("pftempestasevencondensed").write(i,new $.Vector(20,52),-7);const t=String(he.GetPlayer().GetBombs()).padStart(2,"0");j.draw("hudpickups",0,16,16,16,6,64,16,16),j.getFont("pftempestasevencondensed").write(t,new $.Vector(20,64),-7);const s=String(he.GetPlayer().GetKeys()).padStart(2,"0");j.draw("hudpickups",16,0,16,16,6,76,16,16),j.getFont("pftempestasevencondensed").write(s,new $.Vector(20,76),-7)}RenderStats(){C.context.save(),C.context.globalAlpha=.6,j.draw("hudstats",16,0,16,16,6,95,16,16),j.getFont("luaminioutlined").write("1.00",new $.Vector(21,94),-1),j.draw("hudstats",32,0,16,16,6,108,16,16),j.getFont("luaminioutlined").write("2.73",new $.Vector(21,107),-1),j.draw("hudstats",0,0,16,16,6,121,16,16),j.getFont("luaminioutlined").write("3.50",new $.Vector(21,120),-1),j.draw("hudstats",0,16,16,16,6,134,16,16),j.getFont("luaminioutlined").write("6.50",new $.Vector(21,133),-1),j.draw("hudstats",16,16,16,16,6,147,16,16),j.getFont("luaminioutlined").write("1.00",new $.Vector(21,146),-1),j.draw("hudstats",32,16,16,16,6,160,16,16),j.getFont("luaminioutlined").write("0.00",new $.Vector(21,159),-1),j.draw("hudstats",48,0,16,16,6,173,16,16),j.getFont("luaminioutlined").write("0.0%",new $.Vector(21,172),-1),j.draw("hudstats",48,16,16,16,6,186,16,16),j.getFont("luaminioutlined").write("0.0%",new $.Vector(21,185),-1),C.context.restore()}GetRenderOrder(){return 1/0}}var Vt={};(function(f){(function(e){var i=this&&this.__values||function(s){var r=typeof Symbol=="function"&&s[Symbol.iterator],a=0;return r?r.call(s):{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}}},t;(function(s){(function(r){function a(c){if(!c)return c;for(var y={id:c.id,displayId:c.displayId,mapping:c.mapping,index:c.index,timestamp:c.timestamp,connected:c.connected,axes:new Array(c.axes.length),buttons:new Array(c.buttons.length)},v=0;v<c.axes.length;++v)y.axes[v]=c.axes[v];for(var v=0;v<c.buttons.length;++v){var h=c.buttons[v],b=h.pressed,x=h.value,g=h.touched;g=g||!1,y.buttons[v]={pressed:b,value:x,touched:g}}return y}r.cloneGamepad=a;function l(c){for(var y=new Array(c.length),v=0;v<c.length;++v)y[v]=a(c[v]);return y}r.cloneGamepads=l})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(b){b.captureGamepadEvents=!0})(r.config||(r.config={}));function a(b,x,g){g===void 0&&(g=!1);var T=document.createEvent("CustomEvent");return T.initCustomEvent(b,!0,!0,void 0),Object.keys(x).forEach(function(E){T[E]=x[E]}),g&&T.preventDefault(),(document.activeElement||document.body).dispatchEvent(T)}var l=!0,c=[];function y(b){if(l){for(var x=r.getGamepads({deadZone:0,keepInactive:!0,keepNonstandard:!0,keepNull:!0,standardize:!0}),g=Math.max(c.length,x.length),T=0;T<g;++T){var E=c[T],k=x[T];E&&(!k||k.id!==E.id||k.index!==E.index)&&a("mmk-gamepad-disconnected",{gamepadType:r.metadata.getDeviceType(E),gamepadIndex:E.index,connected:!1}),k&&(!E||k.id!==E.id||k.index!==E.index)&&a("mmk-gamepad-connected",{gamepadType:r.metadata.getDeviceType(k),gamepadIndex:k.index,connected:!0});var D=k||E;if(D){for(var _=r.metadata.getDeviceType(D),P=D.index,G=Math.max(k?k.buttons.length:0,E?E.buttons.length:0),O=0;O<G;++O){var L=E&&O<E.buttons.length&&E.buttons[O].pressed||!1,A=k&&O<k.buttons.length&&k.buttons[O].pressed||!1,u=E&&O<E.buttons.length?E.buttons[O].value:0,R=k&&O<k.buttons.length?k.buttons[O].value:0,I=A,U=R,F=!1;A&&!L?F=a("mmk-gamepad-button-down",{gamepadType:_,gamepadIndex:P,buttonIndex:O,buttonValue:U,held:I}):!A&&L&&(F=a("mmk-gamepad-button-up",{gamepadType:_,gamepadIndex:P,buttonIndex:O,buttonValue:U,held:I})),(R!==u||A!==L)&&a("mmk-gamepad-button-value",{gamepadType:_,gamepadIndex:P,buttonIndex:O,buttonValue:U,held:I},F)}for(var W=Math.max(k?k.axes.length:0,E?E.axes.length:0),B=0;B<W;++B){var V=E&&B<E.axes.length?E.axes[B]:0,X=k&&B<k.axes.length?k.axes[B]:0;V!==X&&a("mmk-gamepad-axis-value",{gamepadType:_,gamepadIndex:P,axisIndex:B,axisValue:X})}}}c=s.gamepad.cloneGamepads(x)}}var v=!0;"addEventListener"in window?addEventListener("load",function(){r.poll(function(){v&&y()})}):(l=!1,console.warn("addEventListener unavailable, assuming this browser doesn't support the gamepads API anyways"));function h(b){v=!1,y()}r.pollEvents=h})(s.gamepad||(s.gamepad={}))})(t||(t={})),navigator.gamepadInputEmulation="gamepad","addEventListener"in window&&addEventListener("keydown",function(s){switch(s.key){case"GamepadA":case"GamepadB":case"GamepadX":case"GamepadY":case"GamepadLeftThumbstick":case"GamepadLeftThumbstickUp":case"GamepadLeftThumbstickDown":case"GamepadLeftThumbstickLeft":case"GamepadLeftThumbstickRight":case"GamepadRightThumbstick":case"GamepadRightThumbstickUp":case"GamepadRightThumbstickDown":case"GamepadRightThumbstickLeft":case"GamepadRightThumbstickRight":case"GamepadDPadUp":case"GamepadDPadDown":case"GamepadDPadLeft":case"GamepadDPadRight":case"GamepadLeftShoulder":case"GamepadRightShoulder":case"GamepadLeftTrigger":case"GamepadRightTrigger":case"GamepadView":case"GamepadMenu":t.gamepad.config.captureGamepadEvents&&s.preventDefault();break}},!0);var t;(function(s){(function(r){function a(v,h,b){if(b<=0)return[v,h];if(b>=1)return[0,0];var x=v*v+h*h;if(x<=b*b)return[0,0];var g=Math.sqrt(x),T=(g-b)/(1-b);T<0&&(T=0);var E=T/g;return[v*E,h*E]}function l(v,h){var b=r.cloneGamepad(v);if(b.mapping==="standard"){var x=b.axes[0],g=b.axes[1],T=b.axes[2],E=b.axes[3],k=a(x,g,h),D=a(T,E,h);b.axes[0]=k[0],b.axes[1]=k[1],b.axes[2]=D[0],b.axes[3]=D[1]}return b}function c(v){return v.axes.some(function(h){return h!==0})||v.buttons.some(function(h){return h.pressed||h.touched})}function y(v){var h=r.getRawGamepads();return v.keepNull||(h=h.filter(function(b){return b!==null})),v.standardize&&(h=h.map(function(b){return r.tryRemapStdLayout(b)||b})),v.keepNonstandard||(h=h.filter(function(b){return b&&b.mapping==="standard"})),v.deadZone&&(h=h.map(function(b){return b&&l(b,v.deadZone)})),v.keepInactive||(h=h.filter(function(b){return b?c(b):!1})),h}r.getGamepads=y})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){function a(){return"getGamepads"in navigator||"onconnectedgamepad"in window}r.isSupported=a})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){var a=console.assert;function l(g){return function(T,E){var k=T?Math.round((T.value+1)/2*7):8,D=g(k);return{value:D?1:0,pressed:D,touched:D}}}var c={"01-11":function(g,T){var E=g?g.value*2-1:0;return{value:E,pressed:!1,touched:!1}}},y={constant:function(g,T){var E=T.param||0,k=!1;return{value:E,pressed:k,touched:k}},"11-01":function(g,T){var E=g?(g.value+1)/2:0,k=T.param?E>T.param:g.pressed;return{value:E,pressed:k,touched:k}},"11-10":function(g,T){var E=g?(-g.value+1)/2:0,k=T.param?E>T.param:g.pressed;return{value:E,pressed:k,touched:k}},"axis-negative-01":function(g,T){var E=g&&g.value<0?-g.value:0,k=E>(T.param?T.param:0);return{value:E,pressed:k,touched:k}},"axis-positive-01":function(g,T){var E=g&&g.value>0?+g.value:0,k=E>(T.param?T.param:0);return{value:E,pressed:k,touched:k}},"hat-up-bit":l(function(g){return g===7||g===0||g===1}),"hat-right-bit":l(function(g){return 1<=g&&g<=3}),"hat-down-bit":l(function(g){return 3<=g&&g<=5}),"hat-left-bit":l(function(g){return 5<=g&&g<=7})},v=/\blinux\b/i.test(navigator.userAgent),h=/\bChrome\/\d{2,3}\b/i.test(navigator.userAgent),b=v&&h;function x(g){if(!g||!b&&g.mapping==="standard"||g.mapping==="-custom")return g;var T=r.metadata.findRemap(g);if(!T)return g;for(var E=r.flattenPremapGamepad(g),k={id:g.id,displayId:g.displayId,index:g.index,timestamp:g.timestamp,connected:g.connected,mapping:T.mapping,axes:new Array(T.axes.length),buttons:new Array(T.buttons.length)},D=0;D<T.axes.length;++D){var _=T.axes[D];if(_===void 0)k.axes[D]=0;else if(_.xform===void 0){var P=E[_.src];a(!!P),k.axes[D]=P?P.value:0}else{var P=E[_.src],G=c[_.xform];a(!!P),a(!!G),k.axes[D]=G(P,_).value}}for(var D=0;D<T.buttons.length;++D){var O=T.buttons[D];if(O===void 0)k.buttons[D]={value:0,pressed:!1,touched:!1};else if(O.xform===void 0){var L=E[O.src];a(!!L),k.buttons[D]=L||{value:0,pressed:!1,touched:!1}}else{var L=E[O.src],G=y[O.xform];a(!!L),a(!!G),k.buttons[D]=G(L,O)}}return k}r.tryRemapStdLayout=x})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a[a.Cross=0]="Cross",a[a.Circle=1]="Circle",a[a.Square=2]="Square",a[a.Triangle=3]="Triangle",a[a.LeftShoulder=4]="LeftShoulder",a[a.RightShoulder=5]="RightShoulder",a[a.LeftTrigger=6]="LeftTrigger",a[a.RightTrigger=7]="RightTrigger",a[a.Select=8]="Select",a[a.Start=9]="Start",a[a.LeftThumb=10]="LeftThumb",a[a.RightThumb=11]="RightThumb",a[a.DirectionalPadUp=12]="DirectionalPadUp",a[a.DirectionalPadDown=13]="DirectionalPadDown",a[a.DirectionalPadLeft=14]="DirectionalPadLeft",a[a.DirectionalPadRight=15]="DirectionalPadRight",a[a._PlayStationLogo=16]="_PlayStationLogo",a[a.LShoulder=4]="LShoulder",a[a.RShoulder=5]="RShoulder",a[a.LTrigger=6]="LTrigger",a[a.RTrigger=7]="RTrigger",a[a.LThumb=10]="LThumb",a[a.RThumb=11]="RThumb",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.L1=4]="L1",a[a.L2=6]="L2",a[a.L3=10]="L3",a[a.R1=5]="R1",a[a.R2=7]="R2",a[a.R3=11]="R3",a[a.Share=8]="Share",a[a.Options=9]="Options"})(r.DualShockButton||(r.DualShockButton={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a[a.LeftStickRight=0]="LeftStickRight",a[a.LeftStickDown=1]="LeftStickDown",a[a.RightStickRight=2]="RightStickRight",a[a.RightStickDown=3]="RightStickDown",a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY",a[a.LStickX=0]="LStickX",a[a.LStickY=1]="LStickY",a[a.RStickX=2]="RStickX",a[a.RStickY=3]="RStickY"})(r.StandardAxis||(r.StandardAxis={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a[a.A=0]="A",a[a.B=1]="B",a[a.X=2]="X",a[a.Y=3]="Y",a[a.LeftShoulder=4]="LeftShoulder",a[a.RightShoulder=5]="RightShoulder",a[a.LeftTrigger=6]="LeftTrigger",a[a.RightTrigger=7]="RightTrigger",a[a.Back=8]="Back",a[a.Start=9]="Start",a[a.LeftThumb=10]="LeftThumb",a[a.RightThumb=11]="RightThumb",a[a.DirectionalPadUp=12]="DirectionalPadUp",a[a.DirectionalPadDown=13]="DirectionalPadDown",a[a.DirectionalPadLeft=14]="DirectionalPadLeft",a[a.DirectionalPadRight=15]="DirectionalPadRight",a[a._Guide=16]="_Guide",a[a.LShoulder=4]="LShoulder",a[a.RShoulder=5]="RShoulder",a[a.LTrigger=6]="LTrigger",a[a.RTrigger=7]="RTrigger",a[a.LThumb=10]="LThumb",a[a.RThumb=11]="RThumb",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.View=8]="View",a[a.Menu=9]="Menu"})(r.XboxButton||(r.XboxButton={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){function a(l){for(var c={},y=0;y<l.axes.length;++y){var v=l.axes[y],h="a"+y;c[h]={value:v,pressed:!1,touched:!1}}for(var y=0;y<l.buttons.length;++y){var b=l.buttons[y],h="b"+y;c[h]={value:b.value,pressed:b.pressed,touched:b.touched}}return c}r.flattenPremapGamepad=a})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){function a(c){return c}function l(){var c,y;if("getGamepads"in navigator){var v=navigator.getGamepads(),h=[];try{for(var b=i(v),x=b.next();!x.done;x=b.next()){var g=x.value;g?h.push(g):h.push(g)}}catch(T){c={error:T}}finally{try{x&&!x.done&&(y=b.return)&&y.call(b)}finally{if(c)throw c.error}}return h}else return[]}r.getRawGamepads=l})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){function a(h){var b=/^(.+?)(?: \((.*)\))$/i.exec(h);if(b){var x={name:b[1],vendor:"",product:"",hint:"blink"},g=/(?:^| )Vendor: ([0-9a-f]{4}) Product: ([0-9a-f]{4})$/i.exec(b[2]);return g&&(x.vendor=g[1],x.product=g[2]),x}}function l(h){if(h==="xinput")return{name:"xinput",vendor:"",product:"",hint:"gecko"};var b=/^([0-9a-f]{4})-([0-9a-f]{4})-(.+)$/gi.exec(h);if(b)return{name:b[3],vendor:b[1],product:b[2],hint:"gecko"}}function c(h){return{name:h,vendor:"",product:"",hint:"unknown"}}function y(h){if(!h)return c("unknown");var b=a(h)||l(h)||c(h);return b}r.parseGamepadId=y;var v=[["Xbox 360 Controller (XInput STANDARD GAMEPAD)",{name:"Xbox 360 Controller",vendor:"",product:"",hint:"blink"}],["DUALSHOCK4 USB Wireless Adaptor (Vendor: 054c Product: 0ba0)",{name:"DUALSHOCK4 USB Wireless Adaptor",vendor:"054c",product:"0ba0",hint:"blink"}],["Wireless Controller (STANDARD GAMEPAD Vendor: 054c Product: 09cc)",{name:"Wireless Controller",vendor:"054c",product:"09cc",hint:"blink"}],["xinput",{name:"xinput",vendor:"",product:"",hint:"gecko"}],["054c-0ba0-DUALSHOCK4 USB Wireless Adaptor",{name:"DUALSHOCK4 USB Wireless Adaptor",vendor:"054c",product:"0ba0",hint:"gecko"}],["054c-09cc-Wireless Controller",{name:"Wireless Controller",vendor:"054c",product:"09cc",hint:"gecko"}],[void 0,{name:"unknown",vendor:"",product:"",hint:"unknown"}],["asdf",{name:"asdf",vendor:"",product:"",hint:"unknown"}],["",{name:"unknown",vendor:"",product:"",hint:"unknown"}]];v.forEach(function(h){var b=JSON.stringify(y(h[0])),x=JSON.stringify(h[1]);console.assert(b===x,"Expected parsed:",b,"equal to expected:",x)})})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){function a(l){if("requestAnimationFrame"in window){var c=function(){window.requestAnimationFrame(c),l()};window.requestAnimationFrame(c)}else setInterval(l,10)}r.poll=a})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){var l={};function c(h){for(var b in h){var x=h[b];console.assert(!(b in l)),l[b]=x}}a.regsiterAxises=c;function y(h,b){var x,g;b===void 0&&(b=navigator.languages);var T=l[h];try{for(var E=i(b),k=E.next();!k.done;k=E.next()){var D=k.value;if(D.indexOf("-")!==-1&&D in T)return T[D]}}catch(_){x={error:_}}finally{try{k&&!k.done&&(g=E.return)&&g.call(E)}finally{if(x)throw x.error}}return"Unlocalized Axis "+JSON.stringify(h)}a.getAxisLabel=y;function v(h,b,x){x===void 0&&(x=navigator.languages);var g=a.getDeviceAxises(h);return 0<=b&&b<g.length?y(g[b],x):void 0}a.getGamepadAxisLabel=v})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){var l={};function c(h){for(var b in h){var x=h[b];console.assert(!(b in l)),l[b]=typeof x=="string"?{fallback:x}:x}}a.registerButtons=c;function y(h,b){var x,g;b===void 0&&(b=navigator.languages);for(var T=l[h];T;){try{for(var E=(x=void 0,i(b)),k=E.next();!k.done;k=E.next()){var D=k.value;if(D.indexOf("-")!==-1&&D in T)return T[D]}}catch(P){x={error:P}}finally{try{k&&!k.done&&(g=E.return)&&g.call(E)}finally{if(x)throw x.error}}if(!("fallback"in T))break;var _=T;if(T=l[T.fallback],!T)return JSON.stringify(h)+" w/ missing fallback "+JSON.stringify(_.fallback)}return"Unlocalized Button "+JSON.stringify(h)}a.getButtonLabel=y;function v(h,b,x){x===void 0&&(x=navigator.languages);var g=a.getDeviceButtons(h);return 0<=b&&b<g.length?y(g[b],x):void 0}a.getGamepadButtonLabel=v})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){var l={};function c(_,P){console.assert(!(_ in l)),l[_]=P}a.registerDeviceType=c;var y={};function v(_,P,G,O){var L=_+"-"+P;console.assert(!(L in y)),y[L]={deviceType:G,description:O}}a.registerDevice=v;function h(_){return!("vendor"in _&&"product"in _)}function b(_){return typeof _=="string"}function x(_){return h(_)?r.parseGamepadId(_.id):_}function g(_){var P=x(_),G=P.vendor,O=P.product;return G+"-"+O}function T(_,P){var G,O;P===void 0&&(P=navigator.languages);var L=y[g(_)];if(!L)return h(_)?_.id:"Unknown Device "+JSON.stringify(_);try{for(var A=i(P),u=A.next();!u.done;u=A.next()){var R=u.value;if(R in L.description)return L.description[R]}}catch(I){G={error:I}}finally{try{u&&!u.done&&(O=A.return)&&O.call(A)}finally{if(G)throw G.error}}return L.description["en-US"]}a.getDeviceLabel=T;function E(_){if(b(_))return _;var P=y[g(_)];return P?P.deviceType:h(_)&&_.mapping==="standard"?"gamepad-unknown":"unknown-unknown"}a.getDeviceType=E;function k(_){var P=l[E(_)];return P?P.buttons:[]}a.getDeviceButtons=k;function D(_){var P=l[E(_)];return P?P.axises:[]}a.getDeviceAxises=D})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){var l={};function c(h){h.matches.forEach(function(b){console.assert(!(b in l),"Remaps contains multiple entries for the same mapping"),l[b]=h})}a.registerRemap=c;function y(h){var b=r.parseGamepadId(h.id),x=b.vendor+"-"+b.product+"-"+b.hint+"-"+h.axes.length+"-"+h.buttons.length;return x}function v(h){var b=y(h),x=l[b];return x}a.findRemap=v})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-facepad-down":{"en-US":"Face Down (A?) Button"},"gamepad-facepad-right":{"en-US":"Face Right (B?) Button"},"gamepad-facepad-left":{"en-US":"Face Left (X?) Button"},"gamepad-facepad-up":{"en-US":"Face Up (Y?) Button"},"gamepad-left-bumper":{"en-US":"Left Bumper"},"gamepad-right-bumper":{"en-US":"Right Bumper"},"gamepad-left-trigger":{"en-US":"Left Trigger"},"gamepad-right-trigger":{"en-US":"Right Trigger"},"gamepad-face-left":{"en-US":"Left Face (Back)"},"gamepad-face-right":{"en-US":"Right Face (Start)"},"gamepad-logo":{"en-US":"Gamepad Logo"},"gamepad-left-stick-click":{"en-US":"Left Stick Click"},"gamepad-right-stick-click":{"en-US":"Right Stick Click"},"gamepad-dpad-up":{"en-US":"D-Pad Up"},"gamepad-dpad-down":{"en-US":"D-Pad Down"},"gamepad-dpad-left":{"en-US":"D-Pad Left"},"gamepad-dpad-right":{"en-US":"D-Pad Right"}}),a.regsiterAxises({"gamepad-left-thumb-x":{range:"11",min:"left",max:"right","en-US":"Left Thumbstick X Axis",stick:"gamepad-left-thumb"},"gamepad-left-thumb-y":{range:"11",min:"up",max:"down","en-US":"Left Thumbstick Y Axis",stick:"gamepad-left-thumb"},"gamepad-right-thumb-x":{range:"11",min:"left",max:"right","en-US":"Right Thumbstick X Axis",stick:"gamepad-right-thumb"},"gamepad-right-thumb-y":{range:"11",min:"up",max:"down","en-US":"Right Thumbstick Y Axis",stick:"gamepad-right-thumb"}}),a.registerDeviceType("gamepad-unknown",{buttons:["gamepad-facepad-down","gamepad-facepad-right","gamepad-facepad-left","gamepad-facepad-up","gamepad-left-bumper","gamepad-right-bumper","gamepad-left-trigger","gamepad-right-trigger","gamepad-face-left","gamepad-face-right","gamepad-left-stick-click","gamepad-right-stick-click","gamepad-dpad-up","gamepad-dpad-down","gamepad-dpad-left","gamepad-dpad-right","gamepad-logo"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-ds3-cross":"gamepad-sony-cross","gamepad-ds3-circle":"gamepad-sony-circle","gamepad-ds3-square":"gamepad-sony-square","gamepad-ds3-triangle":"gamepad-sony-triangle","gamepad-ds3-l1":"gamepad-sony-l1","gamepad-ds3-r1":"gamepad-sony-r1","gamepad-ds3-l2":"gamepad-sony-l2","gamepad-ds3-r2":"gamepad-sony-r2","gamepad-ds3-select":"gamepad-sony-select","gamepad-ds3-start":"gamepad-sony-start","gamepad-ds3-playstation":"gamepad-sony-playstation","gamepad-ds3-l3":"gamepad-sony-l3","gamepad-ds3-r3":"gamepad-sony-r3"}),a.registerDeviceType("gamepad-ds3",{buttons:["gamepad-ds3-cross","gamepad-ds3-circle","gamepad-ds3-square","gamepad-ds3-triangle","gamepad-ds3-l1","gamepad-ds3-r1","gamepad-ds3-l2","gamepad-ds3-r2","gamepad-ds3-select","gamepad-ds3-start","gamepad-ds3-l3","gamepad-ds3-r3","gamepad-sony-dpad-up","gamepad-sony-dpad-down","gamepad-sony-dpad-left","gamepad-sony-dpad-right","gamepad-ds3-playstation"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("054c","0268","gamepad-ds3",{"en-US":"DualShock 3 Controller"}),a.registerRemap({mapping:"standard",tested:["Windows 10 / Chrome 75.0.3770.100","Windows 10 / Opera 60.0.3255.170","Windows 10 / Opera 62.0.3331.43"],matches:["054c-0268-blink-10-24"],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a5"}],buttons:[{src:"b2"},{src:"b1"},{src:"b3"},{src:"b0"},{src:"b6"},{src:"b7"},{src:"a3",xform:"11-10",param:.125},{src:"a4",xform:"11-10",param:.125},{src:"b9"},{src:"b8"},{src:"b10"},{src:"b11"},{src:"a9",xform:"hat-up-bit"},{src:"a9",xform:"hat-down-bit"},{src:"a9",xform:"hat-left-bit"},{src:"a9",xform:"hat-right-bit"},{src:"b12"}]}),a.registerRemap({mapping:"standard",tested:["Windows 10 / FireFox 67.0.2"],matches:[],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a5"}],buttons:[{src:"b2"},{src:"b1"},{src:"b3"},{src:"b0"},{src:"b6"},{src:"b7"},{src:"a3",xform:"11-10",param:.125},{src:"a4",xform:"11-10",param:.125},{src:"b9"},{src:"b8"},{src:"b10"},{src:"b11"},{src:"b13"},{src:"b14"},{src:"b15"},{src:"b16"},{src:"b12"}]}),a.registerRemap({mapping:"standard",tested:["Ubuntu 18.04 LTS / Firefox 59.0.2"],matches:["054c-0268-gecko-6-17"],axes:[{src:"a0"},{src:"a1"},{src:"a3"},{src:"a4"}],buttons:[{src:"b0"},{src:"b1"},{src:"b3"},{src:"b2"},{src:"b4"},{src:"b5"},{src:"a2",xform:"11-01",param:.125},{src:"a5",xform:"11-01",param:.125},{src:"b8"},{src:"b9"},{src:"b11"},{src:"b12"},{src:"b13"},{src:"b14"},{src:"b15"},{src:"b16"},{src:"b10"}]})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-ds4-cross":"gamepad-sony-cross","gamepad-ds4-circle":"gamepad-sony-circle","gamepad-ds4-square":"gamepad-sony-square","gamepad-ds4-triangle":"gamepad-sony-triangle","gamepad-ds4-l1":"gamepad-sony-l1","gamepad-ds4-r1":"gamepad-sony-r1","gamepad-ds4-l2":"gamepad-sony-l2","gamepad-ds4-r2":"gamepad-sony-r2","gamepad-ds4-share":{fallback:"gamepad-sony-select","en-US":"SHARE"},"gamepad-ds4-options":{fallback:"gamepad-sony-start","en-US":"OPTIONS"},"gamepad-ds4-playstation":"gamepad-sony-playstation","gamepad-ds4-l3":"gamepad-sony-l3","gamepad-ds4-r3":"gamepad-sony-r3","gamepad-ds4-touchpad":"gamepad-sony-touchpad"}),a.registerDeviceType("gamepad-ds4",{buttons:["gamepad-ds4-cross","gamepad-ds4-circle","gamepad-ds4-square","gamepad-ds4-triangle","gamepad-ds4-l1","gamepad-ds4-r1","gamepad-ds4-l2","gamepad-ds4-r2","gamepad-ds4-share","gamepad-ds4-options","gamepad-ds4-l3","gamepad-ds4-r3","gamepad-sony-dpad-up","gamepad-sony-dpad-down","gamepad-sony-dpad-left","gamepad-sony-dpad-right","gamepad-ds4-playstation","gamepad-ds4-touchpad"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("054c","054c","gamepad-ds4",{"en-US":"DualShock 4 Controller"}),a.registerDevice("054c","09cc","gamepad-ds4",{"en-US":"DualShock 4 Controller (2nd Gen)"}),a.registerDevice("054c","0ba0","gamepad-ds4",{"en-US":"DualShock 4 Wireless Adapter"}),a.registerRemap({mapping:"standard",tested:["Windows 7 / Opera 52.0.2871.99"],matches:["054c-054c-blink-10-14","054c-09cc-blink-10-14","054c-0ba0-blink-10-14"],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a5"}],buttons:[{src:"b1"},{src:"b2"},{src:"b0"},{src:"b3"},{src:"b4"},{src:"b5"},{src:"a3",xform:"11-01",param:.125},{src:"a4",xform:"11-01",param:.125},{src:"b8"},{src:"b9"},{src:"b10"},{src:"b11"},{src:"a9",xform:"hat-up-bit"},{src:"a9",xform:"hat-down-bit"},{src:"a9",xform:"hat-left-bit"},{src:"a9",xform:"hat-right-bit"},{src:"b12"},{src:"b13"}]}),a.registerRemap({mapping:"standard",tested:["Windows 7 / Firefox 62.0a1 (2018-05-09) - DPad busted"],matches:["054c-054c-gecko-8-18","054c-09cc-gecko-8-18","054c-0ba0-gecko-8-18","054c-054c-gecko-6-18","054c-09cc-gecko-6-18","054c-0ba0-gecko-6-18"],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a5"}],buttons:[{src:"b1"},{src:"b2"},{src:"b0"},{src:"b3"},{src:"b4"},{src:"b5"},{src:"a3",xform:"11-01",param:.125},{src:"a4",xform:"11-01",param:.125},{src:"b8"},{src:"b9"},{src:"b10"},{src:"b11"},{src:"b14"},{src:"b15"},{src:"b16"},{src:"b17"},{src:"b12"},{src:"b13"}]}),a.registerRemap({mapping:"standard",tested:["Ubuntu 18.04 LTS / Firefox 59.0.2"],matches:["054c-054c-gecko-8-13","054c-09cc-gecko-8-13","054c-0ba0-gecko-8-13"],axes:[{src:"a0"},{src:"a1"},{src:"a3"},{src:"a4"}],buttons:[{src:"b0"},{src:"b1"},{src:"b3"},{src:"b2"},{src:"b4"},{src:"b5"},{src:"a2",xform:"11-01",param:.125},{src:"a5",xform:"11-01",param:.125},{src:"b8"},{src:"b9"},{src:"b11"},{src:"b12"},{src:"a7",xform:"axis-negative-01"},{src:"a7",xform:"axis-positive-01"},{src:"a6",xform:"axis-negative-01"},{src:"a6",xform:"axis-positive-01"},{src:"b10"}]}),a.registerRemap({mapping:"standard",tested:["Ubuntu 18.04 LTS / Chrome 66.0.3359.139"],matches:["054c-054c-blink-4-18","054c-09cc-blink-4-18","054c-0ba0-blink-4-18"],axes:[{src:"a0"},{src:"a1"},{src:"b6",xform:"01-11"},{src:"b7",xform:"01-11"}],buttons:[{src:"b2"},{src:"b0"},{src:"b3"},{src:"b1"},{src:"b4"},{src:"b5"},{src:"a2",xform:"11-01",param:.125},{src:"a3",xform:"11-01",param:.125},{src:"b8"},{src:"b9"},{src:"b11"},{src:"b16"},{src:"b12"},{src:"b13"},{src:"b14"},{src:"b15"},{src:"b10"}]})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-microsoft-a":{"en-US":"A Button",fallback:"gamepad-facepad-down"},"gamepad-microsoft-b":{"en-US":"B Button",fallback:"gamepad-facepad-right"},"gamepad-microsoft-x":{"en-US":"X Button",fallback:"gamepad-facepad-left"},"gamepad-microsoft-y":{"en-US":"Y Button",fallback:"gamepad-facepad-up"},"gamepad-microsoft-left-bumper":{"en-US":"Left Bumper",fallback:"gamepad-left-bumper"},"gamepad-microsoft-right-bumper":{"en-US":"Right Bumper",fallback:"gamepad-right-bumper"},"gamepad-microsoft-left-trigger":{"en-US":"Left Trigger",fallback:"gamepad-left-trigger"},"gamepad-microsoft-right-trigger":{"en-US":"Right Trigger",fallback:"gamepad-right-trigger"},"gamepad-microsoft-back":{"en-US":"Back Button",fallback:"gamepad-face-left"},"gamepad-microsoft-start":{"en-US":"Start Button",fallback:"gamepad-face-right"},"gamepad-microsoft-guide":{"en-US":"Guide Button",fallback:"gamepad-logo"},"gamepad-microsoft-left-stick-click":{"en-US":"Left Stick Click",fallback:"gamepad-left-stick-click"},"gamepad-microsoft-right-stick-click":{"en-US":"Right Stick Click",fallback:"gamepad-right-stick-click"},"gamepad-microsoft-dpad-up":"gamepad-dpad-up","gamepad-microsoft-dpad-down":"gamepad-dpad-down","gamepad-microsoft-dpad-left":"gamepad-dpad-left","gamepad-microsoft-dpad-right":"gamepad-dpad-right"}),a.registerDeviceType("gamepad-xinput",{buttons:["gamepad-microsoft-a","gamepad-microsoft-b","gamepad-microsoft-x","gamepad-microsoft-y","gamepad-left-bumper","gamepad-right-bumper","gamepad-left-trigger","gamepad-right-trigger","gamepad-microsoft-back","gamepad-microsoft-start","gamepad-left-stick-click","gamepad-right-stick-click","gamepad-dpad-up","gamepad-dpad-down","gamepad-dpad-left","gamepad-dpad-right","gamepad-microsoft-guide"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("","","gamepad-xinput",{"en-US":"Xbox Style Gamepad (XInput)"})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-sony-cross":{"en-US":"Cross",fallback:"gamepad-facepad-down"},"gamepad-sony-circle":{"en-US":"Circle",fallback:"gamepad-facepad-right"},"gamepad-sony-square":{"en-US":"Square",fallback:"gamepad-facepad-left"},"gamepad-sony-triangle":{"en-US":"Triangle",fallback:"gamepad-facepad-up"},"gamepad-sony-l1":{"en-US":"L1 Bumper",fallback:"gamepad-left-bumper"},"gamepad-sony-r1":{"en-US":"R1 Bumper",fallback:"gamepad-right-bumper"},"gamepad-sony-l2":{"en-US":"L2 Trigger",fallback:"gamepad-left-trigger"},"gamepad-sony-r2":{"en-US":"R2 Trigger",fallback:"gamepad-right-trigger"},"gamepad-sony-select":{"en-US":"Select",fallback:"gamepad-face-left"},"gamepad-sony-start":{"en-US":"Start",fallback:"gamepad-face-right"},"gamepad-sony-playstation":{"en-US":"PS Button",fallback:"gamepad-logo"},"gamepad-sony-l3":{"en-US":"L3 Thumbstick",fallback:"gamepad-left-stick-click"},"gamepad-sony-r3":{"en-US":"R3 Thumbstick",fallback:"gamepad-right-stick-click"},"gamepad-sony-touchpad":{"en-US":"Touchpad Button"},"gamepad-sony-dpad-up":"gamepad-dpad-up","gamepad-sony-dpad-down":"gamepad-dpad-down","gamepad-sony-dpad-left":"gamepad-dpad-left","gamepad-sony-dpad-right":"gamepad-dpad-right"})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-xbox-a":"gamepad-microsoft-a","gamepad-xbox-b":"gamepad-microsoft-b","gamepad-xbox-x":"gamepad-microsoft-x","gamepad-xbox-y":"gamepad-microsoft-y","gamepad-xbox-left-bumper":"gamepad-microsoft-left-bumper","gamepad-xbox-right-bumper":"gamepad-microsoft-right-bumper","gamepad-xbox-left-trigger":"gamepad-microsoft-left-trigger","gamepad-xbox-right-trigger":"gamepad-microsoft-right-trigger","gamepad-xbox-back":"gamepad-microsoft-back","gamepad-xbox-start":"gamepad-microsoft-start","gamepad-xbox-guide":"gamepad-microsoft-guide","gamepad-xbox-left-stick-click":"gamepad-microsoft-left-stick-click","gamepad-xbox-right-stick-click":"gamepad-microsoft-right-stick-click"}),a.registerDeviceType("gamepad-xbox",{buttons:["gamepad-xbox-a","gamepad-xbox-b","gamepad-xbox-x","gamepad-xbox-y","gamepad-xbox-left-bumper","gamepad-xbox-right-bumper","gamepad-xbox-left-trigger","gamepad-xbox-right-trigger","gamepad-xbox-back","gamepad-xbox-start","gamepad-xbox-left-stick-click","gamepad-xbox-right-stick-click","gamepad-microsoft-dpad-up","gamepad-microsoft-dpad-down","gamepad-microsoft-dpad-left","gamepad-microsoft-dpad-right","gamepad-xbox-guide"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("045e","0202","gamepad-xbox",{"en-US":"Xbox Controller"}),a.registerDevice("045e","0285","gamepad-xbox",{"en-US":"Xbox Controller S"}),a.registerDevice("045e","0289","gamepad-xbox",{"en-US":"Xbox Controller S"})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-xb360-a":"gamepad-microsoft-a","gamepad-xb360-b":"gamepad-microsoft-b","gamepad-xb360-x":"gamepad-microsoft-x","gamepad-xb360-y":"gamepad-microsoft-y","gamepad-xb360-left-bumper":"gamepad-microsoft-left-bumper","gamepad-xb360-right-bumper":"gamepad-microsoft-right-bumper","gamepad-xb360-left-trigger":"gamepad-microsoft-left-trigger","gamepad-xb360-right-trigger":"gamepad-microsoft-right-trigger","gamepad-xb360-back":"gamepad-microsoft-back","gamepad-xb360-start":"gamepad-microsoft-start","gamepad-xb360-guide":"gamepad-microsoft-guide","gamepad-xb360-left-stick-click":"gamepad-microsoft-left-stick-click","gamepad-xb360-right-stick-click":"gamepad-microsoft-right-stick-click"}),a.registerDeviceType("gamepad-xb360",{buttons:["gamepad-xb360-a","gamepad-xb360-b","gamepad-xb360-x","gamepad-xb360-y","gamepad-xb360-left-bumper","gamepad-xb360-right-bumper","gamepad-xb360-left-trigger","gamepad-xb360-right-trigger","gamepad-xb360-back","gamepad-xb360-start","gamepad-xb360-left-stick-click","gamepad-xb360-right-stick-click","gamepad-microsoft-dpad-up","gamepad-microsoft-dpad-down","gamepad-microsoft-dpad-left","gamepad-microsoft-dpad-right","gamepad-xb360-guide"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("045e","028e","gamepad-xb360",{"en-US":"Xbox 360 Controller"}),a.registerDevice("045e","028f","gamepad-xb360",{"en-US":"Xbox 360 Wireless Controller"}),a.registerDevice("045e","0291","gamepad-xb360",{"en-US":"Xbox 360 Wireless Receiver for Windows"}),a.registerDevice("045e","02a1","gamepad-xb360",{"en-US":"Xbox 360 Wireless Receiver for Windows"})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"gamepad-xbone-a":"gamepad-microsoft-a","gamepad-xbone-b":"gamepad-microsoft-b","gamepad-xbone-x":"gamepad-microsoft-x","gamepad-xbone-y":"gamepad-microsoft-y","gamepad-xbone-left-bumper":"gamepad-microsoft-left-bumper","gamepad-xbone-right-bumper":"gamepad-microsoft-right-bumper","gamepad-xbone-left-trigger":"gamepad-microsoft-left-trigger","gamepad-xbone-right-trigger":"gamepad-microsoft-right-trigger","gamepad-xbone-view":{fallback:"gamepad-microsoft-back","en-US":"View Button"},"gamepad-xbone-menu":{fallback:"gamepad-microsoft-start","en-US":"Menu Button"},"gamepad-xbone-xbox":{fallback:"gamepad-microsoft-guide","en-US":"Xbox Button"},"gamepad-xbone-left-stick-click":"gamepad-microsoft-left-stick-click","gamepad-xbone-right-stick-click":"gamepad-microsoft-right-stick-click"}),a.registerDeviceType("gamepad-xbone",{buttons:["gamepad-xbone-a","gamepad-xbone-b","gamepad-xbone-x","gamepad-xbone-y","gamepad-xbone-left-bumper","gamepad-xbone-right-bumper","gamepad-xbone-left-trigger","gamepad-xbone-right-trigger","gamepad-xbone-view","gamepad-xbone-menu","gamepad-xbone-left-stick-click","gamepad-xbone-right-stick-click","gamepad-microsoft-dpad-up","gamepad-microsoft-dpad-down","gamepad-microsoft-dpad-left","gamepad-microsoft-dpad-right","gamepad-xbone-xbox"],axises:["gamepad-left-thumb-x","gamepad-left-thumb-y","gamepad-right-thumb-x","gamepad-right-thumb-y"]}),a.registerDevice("045e","02d1","gamepad-xbone",{"en-US":"Xbox One Controller"}),a.registerDevice("045e","02dd","gamepad-xbone",{"en-US":"Xbox One Controller"}),a.registerDevice("045e","02e3","gamepad-xbone",{"en-US":"Xbox One Elite Controller"}),a.registerDevice("045e","02e6","gamepad-xbone",{"en-US":"Wireless XBox Controller Dongle"}),a.registerDevice("045e","02ea","gamepad-xbone",{"en-US":"Xbox One S Controller"}),a.registerDevice("045e","02fd","gamepad-xbone",{"en-US":"Xbox One S Controller (Bluetooth)"}),a.registerRemap({mapping:"standard",tested:["Ubuntu 18.04 LTS / Firefox 59.0.2"],matches:["045e-028e-gecko-8-11","045e-02d1-gecko-8-11"],axes:[{src:"a0"},{src:"a1"},{src:"a3"},{src:"a4"}],buttons:[{src:"b0"},{src:"b1"},{src:"b2"},{src:"b3"},{src:"b4"},{src:"b5"},{src:"a2",xform:"11-01",param:.125},{src:"a5",xform:"11-01",param:.125},{src:"b6"},{src:"b7"},{src:"b9"},{src:"b10"},{src:"a7",xform:"axis-negative-01"},{src:"a7",xform:"axis-positive-01"},{src:"a6",xform:"axis-negative-01"},{src:"a6",xform:"axis-positive-01"},{src:"b8"}]})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerButtons({"saitek-x52-trigger-half":{"en-US":"Joystick Half Trigger"},"saitek-x52-fire":{"en-US":"Joystick Fire Button"},"saitek-x52-a":{"en-US":"Joystick A Button"},"saitek-x52-b":{"en-US":"Joystick B Button"},"saitek-x52-c":{"en-US":"Joystick C Button"},"saitek-x52-trigger-pinky":{"en-US":"Joystick Pinky Trigger"},"saitek-x52-d":{"en-US":"Throttle D Button"},"saitek-x52-e":{"en-US":"Throttle E Button"},"saitek-x52-t1":{"en-US":"T1"},"saitek-x52-t2":{"en-US":"T2"},"saitek-x52-t3":{"en-US":"T3"},"saitek-x52-t4":{"en-US":"T4"},"saitek-x52-t5":{"en-US":"T5"},"saitek-x52-t6":{"en-US":"T6"},"saitek-x52-trigger-full":{"en-US":"Joystick Full Trigger"},"saitek-x52-hat-alt-up":{"en-US":"Alternate Hat: Up"},"saitek-x52-hat-alt-right":{"en-US":"Alternate Hat: Right"},"saitek-x52-hat-alt-down":{"en-US":"Alternate Hat: Down"},"saitek-x52-hat-alt-left":{"en-US":"Alternate Hat: Left"},"saitek-x52-hat-throttle-up":{"en-US":"Throttle Hat: Up"},"saitek-x52-hat-throttle-right":{"en-US":"Throttle Hat: Right"},"saitek-x52-hat-throttle-down":{"en-US":"Throttle Hat: Down"},"saitek-x52-hat-throttle-left":{"en-US":"Throttle Hat: Left"},"saitek-x52-mode-1":{"en-US":"Mode Dial: 1 (Down/White)"},"saitek-x52-mode-2":{"en-US":"Mode Dial: 2 (Middle/Orange)"},"saitek-x52-mode-3":{"en-US":"Mode Dial: 3 (Up/Red)"},"saitek-x52-mfd-function":{"en-US":"MFD Button: Function"},"saitek-x52-mfd-up":{"en-US":"MFD Button: Down / Start / Stop"},"saitek-x52-mfd-down":{"en-US":"MFD Button: Up / Reset"},"saitek-x52-i":{"en-US":"Throttle i Button"},"saitek-x52-mouse-click":{"en-US":"Left Mouse (Throttle)"},"saitek-x52-mouse-wheel":{"en-US":"Mouse Wheel (Throttle)"},"saitek-x52-mouse-wheel-down":{"en-US":"Mouse Wheel Forward / Down"},"saitek-x52-mouse-wheel-up":{"en-US":"Mouse Wheel Back / Up"},"saitek-x52-hat-thumb-up":{"en-US":"Joystick Hat: Up"},"saitek-x52-hat-thumb-right":{"en-US":"Joystick Hat: Right"},"saitek-x52-hat-thumb-down":{"en-US":"Joystick Hat: Down"},"saitek-x52-hat-thumb-left":{"en-US":"Joystick Hat: Left"}}),a.regsiterAxises({"saitek-x52-joystick-x":{range:"11",min:"left",max:"right","en-US":"Joystick X Axis",stick:"saitek-x52-joystick"},"saitek-x52-joystick-y":{range:"11",min:"forward",max:"backward","en-US":"Joystick Y Axis",stick:"saitek-x52-joystick"},"saitek-x52-throttle":{range:"11",min:"forward",max:"backward","en-US":"Throttle"},"saitek-x52-i-dial":{range:"11",min:"ccw",max:"cw","en-US":"Throttle (i) Dial"},"saitek-x52-e-dial":{range:"11",min:"ccw",max:"cw","en-US":"Throttle (E) Dial"},"saitek-x52-joystick-twist":{range:"11",min:"ccw",max:"cw","en-US":"Joystick Twist Axis",stick:"saitek-x52-joystick"},"saitek-x52-throttle-thumb-slider":{range:"11",min:"forward",max:"backward","en-US":"Throttle Thumb Slider"},"saitek-x52-mouse-x":{range:"11",min:"left",max:"right","en-US":"Throttle Mouse X Axis",stick:"saitek-x52-mouse"},"saitek-x52-mouse-y":{range:"11",min:"up",max:"down","en-US":"Throttle Mouse Y Axis",stick:"saitek-x52-mouse"}}),a.registerDeviceType("saitek-x52",{buttons:["saitek-x52-trigger-half","saitek-x52-fire","saitek-x52-a","saitek-x52-b","saitek-x52-c","saitek-x52-trigger-pinky","saitek-x52-d","saitek-x52-e","saitek-x52-t1","saitek-x52-t2","saitek-x52-t3","saitek-x52-t4","saitek-x52-t5","saitek-x52-t6","saitek-x52-trigger-full","saitek-x52-hat-alt-up","saitek-x52-hat-alt-right","saitek-x52-hat-alt-down","saitek-x52-hat-alt-left","saitek-x52-hat-throttle-up","saitek-x52-hat-throttle-right","saitek-x52-hat-throttle-down","saitek-x52-hat-throttle-left","saitek-x52-mode-1","saitek-x52-mode-2","saitek-x52-mode-3","saitek-x52-mfd-function","saitek-x52-mfd-up","saitek-x52-mfd-down","saitek-x52-i","saitek-x52-mouse-click","saitek-x52-mouse-wheel","saitek-x52-mouse-wheel-down","saitek-x52-mouse-wheel-up","saitek-x52-hat-thumb-up","saitek-x52-hat-thumb-right","saitek-x52-hat-thumb-down","saitek-x52-hat-thumb-left"],axises:["saitek-x52-joystick-x","saitek-x52-joystick-y","saitek-x52-throttle","saitek-x52-i-dial","saitek-x52-e-dial","saitek-x52-joystick-twist","saitek-x52-throttle-thumb-slider","saitek-x52-mouse-x","saitek-x52-mouse-y"]}),a.registerDevice("06a3","075c","saitek-x52",{"en-US":"Saitek X52 Flight Control System"}),a.registerRemap({mapping:"-custom",tested:["Windows 10 / Chrome 74.0.3729.131"],matches:["06a3-075c-blink-10-32"],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a3"},{src:"a4"},{src:"a5"},{src:"a6"},{src:"a8"},{src:"a7"}],buttons:[{src:"b0"},{src:"b1"},{src:"b2"},{src:"b3"},{src:"b4"},{src:"b5"},{src:"b6"},{src:"b7"},{src:"b8"},{src:"b9"},{src:"b10"},{src:"b11"},{src:"b12"},{src:"b13"},{src:"b14"},{src:"b15"},{src:"b16"},{src:"b17"},{src:"b18"},{src:"b19"},{src:"b20"},{src:"b21"},{src:"b22"},{src:"b23"},{src:"b24"},{src:"b25"},{src:"b26"},{src:"b27"},{src:"b28"},{src:"b29"},{src:"b30"},{src:"b31"},{src:"b0",xform:"constant",param:0},{src:"b0",xform:"constant",param:0},{src:"a9",xform:"hat-up-bit"},{src:"a9",xform:"hat-right-bit"},{src:"a9",xform:"hat-down-bit"},{src:"a9",xform:"hat-left-bit"}]}),a.registerRemap({mapping:"-custom",tested:["Windows 10 / FireFox 66.0.5"],matches:["06a3-075c-gecko-9-38"],axes:[{src:"a0"},{src:"a1"},{src:"a2"},{src:"a3"},{src:"a4"},{src:"a5"},{src:"a6"},{src:"a8"},{src:"a7"}],buttons:[{src:"b0"},{src:"b1"},{src:"b2"},{src:"b3"},{src:"b4"},{src:"b5"},{src:"b6"},{src:"b7"},{src:"b8"},{src:"b9"},{src:"b10"},{src:"b11"},{src:"b12"},{src:"b13"},{src:"b14"},{src:"b15"},{src:"b16"},{src:"b17"},{src:"b18"},{src:"b19"},{src:"b20"},{src:"b21"},{src:"b22"},{src:"b23"},{src:"b24"},{src:"b25"},{src:"b26"},{src:"b27"},{src:"b28"},{src:"b29"},{src:"b30"},{src:"b31"},{src:"b32"},{src:"b33"},{src:"b34"},{src:"b35"},{src:"b36"},{src:"b37"}]})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={}));var t;(function(s){(function(r){(function(a){a.registerDeviceType("dead",{axises:[],buttons:[]}),a.registerDeviceType("unknown-unknown",{axises:[],buttons:[]}),a.registerDevice("04f3","0089","dead",{"en-US":"Unknown Device"})})(r.metadata||(r.metadata={}))})(s.gamepad||(s.gamepad={}))})(t||(t={})),typeof f.nodeName!="string"&&Object.keys(t.gamepad).forEach(function(s){f[s]=t.gamepad[s]})})()})(Vt);const Ke=ii(Vt),Pt={[q.WALK_UP]:"KeyW",[q.WALK_DOWN]:"KeyS",[q.WALK_LEFT]:"KeyA",[q.WALK_RIGHT]:"KeyD",[q.SHOOT_UP]:"ArrowUp",[q.SHOOT_DOWN]:"ArrowDown",[q.SHOOT_LEFT]:"ArrowLeft",[q.SHOOT_RIGHT]:"ArrowRight",[q.BOMB]:"KeyE",[q.ITEM]:"Space",[q.POCKET_ITEM]:"KeyQ",[q.DROP]:"ControlLeft",[q.FULLSCREEN]:"KeyF",[q.RESTART]:"KeyR",[q.MUTE]:"KeyM"},Fe={KeyW:q.WALK_UP,KeyS:q.WALK_DOWN,KeyA:q.WALK_LEFT,KeyD:q.WALK_RIGHT,ArrowUp:q.SHOOT_UP,ArrowDown:q.SHOOT_DOWN,ArrowLeft:q.SHOOT_LEFT,ArrowRight:q.SHOOT_RIGHT,KeyE:q.BOMB,Space:q.ITEM,KeyQ:q.POCKET_ITEM,ControlLeft:q.DROP,KeyF:q.FULLSCREEN,KeyR:q.RESTART,KeyM:q.MUTE},Pi={0:q.SHOOT_DOWN,1:q.SHOOT_RIGHT,2:q.SHOOT_LEFT,3:q.SHOOT_UP,4:q.BOMB,5:q.POCKET_ITEM,6:q.ITEM,7:q.DROP,12:q.WALK_UP,13:q.WALK_DOWN,14:q.WALK_LEFT,15:q.WALK_RIGHT},Ri={0:{[-1]:q.WALK_LEFT,1:q.WALK_RIGHT},1:{[-1]:q.WALK_UP,1:q.WALK_DOWN},2:{[-1]:q.SHOOT_LEFT,1:q.SHOOT_RIGHT},3:{[-1]:q.SHOOT_UP,1:q.SHOOT_DOWN}},Be=class Be{constructor(){m(this,"pressed",{});m(this,"action",{});m(this,"toggle",{});m(this,"hasGamepad",!1);document.onkeydown=this.keyDownEvent.bind(this),document.onkeyup=this.keyUpEvent.bind(this),this.pressed={},Ke.isSupported()||console.warn("Gamepads not available in this browser");const e=Ke.getRawGamepads();e[0]&&(Ke.tryRemapStdLayout(e[0]),this.hasGamepad=!0),Ke.poll(()=>{Ke.pollEvents()}),window.addEventListener("mmk-gamepad-button-value",i=>{this.hasGamepad=!0;const t=i,s=Pi[t.buttonIndex];s!==void 0&&(this.action[s]=t.buttonValue,t.buttonValue&&(this.toggle[s]=!this.toggle[s]))}),window.addEventListener("mmk-gamepad-axis-value",i=>{this.hasGamepad=!0;const t=i,s=Ri[t.axisIndex];s&&(Math.abs(t.axisValue)<.2?(this.action[s[-1]]=0,this.action[s[1]]=0):this.action[s[Math.sign(t.axisValue)]]=t.axisValue)})}static initalize(){return Be.instance||(Be.instance=new Be),Be.instance}AnyActionPressed(){for(const e in q)if(this.action[e]!==0&&Math.abs(this.action[e])>.2)return!0;return!1}IsActionPressed(e){return this.action[e]!==0&&Math.abs(this.action[e])>.2?!0:this.IsKeyDown(Pt[e])}ActionToggleValue(e){return this.toggle[e]}IsActionTriggered(e){return this.action[e]!==0&&Math.abs(this.action[e])>.2?!0:this.IsKeyPressedOnce(Pt[e])}GetActionValue(e){return this.action[e]}HasGamepad(){return this.hasGamepad}IsKeyDown(e){return this.pressed[e]!==null?this.pressed[e]:!1}IsKeyPressedOnce(e){return this.IsKeyDown(e)?(this.pressed[e]=!1,this.action[Fe[e]]=0,!0):!1}keyDownEvent(e){this.isInEditorOrInput()||(this.pressed[e.code]=!0,Fe[e.code]&&(this.action[Fe[e.code]]=1,this.toggle[Fe[e.code]]=!this.toggle[Fe[e.code]]),this.preventDefault(e))}keyUpEvent(e){this.isInEditorOrInput()||(this.pressed[e.code]=!1,Fe[e.code]&&(this.action[Fe[e.code]]=0),this.preventDefault(e))}isInEditorOrInput(){const e=document.activeElement;if(!e)return!1;const i=e.tagName.toLowerCase();return!!(i==="input"||i==="textarea"||i==="select"||e.getAttribute("contenteditable")==="true"||e.closest(".ace_editor"))}preventDefault(e){(e.code.startsWith("Arrow")||e.which>=112&&e.which<=123)&&e.preventDefault()}};m(Be,"instance");let dt=Be;const Pe=dt.initalize(),ge=class ge{constructor(){m(this,"delta",0);m(this,"mode",ge.TRANSITION_IN);m(this,"nextScene");m(this,"startTime",0);m(this,"scene");m(this,"transitioning",!1);m(this,"hasFocus",!1);document.addEventListener("focus",e=>{var i;this.hasFocus=((i=e.detail)==null?void 0:i.state)??!0}),document.addEventListener("blur",e=>{var i;this.hasFocus=((i=e.detail)==null?void 0:i.state)??!1}),window.addEventListener("mmk-gamepad-connected",e=>{this.hasFocus=!0}),window.addEventListener("message",e=>{},!1)}static initalize(){return ge.instance||(ge.instance=new ge),ge.instance}ChangeScene(e){var i,t;(i=this.scene)==null||i.Exit(),this.scene=e,this.transitioning=!1,this.mode=ge.TRANSITION_IN,this.startTime=1,(t=this.scene)==null||t.Enter()}Transition(e){this.transitioning||(e==null||e.BeforeEnter(),this.nextScene=e,this.transitioning=!0,this.mode=ge.TRANSITION_OUT,this.startTime=1)}Render(){var e,i,t,s,r;C.context.save(),this.transitioning?this.mode==ge.TRANSITION_IN&&((e=this.scene)!=null&&e.TransitionIn)?(this.transitioning=(i=this.scene)==null?void 0:i.TransitionIn(this.startTime,this.delta),this.transitioning===!1&&(this.mode=ge.RENDER)):this.mode==ge.TRANSITION_OUT&&((t=this.scene)!=null&&t.TransitionOut)?(this.transitioning=(s=this.scene)==null?void 0:s.TransitionOut(this.startTime,this.delta),this.transitioning===!1&&this.ChangeScene(this.nextScene)):(this.transitioning=!1,this.mode=ge.RENDER):this.mode=ge.RENDER,this.transitioning||(r=this.scene)==null||r.Render(),C.context.restore()}Update(e){var i,t,s;this.delta=(i=e.detail)==null?void 0:i.delta,this.startTime>0&&this.startTime++,(s=this.scene)==null||s.Update((t=e.detail)==null?void 0:t.delta)}};m(ge,"TRANSITION_IN",0),m(ge,"RENDER",1),m(ge,"TRANSITION_OUT",1),m(ge,"instance");let ht=ge;const yt=ht.initalize(),We=class We{constructor(){m(this,"fps",30);m(this,"first",performance.now());m(this,"last",performance.now());m(this,"interval");m(this,"counter",0);this.interval=1e3/this.fps}static initalize(){return We.instance||(We.instance=new We),We.instance}start(){this.tick()}tick(){window.requestAnimationFrame(()=>{this.tick()});const e=performance.now(),i=e-this.last;if(i>this.interval){this.last=e-i%this.interval;const t=new CustomEvent("tick",{bubbles:!0,cancelable:!0,composed:!1,detail:{delta:i/1e3,counter:this.counter,fps:parseFloat(this.counter/((this.last-this.first)/1e3)+"").toFixed(2)}});document.dispatchEvent(t),this.counter++}}};m(We,"instance");let ut=We;const Vi=ut.initalize();class Bt{static CrossFade(e,i,t,s,r){const a=s*100/t;return a>100?!1:(C.context.save(),C.context.globalAlpha=1-a/100,e.Render(),C.context.restore(),C.context.save(),C.context.globalAlpha=a/100,i.Update(r),i.Render(),C.context.restore(),!0)}static MoveRight(e,i,t,s,r){const a=C.width/t*s;return t===s?!1:(C.context.save(),C.context.imageSmoothingEnabled=!0,C.context.translate(-a,0),e.Render(),C.context.restore(),C.context.save(),C.context.translate(C.width+-a,0),i.Update(r),i.Render(),C.context.imageSmoothingEnabled=!1,C.context.restore(),!0)}static MoveLeft(e,i,t,s,r){const a=C.width/t*s;return t===s?!1:(C.context.save(),C.context.translate(a,0),e.Render(),C.context.restore(),C.context.save(),C.context.translate(-C.width+a,0),i.Update(r),i.Render(),C.context.restore(),!0)}static MoveDown(e,i,t,s,r){const a=C.height/t*s;return t===s?!1:(C.context.save(),C.context.translate(0,-a),e.Render(),C.context.restore(),C.context.save(),C.context.translate(0,C.height+-a),i.Update(r),i.Render(),C.context.restore(),!0)}static MoveUp(e,i,t,s,r){const a=C.height/t*s;return t===s?!1:(C.context.save(),C.context.translate(0,a),e.Render(),C.context.restore(),C.context.save(),C.context.translate(0,-C.height+a),i.Update(r),i.Render(),C.context.restore(),!0)}static IrisIn(e,i,t,s,r){let a=s+r-1;return a=a*a*.6,a>C.width?!1:(i.Update(r),i.Render(),C.context.beginPath(),C.context.moveTo(C.width/2,C.height/2),C.context.arc(C.width/2,C.height/2,a,0,Math.PI*2,!0),C.context.closePath(),C.context.clip(),e.Render(),!0)}static IrisOut(e,i,t,s,r){const a=C.width/2-s*10;return a<=0?!1:(i.Update(r),i.Render(),C.context.beginPath(),C.context.moveTo(C.width/2,C.height/2),C.context.arc(C.width/2,C.height/2,a,0,Math.PI*2,!0),C.context.closePath(),C.context.clip(),e.Render(),!0)}}const Wt=f=>{const e=Gi(f);return new $.Vector(26+e.x*26,26+e.y*26)},Gi=f=>{const e=Math.floor(f/15),i=f-15*e;return new $.Vector(i,e)},Bi=f=>Math.floor(f.x/26)+(Math.floor(f.y/26)-1)*15-1;function Wi(f,e){return Math.sqrt((f.x-e.x)**2+(f.y-e.y)**2)}const ki=(f,e,i)=>{const t=Math.atan2(i.y,i.x);return new $.Vector(e.x+f*Math.cos(t),e.y+f*Math.sin(t))};function bt(f,e){return e?Math.sqrt((f.x-e.x)**2+(f.y-e.y)**2):0}function Ht(f,e){if(!e)return f;const i=bt(f,e),t=8/i*(e.x-f.x),s=8/i*(e.y-f.y);return new $.Vector(t,s)}function Ge(f,e,i,t){const s=new $.Box(f,i,bt(f,e)),r=Ht(f,e),a=Math.atan2(r.x,r.y),l=s.toPolygon();l.rotate(-a);const c=he.GetLevel().GetRoom().GetEntities();let y=!1;const v=new $.Response;return c.forEach(h=>{var g;if(y||!h||t&&h===t)return;let b=!1,x=null;if(h instanceof ye){const T=h.GetCollisionClass();(T===te.SOLID||T===te.OBJECT||T===te.WALL)&&(b=!0)}b&&(x=(g=h.getTrait("hitbox"))==null?void 0:g.hitbox,!x&&h instanceof Me&&(x=h.GetHitbox()),x&&(v.clear(),x instanceof $.Circle?y=_e.testPolygonCircle(l,x,v):x instanceof $.Box?y=_e.testPolygonPolygon(l,x.toPolygon(),v):x instanceof $.Polygon&&(y=_e.testPolygonPolygon(l,x,v))))}),!y}function qe(f,e,i){return Math.min(Math.max(f,e),i)}function Hi(f,e){return Number(f.toPrecision(e))}function zi(f){return f[f.length*Math.random()|0]}function Se(f){let e;const i=[];for(e=0;e<f.length;e++)i[e]=f[e].weight+(i[e-1]||0);const t=Math.random()*i[i.length-1];for(e=0;e<i.length&&!(i[e]>t);e++);return f[e].item}function qi(f){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const Yi=(f,e,i,t)=>{const s=i/f,r=t/e,a=Math.min(s,r);return{width:f*a,height:e*a}},Le=class Le extends pt{constructor(){super();m(this,"player");m(this,"level");m(this,"hud");m(this,"gridXOffset",26);m(this,"gridYOffset",26);m(this,"delta",0);m(this,"mode");m(this,"nextRoom");m(this,"started",!1);m(this,"startTime",0);m(this,"direction",le.DOWN);m(this,"transitioning",!1);m(this,"GameTime",0);m(this,"RoomTime",0);m(this,"collisions",{0:{0:!1}});m(this,"debug",{EntityPositions:!1,Grid:!1,InfiniteHP:!1,HighDamage:!1,RoomInfo:!1,Hitspheres:!1,DamageValues:!1,InfiniteItemCharges:!1,HighLuck:!1,QuickKill:!1,GridInfo:!1,PlayerItemInfo:!1,GridCollisionPoints:!1,AStarGrid:!1})}BeforeEnter(){var i;this.entities=[],this.level||(this.level=new ct),this.player=new lt,this.player.Enter(),this.hud=new Ci,this.entities.push(this.player),this.entities.push(this.hud),(i=this.level.GetRoom())==null||i.BeforeEnter()}setLevel(i){this.level=i}Enter(){var i;(i=this.level.GetRoom())==null||i.Enter()}static initalize(){return Le.instance||(Le.instance=new Le),Le.instance}GetPlayer(){return this.player}GetLevel(){return this.level}GetDebugSettings(){return this.debug}GetFrameCount(){return this.GameTime}GetRoomFrameCount(){return this.RoomTime}ChangeRoom(i){}Transition(i,t){}Render(){var i;C.context.save(),this.transitioning?this.mode==Le.TRANSITION_OUT?(this.transitioning=Bt[this.direction](this.level.GetRoom(),this.nextRoom,6,this.startTime,this.delta),this.transitioning===!1&&this.ChangeRoom(this.nextRoom)):(this.transitioning=!1,this.mode=Le.RENDER):this.mode=Le.RENDER,this.transitioning?this.entities.forEach(t=>{t.Render()}):((i=this.level.GetRoom())==null||i.Render(),this.entities.concat(this.level.GetRoom().GetEntities()).sort((t,s)=>t.GetRenderOrder()-s.GetRenderOrder()).forEach(t=>{t.Render()})),C.context.restore(),this.debug.Grid&&this.debugDrawGrid(),this.debug.AStarGrid&&this.debugDrawAStarGrid()}Update(i){var t,s,r,a;if(this.delta=i,this.startTime>0&&this.startTime++,this.GameTime++,this.RoomTime++,this.entities.forEach(l=>{l.Update(i)}),!this.transitioning){const l=this.entities.concat(this.level.GetRoom().GetEntities()),c=new $.Response;l.forEach((y,v)=>{var b,x;if(!y)return;let h=(b=y.getTrait("hitbox"))==null?void 0:b.hitbox;if(!h&&y instanceof Me&&(h=y.GetHitbox()),!!h)for(let g=v+1;g<l.length;g++){const T=l[g];if(!T||y instanceof ye&&T instanceof ye||y instanceof tt&&T instanceof ye&&(T.GetCollisionClass()===te.WALL_EXCEPT_PLAYER||y.hasTrait&&y.hasTrait("flying"))||T instanceof tt&&y instanceof ye&&(y.GetCollisionClass()===te.WALL_EXCEPT_PLAYER||T.hasTrait&&T.hasTrait("flying")))continue;let E=(x=T.getTrait("hitbox"))==null?void 0:x.hitbox;if(!E&&T instanceof Me&&(E=T.GetHitbox()),!E)continue;let k=!1;c.clear(),h instanceof $.Circle&&E instanceof $.Circle?k=_e.testCircleCircle(h,E,c):h instanceof $.Polygon&&E instanceof $.Circle?k=_e.testPolygonCircle(h,E,c):h instanceof $.Circle&&E instanceof $.Polygon?k=_e.testCirclePolygon(h,E,c):h instanceof $.Polygon&&E instanceof $.Polygon?k=_e.testPolygonPolygon(h,E,c):h instanceof $.Circle&&E instanceof $.Vector&&(k=_e.pointInCircle(E,h)),y.UUID in this.collisions?T.UUID in this.collisions[y.UUID]||(this.collisions[y.UUID][T.UUID]=!1):this.collisions[y.UUID]={[T.UUID]:!1},k?(this.collisions[y.UUID][T.UUID]||(y.OnEnterCollision(T,c),T.OnEnterCollision(y,c)),this.collisions[y.UUID][T.UUID]=!0,y.Collision(T,c),T.Collision(y,c)):(this.collisions[y.UUID][T.UUID]&&(y.OnExitCollision(T,c),T.OnExitCollision(y,c)),this.collisions[y.UUID][T.UUID]=!1)}})}(t=this.level.GetRoom())==null||t.Update(i),Pe.IsKeyPressedOnce("F1")&&(this.debug.Grid=!((s=this.debug)!=null&&s.Grid),console.log("DEBUG Grid is now",this.debug.Grid?"enabled":"disabled")),Pe.IsKeyPressedOnce("F2")&&(this.debug.Hitspheres=!((r=this.debug)!=null&&r.Hitspheres),console.log("DEBUG Hitspheres is now",this.debug.Hitspheres?"enabled":"disabled")),Pe.IsKeyPressedOnce("F3")&&(this.debug.AStarGrid=!((a=this.debug)!=null&&a.AStarGrid),console.log("DEBUG A* Grid is now",this.debug.AStarGrid?"enabled":"disabled"))}debugDrawGrid(){}debugDrawAStarGrid(){const i=this.level.GetRoom();if(!i)return;const t=30,s=18,r=13,a=26,l=26,c=[];for(let v=0;v<s;v++){c[v]=[];for(let h=0;h<t;h++)c[v][h]=1}for(let v=0;v<2;v++)for(let h=0;h<t;h++)c[v][h]=0;for(let v=s-2;v<s;v++)for(let h=0;h<t;h++)c[v][h]=0;for(let v=0;v<s;v++)for(let h=0;h<2;h++)c[v][h]=0;for(let v=0;v<s;v++)for(let h=t-2;h<t;h++)c[v][h]=0;i.GetEntities().forEach(v=>{if(v instanceof ye){const h=v.GetCollisionClass();if(h===te.SOLID||h===te.OBJECT||h===te.WALL){const x=Math.floor((v.Position.x-a)/26)*2,g=Math.floor((v.Position.y-l)/26)*2;for(let T=g;T<g+2&&T<s;T++)for(let E=x;E<x+2&&E<t;E++)T>=0&&E>=0&&(c[T][E]=0)}}}),C.context.save(),C.context.globalAlpha=.5;for(let v=0;v<s;v++)for(let h=0;h<t;h++){const b=a+h*r,x=l+v*r;c[v][h]===0?C.context.fillStyle="#ff0000":C.context.fillStyle="#00ff00",C.context.fillRect(b,x,r,r),C.context.strokeStyle="#ffffff",C.context.lineWidth=1,C.context.strokeRect(b,x,r,r)}C.context.restore()}};m(Le,"TRANSITION_IN",0),m(Le,"RENDER",1),m(Le,"TRANSITION_OUT",1),m(Le,"instance");let ft=Le;const he=ft.initalize(),Di=["Position","Color","TexCoord","RenderData","Scale"];class zt{constructor(){m(this,"gl",null)}initGL(e){const i={preserveDrawingBuffer:!0,alpha:!0,antialias:!1,premultipliedAlpha:!1};if(this.gl=e.getContext("webgl2",i),!this.gl)throw new Error("WebGL 2.0 not supported");return console.log("[ShaderCompiler] WebGL 2.0 context initialized"),!0}getContext(){return this.gl}preprocessShader(e,i){const t=e.includes("#version 300 es");e=e.replace(/(\d+\.\d+)f\b/g,"$1"),e=e.replace(/(\d+)f\b/g,"$1.0"),t||(i==="vertex"&&(e=e.replace(/\battribute\b/g,"in"),e=e.replace(/\bvarying\b/g,"out")),i==="fragment"&&(e=e.replace(/\bvarying\b/g,"in"),e.includes("gl_FragColor")&&(e=e.replace(/\bgl_FragColor\b/g,"FragColor"))),e=e.replace(/\btexture2D\b/g,"texture"),e=e.replace(/\btextureCube\b/g,"texture"));let s=`#version 300 es
`;return i==="fragment"&&(e=e.replace(/precision\s+(lowp|mediump|highp)\s+float\s*;/g,""),s+=`precision mediump float;
`,!e.includes("out vec4 FragColor")&&!e.includes("layout")&&(s+=`out vec4 FragColor;
`)),e=s+e,e}createShader(e,i,t){if(!this.gl)throw new Error("WebGL not initialized");i=this.preprocessShader(i,t);const s=this.gl.createShader(e);if(!s)throw new Error(`Failed to create ${t} shader`);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const r=this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),new Error(`${t} shader error: ${r}`)}return s}createProgram(e,i){if(!this.gl)throw new Error("WebGL not initialized");const t=this.createShader(this.gl.VERTEX_SHADER,e,"vertex"),s=this.createShader(this.gl.FRAGMENT_SHADER,i,"fragment"),r=this.gl.createProgram();if(!r)throw new Error("Failed to create shader program");if(this.gl.attachShader(r,t),this.gl.attachShader(r,s),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS)){const a=this.gl.getProgramInfoLog(r);throw this.gl.deleteProgram(r),new Error("Program linking error: "+a)}return r}validateIsaacShader(e,i,t){const s={valid:!0,warnings:[],errors:[]},r=this.extractDeclarations(e,"attribute"),a=this.extractDeclarations(e,"in"),l=[...r,...a],c=this.extractDeclarations(e,"varying"),y=this.extractDeclarations(e,"out"),v=[...c,...y],h=this.extractDeclarations(i,"varying"),b=this.extractDeclarations(i,"in"),x=[...h,...b],g=this.extractDeclarations(i,"uniform"),T=this.extractMainBody(e);for(const E of Di)l.includes(E)||s.warnings.push(`Vertex shader missing required attribute: ${E}`);for(const E of v)x.includes(E)||s.warnings.push(`Varying "${E}" is declared in vertex shader but not in fragment shader.`);for(const E of x)v.includes(E)||s.warnings.push(`Varying "${E}" is declared in fragment shader but not in vertex shader.`);for(const E of t){if(!l.includes(E)){s.errors.push(`Custom parameter "${E}" must be declared as an attribute in the vertex shader. Isaac passes custom params as vertex attributes, not uniforms.`),s.valid=!1;continue}if(g.includes(E)){s.errors.push(`Custom parameter "${E}" cannot be a uniform in the fragment shader. Isaac only passes custom params through vertex attributes  varyings. Use "varying" instead of "uniform" and receive it from the vertex shader.`),s.valid=!1;continue}this.isAttributeUsedInMain(T,E)||s.warnings.push(`Custom parameter "${E}" is declared but not used in the vertex shader's main() function.`)}return s}extractMainBody(e){const i=e.match(/void\s+main\s*\(\s*(?:void)?\s*\)\s*\{/);if(!i)return"";const t=i.index+i[0].length;let s=1,r=t;for(let a=t;a<e.length&&s>0;a++)e[a]==="{"?s++:e[a]==="}"&&s--,r=a;return e.substring(t,r)}isAttributeUsedInMain(e,i){return new RegExp(`\\b${i}\\b`).test(e)}extractDeclarations(e,i){const t=[],s=new RegExp(`\\b${i}\\s+(?:lowp|mediump|highp)?\\s*(?:float|vec2|vec3|vec4|mat4|sampler2D)\\s+(\\w+)\\s*;`,"g");let r;for(;(r=s.exec(e))!==null;)t.push(r[1]);return t}getVaryingType(e,i){const t=new RegExp(`\\b(?:attribute|in)\\s+(float|vec2|vec3|vec4)\\s+${e}\\s*;`),s=i.match(t);return s?s[1]:"float"}}class qt{constructor(){m(this,"paramDefinitions",[]);m(this,"shaderParams",{});m(this,"paramsPanel",null);m(this,"paramsList",null)}initialize(e,i){this.paramsPanel=e,this.paramsList=i}getParamDefinitions(){return this.paramDefinitions}getShaderParams(){return this.shaderParams}setParameter(e,i){this.shaderParams[e]=i}setParamDefinitions(e){this.paramDefinitions=e}addParameter(e="",i="float",t="",s,r,a,l,c,y){if(!this.paramsList)return;const v=document.createElement("div");v.className="param-item";const h=document.createElement("input");h.type="text",h.placeholder="Name",h.value=e,h.dataset.field="name";const b=document.createElement("select");b.dataset.field="type",[{value:"float",label:"Float"},{value:"vec2",label:"Vec2"},{value:"vec3",label:"Vec3"},{value:"vec4",label:"Vec4"},{value:"boolean",label:"Boolean"},{value:"time",label:"Time (Auto)"},{value:"playerpos",label:"Player Position (Auto)"},{value:"tearpos",label:"Tear Position (Auto)"},{value:"mousepos",label:"Mouse Position (Debug)"},{value:"color",label:"Color"}].forEach(A=>{const u=document.createElement("option");u.value=A.value,u.textContent=A.label,A.value===i&&(u.selected=!0),b.appendChild(u)});const g=document.createElement("input");g.type="text",g.placeholder="Default",g.value=t,g.dataset.field="default",g.style.width="60px";const T=document.createElement("input");T.type="text",T.placeholder="Min",T.value=s!==void 0?s.toString():"",T.dataset.field="min",T.style.width="40px",T.title="Minimum value";const E=document.createElement("input");E.type="text",E.placeholder="Max",E.value=r!==void 0?r.toString():"",E.dataset.field="max",E.style.width="40px",E.title="Maximum value";const k=document.createElement("input");k.type="text",k.placeholder="Step",k.value=a!==void 0?a.toString():"",k.dataset.field="step",k.style.width="40px",k.title="Step increment";const D=document.createElement("input");D.type="number",D.placeholder="FPS",D.value=l!==void 0?l.toString():"60",D.dataset.field="fps",D.style.width="50px",D.title="Target FPS (Isaac runs at 60fps)",D.min="1",D.max="120";const _=document.createElement("select");_.dataset.field="coordinateSpace",_.title="Coordinate space",[{value:"screen",label:"Screen"},{value:"world",label:"World"}].forEach(A=>{const u=document.createElement("option");u.value=A.value,u.textContent=A.label,A.value===(c||"screen")&&(u.selected=!0),_.appendChild(u)});const G=document.createElement("input");G.type="number",G.placeholder="Index",G.value=y!==void 0?y.toString():"1",G.dataset.field="index",G.style.width="50px",G.title="Tear index (1 = first tear, 2 = second, etc.)",G.min="1",G.max="10";const O=document.createElement("button");O.className="remove-param-btn",O.textContent="",O.onclick=()=>{var A;(A=this.paramsList)==null||A.removeChild(v)};const L=()=>{const A=b.value,u=["time","mousepos","playerpos","tearpos","boolean"],R=A==="float",I=u.includes(A),U=A==="color",F=A==="time",W=A==="playerpos",B=A==="tearpos";g.style.display=I&&!U?"none":"block",U?(g.type="color",g.style.width="50px",g.style.padding="0",g.style.height="24px",g.style.cursor="pointer",(!g.value||!g.value.startsWith("#"))&&(g.value="#ffffff")):(g.type="text",g.style.width="60px",g.style.padding="4px 8px",g.style.height="",g.style.cursor=""),T.style.display=R?"block":"none",E.style.display=R?"block":"none",k.style.display=R?"block":"none",D.style.display=F?"block":"none",_.style.display=W?"block":"none",G.style.display=B?"block":"none"};b.addEventListener("change",L),L(),v.appendChild(h),v.appendChild(b),v.appendChild(g),v.appendChild(T),v.appendChild(E),v.appendChild(k),v.appendChild(D),v.appendChild(_),v.appendChild(G),v.appendChild(O),this.paramsList.appendChild(v)}collectParamDefinitions(){if(this.paramDefinitions=[],!this.paramsList)return;this.paramsList.querySelectorAll(".param-item").forEach(i=>{const t=i.querySelector('input[data-field="name"]'),s=i.querySelector('select[data-field="type"]'),r=i.querySelector('input[data-field="default"]'),a=i.querySelector('input[data-field="min"]'),l=i.querySelector('input[data-field="max"]'),c=i.querySelector('input[data-field="step"]'),y=i.querySelector('input[data-field="fps"]'),v=i.querySelector('select[data-field="coordinateSpace"]'),h=i.querySelector('input[data-field="index"]'),b=(t==null?void 0:t.value.trim())||"",x=(s==null?void 0:s.value)||"float",g=(r==null?void 0:r.value.trim())||"",T=a==null?void 0:a.value.trim(),E=l==null?void 0:l.value.trim(),k=c==null?void 0:c.value.trim(),D=y==null?void 0:y.value.trim(),_=v==null?void 0:v.value,P=h==null?void 0:h.value.trim();if(b){const G={name:b,type:x,default:g||void 0};x==="float"&&(T&&(G.min=parseFloat(T)),E&&(G.max=parseFloat(E)),k&&(G.step=parseFloat(k))),x==="time"&&(G.fps=D?parseInt(D,10):60),x==="playerpos"&&(G.coordinateSpace=_||"screen"),x==="tearpos"&&(G.index=P?parseInt(P,10):1),this.paramDefinitions.push(G)}})}createParameterControls(e=!1){if(!this.paramsPanel)return;const i=e?{...this.shaderParams}:{};if(this.paramsPanel.innerHTML="",this.shaderParams={},this.paramDefinitions.length===0){this.paramsPanel.classList.remove("active");return}this.paramsPanel.classList.add("active"),this.paramDefinitions.forEach(t=>{if(t.type==="time"||t.type==="mousepos"||t.type==="playerpos"||t.type==="tearpos")return;const s=document.createElement("div");if(s.className="param-control",t.type==="boolean"){const a=i[t.name],l=a!==void 0?a:1;this.shaderParams[t.name]=l;const c=l!==0;s.innerHTML=`
                    <span class="param-label">${t.name}:</span>
                    <input type="checkbox" class="param-checkbox" ${c?"checked":""} data-param="${t.name}">
                    <span class="param-value" style="color: ${c?"#89d185":"#f48771"}">${c?"ON":"OFF"}</span>
                `}else if(t.type==="color"){const a=i[t.name];let l;if(a&&Array.isArray(a))l=a;else{const y=t.default||this.getDefaultValue(t.type);l=this.parseParamValue(t.type,y)}this.shaderParams[t.name]=l;const c=this.vec3ToHex(l);s.innerHTML=`
                    <span class="param-label">${t.name}:</span>
                    <div class="color-picker-wrapper">
                        <div class="color-swatch" style="background-color: ${c};" title="Click to change color"></div>
                        <input type="color" class="color-input" value="${c}">
                    </div>
                    <span class="param-value">${l.map(y=>y.toFixed(2)).join(", ")}</span>
                `}else{const a=i[t.name];if(a!==void 0)this.shaderParams[t.name]=a;else{const l=t.default||this.getDefaultValue(t.type);this.shaderParams[t.name]=this.parseParamValue(t.type,l)}if(t.type==="float"){const l=this.shaderParams[t.name],c=t.min??0,y=t.max??2,v=t.step??.1,h=this.getDecimalPlaces(v);s.innerHTML=`
                        <span class="param-label">${t.name}:</span>
                        <input type="range" class="param-input" min="${c}" max="${y}" step="${v}" value="${l}">
                        <span class="param-value">${l.toFixed(h)}</span>
                    `}else{const l=this.shaderParams[t.name];s.innerHTML=`
                        <span class="param-label">${t.name}:</span>
                        <input type="text" class="param-input" value="${l.join(", ")}" placeholder="${t.type}">
                    `}}this.paramsPanel.appendChild(s);const r=s.querySelector(".param-checkbox, .param-input, .color-input");if(r)if(t.type==="boolean"){const a=s.querySelector(".param-value");r.addEventListener("change",l=>{const c=l.target.checked;this.shaderParams[t.name]=c?1:0,a.textContent=c?"ON":"OFF",a.style.color=c?"#89d185":"#f48771"})}else if(t.type==="color"){const a=s.querySelector(".color-swatch"),l=s.querySelector(".param-value");a.addEventListener("click",()=>r.click()),r.addEventListener("input",c=>{const y=c.target.value,v=this.hexToVec3(y);this.shaderParams[t.name]=v,a.style.backgroundColor=y,l.textContent=v.map(h=>h.toFixed(2)).join(", ")})}else if(t.type==="float"){const a=s.querySelector(".param-value"),l=this.getDecimalPlaces(t.step??.1);r.addEventListener("input",c=>{const y=parseFloat(c.target.value);this.shaderParams[t.name]=y,a.textContent=y.toFixed(l)})}else r.addEventListener("change",a=>{const l=this.parseParamValue(t.type,a.target.value);l&&(this.shaderParams[t.name]=l)})})}clearParameters(){this.paramsList&&(this.paramsList.innerHTML=""),this.paramDefinitions=[],this.shaderParams={}}loadParameters(e){this.clearParameters(),e.forEach(i=>{this.addParameter(i.name,i.type,i.default||"",i.min,i.max,i.step,i.fps,i.coordinateSpace,i.index)})}getDefaultValue(e){switch(e){case"float":return"1.0";case"vec2":return"0.5,0.5";case"vec3":return"1.0,1.0,1.0";case"vec4":return"1.0,1.0,1.0,1.0";case"color":return"#ffffff";default:return"0.0"}}parseParamValue(e,i){if(!i)return null;switch(e){case"float":case"boolean":return parseFloat(i);case"vec2":case"vec3":case"vec4":return i.split(",").map(t=>parseFloat(t.trim()));case"color":return this.hexToVec3(i);default:return null}}hexToVec3(e){let i=e.replace("#","");i.length===3&&(i=i.split("").map(a=>a+a).join(""));const t=parseInt(i.substring(0,2),16)/255,s=parseInt(i.substring(2,4),16)/255,r=parseInt(i.substring(4,6),16)/255;return[t,s,r]}vec3ToHex(e){const i=Math.round(Math.max(0,Math.min(1,e[0]))*255),t=Math.round(Math.max(0,Math.min(1,e[1]))*255),s=Math.round(Math.max(0,Math.min(1,e[2]))*255);return"#"+[i,t,s].map(r=>r.toString(16).padStart(2,"0")).join("")}getDecimalPlaces(e){if(e>=1)return 0;const i=e.toString(),t=i.indexOf(".");return t===-1?0:i.length-t-1}setUniform(e,i,t,s,r){const a=e.getUniformLocation(i,t);if(a)switch(s){case"float":case"boolean":e.uniform1f(a,r);break;case"vec2":e.uniform2fv(a,r);break;case"vec3":e.uniform3fv(a,r);break;case"vec4":e.uniform4fv(a,r);break}}}class Yt{constructor(e){m(this,"gl",null);m(this,"program",null);m(this,"texture",null);m(this,"canvas",null);m(this,"paramManager");m(this,"isPlaying",!1);m(this,"frameCount",0);m(this,"startTime",0);m(this,"elapsedTime",0);m(this,"lastFpsUpdate",Date.now());m(this,"fpsFrameCount",0);m(this,"currentFps",0);m(this,"animationId",null);m(this,"attributeBuffers",[]);m(this,"parameterAttributeBuffers",[]);m(this,"gameState",{bufferCanvas:null,playerPosition:{x:.5,y:.5},playerPositionWorld:{x:.5,y:.5},canvasWidth:286,canvasHeight:442,tearPositions:[]});m(this,"mousePosition",{x:884,y:572});m(this,"onFpsUpdate",null);m(this,"onFrameUpdate",null);this.paramManager=e}initialize(e,i){this.gl!==e&&(this.texture=null,this.attributeBuffers=[],this.parameterAttributeBuffers=[],this.program=null),this.gl=e,this.canvas=i}setProgram(e){this.program=e}setupGeometry(){if(!this.gl||!this.program||!this.canvas)return;this.attributeBuffers=[],this.parameterAttributeBuffers=[];const e=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),i=new Float32Array([0,1,1,1,0,0,1,0]),t=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),s=new Float32Array([.5,.5,.5,.5]),r=this.canvas.width*2,a=this.canvas.height*2,l=this.canvas.width*2,c=this.canvas.height*2,y=new Float32Array([r,a,l,c,r,a,l,c,r,a,l,c,r,a,l,c]);this.createAttribute("Position",e,3),this.createAttribute("TexCoord",i,2),this.createAttribute("Color",t,4),this.createAttribute("Scale",s,1),this.createAttribute("RenderData",y,4),console.log("[ShaderRenderer] Geometry setup complete, buffers:",this.attributeBuffers.length)}setupParameterAttributes(e){if(!this.gl||!this.program)return;const i=["Position","Color","TexCoord","RenderData","Scale"],t=/(?:attribute|in)\s+(float|vec2|vec3|vec4)\s+(\w+)\s*;/g;let s;for(;(s=t.exec(e))!==null;){const r=s[1],a=s[2];if(i.includes(a))continue;const l=this.gl.getAttribLocation(this.program,a);if(l<0){console.log("[ShaderRenderer] Parameter attribute",a,"not found in program (may be optimized out)");continue}let c=1;switch(r){case"float":c=1;break;case"vec2":c=2;break;case"vec3":c=3;break;case"vec4":c=4;break}const y=this.gl.createBuffer();if(!y){console.error("[ShaderRenderer] Failed to create buffer for parameter attribute",a);continue}const v=new Float32Array(4*c);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,y),this.gl.bufferData(this.gl.ARRAY_BUFFER,v,this.gl.DYNAMIC_DRAW),this.parameterAttributeBuffers.push({buffer:y,location:l,size:c,paramName:a,paramType:r}),console.log("[ShaderRenderer] Created parameter attribute buffer:",a,"type:",r,"location:",l)}console.log("[ShaderRenderer] Parameter attribute buffers created:",this.parameterAttributeBuffers.length)}updateParameterAttributeBuffers(){if(!this.gl||this.parameterAttributeBuffers.length===0)return;const e=this.paramManager.getShaderParams(),i=this.paramManager.getParamDefinitions();for(const t of this.parameterAttributeBuffers){let s=null;const r=i.find(l=>l.name===t.paramName);if((r==null?void 0:r.type)==="time"){const l=r.fps||60;l===60?s=this.frameCount:s=Math.floor(this.frameCount*l/60)}else if((r==null?void 0:r.type)==="playerpos"){const l=r.coordinateSpace==="world"?this.gameState.playerPositionWorld:this.gameState.playerPosition;s=[l.x,l.y]}else if((r==null?void 0:r.type)==="mousepos")s=[this.mousePosition.x,this.mousePosition.y];else if((r==null?void 0:r.type)==="tearpos"){const l=(r.index||1)-1,c=this.gameState.tearPositions[l];c?s=[c.x,c.y]:s=[0,0]}else e[t.paramName]!==void 0?s=e[t.paramName]:r!=null&&r.default?t.size===1?s=parseFloat(r.default):s=r.default.split(",").map(l=>parseFloat(l.trim())):s=t.size===1?0:new Array(t.size).fill(0);const a=new Float32Array(4*t.size);for(let l=0;l<4;l++)if(typeof s=="number")a[l*t.size]=s;else if(Array.isArray(s))for(let c=0;c<t.size&&c<s.length;c++)a[l*t.size+c]=s[c];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.buffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,a)}}createAttribute(e,i,t){if(!this.gl||!this.program)return;const s=this.gl.createBuffer();if(!s){console.error("[ShaderRenderer] Failed to create buffer for",e);return}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);const r=this.gl.getAttribLocation(this.program,e);console.log("[ShaderRenderer] Attribute",e,"location:",r),r>=0&&this.attributeBuffers.push({buffer:s,location:r,size:t})}bindAttributes(){if(this.gl){for(const e of this.attributeBuffers)this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.size,this.gl.FLOAT,!1,0,0);for(const e of this.parameterAttributeBuffers)this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.size,this.gl.FLOAT,!1,0,0)}}loadTextureFromCanvas(e){this.gl&&(this.texture||(this.texture=this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST))}updateTexture(e){if(this.gl){if(!this.texture){this.loadTextureFromCanvas(e);return}this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)}}updateGameState(e){Object.assign(this.gameState,e)}setPlayerPosition(e,i){this.gameState.playerPosition={x:e,y:i}}setMousePosition(e,i){this.mousePosition={x:e,y:i}}render(){if(!this.gl||!this.program||!this.canvas||!this.isPlaying)return;if(this.frameCount<3&&console.log("[ShaderRenderer] render() frame",this.frameCount,"bufferCanvas:",!!this.gameState.bufferCanvas,"texture:",!!this.texture,"buffers:",this.attributeBuffers.length),this.gameState.bufferCanvas){if(this.frameCount<5){const s=this.gameState.bufferCanvas.getContext("2d");if(s){const r=this.gameState.bufferCanvas.width,a=this.gameState.bufferCanvas.height,l=Math.floor(r/2)-5,c=Math.floor(a/2)-5,y=s.getImageData(l,c,10,10);let v=0,h=0,b=0,x=0,g=0;for(let T=0;T<y.data.length;T+=4)(y.data[T]>0||y.data[T+1]>0||y.data[T+2]>0)&&(v++,h===0&&b===0&&x===0&&(h=y.data[T],b=y.data[T+1],x=y.data[T+2],g=y.data[T+3]));console.log("[ShaderRenderer] Buffer canvas CENTER check: colored pixels:",v,"sample RGBA:",h,b,x,g,"at",l,c)}}this.updateTexture(this.gameState.bufferCanvas),this.frameCount<3&&console.log("[ShaderRenderer] Updated texture from canvas",this.gameState.bufferCanvas.width,"x",this.gameState.bufferCanvas.height)}if(!this.texture){this.frameCount<3&&console.log("[ShaderRenderer] No texture yet, skipping frame"),this.animationId=requestAnimationFrame(()=>this.render());return}if(this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.CULL_FACE),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.useProgram(this.program),this.updateParameterAttributeBuffers(),this.bindAttributes(),this.frameCount<3){const s=this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS);console.log("[ShaderRenderer] Program link status:",s)}const e=this.gl.getUniformLocation(this.program,"Transform");if(this.frameCount<3&&console.log("[ShaderRenderer] Transform uniform location:",e),e){const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.gl.uniformMatrix4fv(e,!1,s)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture);const i=this.gl.getUniformLocation(this.program,"Texture0");if(this.frameCount<3&&console.log("[ShaderRenderer] Texture0 uniform location:",i),i&&this.gl.uniform1i(i,0),this.frameCount<3){const s=this.gl.getParameter(this.gl.CURRENT_PROGRAM);console.log("[ShaderRenderer] Current program before draw:",s===this.program?"correct":"WRONG");for(const r of this.attributeBuffers){const a=this.gl.getVertexAttrib(r.location,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED);console.log("[ShaderRenderer] Attribute",r.location,"enabled:",a)}}if(this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.frameCount<3){const s=this.gl.getError();console.log("[ShaderRenderer] GL Error after draw:",s===this.gl.NO_ERROR?"none":s);const r=new Uint8Array(4*10*10),a=Math.floor(this.canvas.width/2)-5,l=Math.floor(this.canvas.height/2)-5;this.gl.readPixels(a,l,10,10,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),console.log("[ShaderRenderer] WebGL canvas center pixels - first pixel RGBA:",r[0],r[1],r[2],r[3],"non-black count:",Array.from(r).filter((y,v)=>v%4<3&&y>0).length);const c=window.getComputedStyle(this.canvas);console.log("[ShaderRenderer] Canvas visibility check:","display:",c.display,"visibility:",c.visibility,"opacity:",c.opacity,"zIndex:",c.zIndex,"position:",c.position),console.log("[ShaderRenderer] Canvas rect:",this.canvas.getBoundingClientRect())}this.frameCount++,this.fpsFrameCount++,this.elapsedTime=(performance.now()-this.startTime)/1e3;const t=Date.now();t-this.lastFpsUpdate>=1e3&&(this.currentFps=this.fpsFrameCount,this.fpsFrameCount=0,this.lastFpsUpdate=t,this.onFpsUpdate&&this.onFpsUpdate(this.currentFps)),this.onFrameUpdate&&this.onFrameUpdate(this.frameCount),this.animationId=requestAnimationFrame(()=>this.render())}startRendering(){this.isPlaying||(this.isPlaying=!0,this.frameCount=0,this.startTime=performance.now(),this.elapsedTime=0,this.render())}stopRendering(){this.isPlaying&&(this.isPlaying=!1,this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null))}isActive(){return this.isPlaying}getFrameCount(){return this.frameCount}getFps(){return this.currentFps}}var Ie;let Kt=(Ie=class{constructor(){m(this,"compiler");m(this,"paramManager");m(this,"renderer");m(this,"vertexEditor",null);m(this,"fragmentEditor",null);m(this,"errorMarkerId",null);m(this,"metadataEditor",null);m(this,"luaEditor",null);m(this,"xmlEditor",null);m(this,"modalOpen",!1);m(this,"glCanvas",null);m(this,"consoleEl",null);m(this,"viewportControls",null);m(this,"fpsDisplay",null);m(this,"frameDisplay",null);m(this,"playerPosDisplay",null);m(this,"playPauseBtn",null);m(this,"shaderNameInput",null);m(this,"shaderDescriptionInput",null);m(this,"enabled",!1);m(this,"initialized",!1);m(this,"autoCompiled",!1);m(this,"currentVertexSource","");m(this,"currentFragmentSource","");m(this,"shaderManifest",[]);m(this,"shaderCache",{});m(this,"exampleSelect",null);m(this,"deleteShaderBtn",null);m(this,"savedShaders",[]);m(this,"currentLoadedShaderId",null);m(this,"currentCustomLua",null);m(this,"lastSavedState",null);m(this,"importModal",null);m(this,"importDropZone",null);m(this,"importFileInput",null);m(this,"importValidationError",null);m(this,"importShaderListContainer",null);m(this,"importShaderList",null);m(this,"importShaderCount",null);m(this,"importSelectAll",null);m(this,"importShadersBtn",null);m(this,"parsedShadersForImport",[]);m(this,"defaultShader",{name:"",params:[],vertex:`attribute vec3 Position;
attribute vec4 Color;
attribute vec2 TexCoord;
attribute vec4 RenderData;
attribute float Scale;

uniform mat4 Transform;

varying vec4 Color0;
varying vec2 TexCoord0;
varying vec4 RenderDataOut;
varying float ScaleOut;

void main(void) {
    Color0 = Color;
    TexCoord0 = TexCoord;
    RenderDataOut = RenderData;
    ScaleOut = Scale;
    gl_Position = Transform * vec4(Position.xyz, 1.0);
}`,fragment:`varying lowp vec4 Color0;
varying mediump vec2 TexCoord0;
varying lowp vec4 RenderDataOut;
varying lowp float ScaleOut;

uniform sampler2D Texture0;

void main(void) {
    gl_FragColor = Color0 * texture2D(Texture0, TexCoord0);
}`});this.compiler=new zt,this.paramManager=new qt,this.renderer=new Yt(this.paramManager)}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}static isEnabled(){var e;return((e=Ie.instance)==null?void 0:e.enabled)??!1}disable(){console.log("[ShaderStudio] Resetting to passthrough shader"),this.compileWithCode(this.defaultShader.vertex,this.defaultShader.fragment,[])}initialize(){if(console.log("[ShaderStudio] initialize() called, already initialized:",this.initialized),this.initialized)return;this.glCanvas=document.getElementById("glCanvas"),console.log("[ShaderStudio] glCanvas:",this.glCanvas),this.glCanvas&&(this.glCanvas.addEventListener("focus",()=>{const t=new CustomEvent("focus",{detail:{state:!0}});document.dispatchEvent(t)}),this.glCanvas.addEventListener("blur",()=>{const t=new CustomEvent("focus",{detail:{state:!1}});document.dispatchEvent(t)}),this.glCanvas.addEventListener("mousemove",t=>{const s=this.glCanvas.getBoundingClientRect(),r=(t.clientX-s.left)/s.width*442,a=(t.clientY-s.top)/s.height*286,l=-2,c=r*4,y=(a+l)*4;this.renderer.setMousePosition(c,y)})),this.consoleEl=document.getElementById("shaderConsole"),this.viewportControls=document.getElementById("viewportControls"),this.fpsDisplay=document.getElementById("fpsDisplay"),this.frameDisplay=document.getElementById("frameDisplay"),this.playerPosDisplay=document.getElementById("playerPosDisplay"),this.playPauseBtn=document.getElementById("playPauseBtn"),this.shaderNameInput=document.getElementById("shaderName"),this.shaderDescriptionInput=document.getElementById("shaderDescription");const e=document.getElementById("paramsPanel"),i=document.getElementById("paramsList");e&&i&&this.paramManager.initialize(e,i),typeof ace<"u"&&this.initializeEditors(),this.setupEventListeners(),this.renderer.onFpsUpdate=t=>{this.fpsDisplay&&(this.fpsDisplay.textContent=t.toString())},this.renderer.onFrameUpdate=t=>{this.frameDisplay&&(this.frameDisplay.textContent=t.toString())},this.initialized=!0,this.logConsole("Shader Studio initialized. Game preview will be used as texture source.","info")}refreshCanvas(){const e=document.getElementById("glCanvas");if(e&&e!==this.glCanvas){console.log("[ShaderStudio] refreshCanvas: updating canvas reference");const i=this.enabled;if(this.glCanvas=e,this.glCanvas.addEventListener("focus",()=>{const t=new CustomEvent("focus",{detail:{state:!0}});document.dispatchEvent(t)}),this.glCanvas.addEventListener("blur",()=>{const t=new CustomEvent("focus",{detail:{state:!1}});document.dispatchEvent(t)}),this.glCanvas.addEventListener("mousemove",t=>{const s=this.glCanvas.getBoundingClientRect(),r=(t.clientX-s.left)/s.width*442,a=(t.clientY-s.top)/s.height*286,l=-2,c=r*4,y=(a+l)*4;this.renderer.setMousePosition(c,y)}),i&&this.currentVertexSource&&this.currentFragmentSource){console.log("[ShaderStudio] refreshCanvas: recompiling shader for new context"),this.compiler.initGL(this.glCanvas);const t=this.compiler.getContext();if(t){const s=this.compiler.createProgram(this.currentVertexSource,this.currentFragmentSource);s&&(this.renderer.initialize(t,this.glCanvas),this.renderer.setProgram(s),this.renderer.setupGeometry(),this.renderer.setupParameterAttributes(this.currentVertexSource),this.enabled=!0,this.renderer.startRendering(),console.log("[ShaderStudio] refreshCanvas: shader recompiled successfully"))}}}}initializeEditors(){const e=document.getElementById("vertexEditor"),i=document.getElementById("fragmentEditor");e&&(this.vertexEditor=ace.edit("vertexEditor"),this.vertexEditor.setTheme("ace/theme/monokai"),this.vertexEditor.session.setMode("ace/mode/glsl"),this.vertexEditor.setFontSize("13px"),this.vertexEditor.setValue(this.defaultShader.vertex,-1),this.vertexEditor.setOptions({showPrintMargin:!1,highlightActiveLine:!0,showGutter:!0})),i&&(this.fragmentEditor=ace.edit("fragmentEditor"),this.fragmentEditor.setTheme("ace/theme/monokai"),this.fragmentEditor.session.setMode("ace/mode/glsl"),this.fragmentEditor.setFontSize("13px"),this.fragmentEditor.setValue(this.defaultShader.fragment,-1),this.fragmentEditor.setOptions({showPrintMargin:!1,highlightActiveLine:!0,showGutter:!0}))}setupEventListeners(){const e=document.getElementById("compileBtn"),i=document.getElementById("viewModBtn"),t=document.getElementById("saveShaderBtn");this.exampleSelect=document.getElementById("exampleSelect"),this.deleteShaderBtn=document.getElementById("deleteShaderBtn");const s=document.getElementById("addParamBtn");e&&e.addEventListener("click",()=>this.compile()),i&&i.addEventListener("click",()=>this.openViewModModal()),t&&t.addEventListener("click",()=>this.saveShader()),this.deleteShaderBtn&&this.deleteShaderBtn.addEventListener("click",()=>this.deleteCurrentShader());const r=document.getElementById("closeModalBtn"),a=document.getElementById("downloadModBtn"),l=document.getElementById("viewModModal");if(r&&r.addEventListener("click",()=>this.closeViewModModal()),a&&a.addEventListener("click",()=>this.downloadMod()),l&&l.addEventListener("click",c=>{c.target===l&&this.closeViewModModal()}),this.setupImportModalListeners(),this.exampleSelect){let c=this.exampleSelect.value;this.exampleSelect.addEventListener("change",y=>{const v=y.target,h=v.value;if(h==="__import__"){this.openImportModal(),v.value=c;return}if(!this.confirmUnsavedChanges("load a different shader")){v.value=c;return}if(h)if(h.startsWith("saved:")){const b=h.substring(6);this.loadSavedShader(b)}else this.loadExample(h);else this.loadNewShader();c=h,this.updateDeleteButtonVisibility()})}s&&s.addEventListener("click",()=>{this.paramManager.addParameter()}),this.playPauseBtn&&this.playPauseBtn.addEventListener("click",()=>{this.renderer.isActive()?(this.renderer.stopRendering(),this.playPauseBtn.textContent="",this.logConsole("Paused","info")):(this.renderer.startRendering(),this.playPauseBtn.textContent="",this.logConsole("Playing","info"))}),this.setupEditorTabs(),this.loadSavedShadersFromStorage(),this.loadShaderManifest(),window.addEventListener("beforeunload",c=>{if(this.hasUnsavedChanges())return c.preventDefault(),c.returnValue="",""})}setupEditorTabs(){const e=document.querySelectorAll(".editor-tab"),i=document.querySelectorAll(".editor-tab-pane");e.forEach(t=>{t.addEventListener("click",()=>{const s=t.getAttribute("data-editor-tab");e.forEach(r=>r.classList.remove("active")),t.classList.add("active"),i.forEach(r=>{r.getAttribute("data-editor-tab")===s?r.classList.add("active"):r.classList.remove("active")}),s==="vertex"&&this.vertexEditor?this.vertexEditor.resize():s==="fragment"&&this.fragmentEditor&&this.fragmentEditor.resize()})})}async loadShaderManifest(){try{const e=await fetch("./shaders/manifest.json");if(!e.ok)throw new Error(`Failed to load manifest: ${e.status}`);const i=await e.json();this.shaderManifest=i.shaders,this.populateExampleDropdown(),this.logConsole(`Loaded ${this.shaderManifest.length} shader examples`,"info")}catch(e){console.error("[ShaderStudio] Failed to load shader manifest:",e),this.logConsole("Failed to load shader manifest, using defaults","warning")}}loadSavedShadersFromStorage(){try{const e=localStorage.getItem(Ie.STORAGE_KEY);e&&(this.savedShaders=JSON.parse(e),console.log(`[ShaderStudio] Loaded ${this.savedShaders.length} saved shaders from storage`))}catch(e){console.error("[ShaderStudio] Failed to load saved shaders:",e),this.savedShaders=[]}}saveShadersToStorage(){try{localStorage.setItem(Ie.STORAGE_KEY,JSON.stringify(this.savedShaders))}catch(e){console.error("[ShaderStudio] Failed to save shaders to storage:",e),this.logConsole("Failed to save to browser storage","error")}}saveShader(){var v,h,b,x,g,T;const e=(h=(v=this.shaderNameInput)==null?void 0:v.value)==null?void 0:h.trim();if(!e){this.logConsole("Please enter a shader name before saving","error");return}this.paramManager.collectParamDefinitions();const i=this.paramManager.getParamDefinitions(),t=((b=this.vertexEditor)==null?void 0:b.getValue())||"",s=((x=this.fragmentEditor)==null?void 0:x.getValue())||"",r=((T=(g=this.shaderDescriptionInput)==null?void 0:g.value)==null?void 0:T.trim())||void 0;let a=this.currentLoadedShaderId;const l=a?this.savedShaders.findIndex(E=>E.id===a):-1,c=this.savedShaders.findIndex(E=>E.name===e&&E.id!==a);if(c!==-1&&l===-1){if(!confirm(`A shader named "${e}" already exists. Overwrite it?`))return;a=this.savedShaders[c].id}const y={id:a||`shader_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,name:e,description:r,params:i,vertex:t,fragment:s,savedAt:Date.now()};l!==-1?(this.savedShaders[l]=y,this.logConsole(`Updated saved shader: ${e}`,"info")):c!==-1?(this.savedShaders[c]=y,this.logConsole(`Overwrote saved shader: ${e}`,"info")):(this.savedShaders.push(y),this.logConsole(`Saved new shader: ${e}`,"info")),this.currentLoadedShaderId=y.id,this.saveShadersToStorage(),this.populateExampleDropdown(),this.exampleSelect&&(this.exampleSelect.value=`saved:${y.id}`),this.updateDeleteButtonVisibility(),this.markAsClean()}loadSavedShader(e){const i=this.savedShaders.find(t=>t.id===e);if(!i){this.logConsole(`Saved shader not found: ${e}`,"error");return}this.currentLoadedShaderId=e,this.applyShaderExample(i)}deleteCurrentShader(){if(!this.currentLoadedShaderId)return;const e=this.savedShaders.find(i=>i.id===this.currentLoadedShaderId);e&&confirm(`Delete saved shader "${e.name}"?`)&&(this.savedShaders=this.savedShaders.filter(i=>i.id!==this.currentLoadedShaderId),this.saveShadersToStorage(),this.currentLoadedShaderId=null,this.logConsole(`Deleted shader: ${e.name}`,"info"),this.populateExampleDropdown(),this.loadNewShader(),this.exampleSelect&&(this.exampleSelect.value=""),this.updateDeleteButtonVisibility())}updateDeleteButtonVisibility(){if(!this.deleteShaderBtn||!this.exampleSelect)return;const i=this.exampleSelect.value.startsWith("saved:");this.deleteShaderBtn.style.display=i?"block":"none"}getCurrentState(){var e,i,t,s;return this.paramManager.collectParamDefinitions(),{name:((e=this.shaderNameInput)==null?void 0:e.value)||"",description:((i=this.shaderDescriptionInput)==null?void 0:i.value)||"",vertex:((t=this.vertexEditor)==null?void 0:t.getValue())||"",fragment:((s=this.fragmentEditor)==null?void 0:s.getValue())||"",params:JSON.stringify(this.paramManager.getParamDefinitions())}}markAsClean(){this.lastSavedState=this.getCurrentState()}hasUnsavedChanges(){if(!this.lastSavedState)return!1;const e=this.getCurrentState();return e.name!==this.lastSavedState.name||e.description!==this.lastSavedState.description||e.vertex!==this.lastSavedState.vertex||e.fragment!==this.lastSavedState.fragment||e.params!==this.lastSavedState.params}confirmUnsavedChanges(e){return this.hasUnsavedChanges()?confirm(`You have unsaved changes. Are you sure you want to ${e}? Your changes will be lost.`):!0}populateExampleDropdown(){if(!this.exampleSelect)return;const e=this.exampleSelect.value;for(;this.exampleSelect.children.length>1;)this.exampleSelect.removeChild(this.exampleSelect.children[1]);const i=document.createElement("option");if(i.value="__import__",i.textContent="Import Shader...",i.style.fontStyle="italic",this.exampleSelect.appendChild(i),this.savedShaders.length>0){const t=document.createElement("optgroup");t.label="Saved Shaders",[...this.savedShaders].sort((r,a)=>a.savedAt-r.savedAt).forEach(r=>{const a=document.createElement("option");a.value=`saved:${r.id}`,a.textContent=r.name,t.appendChild(a)}),this.exampleSelect.appendChild(t)}if(this.shaderManifest.length>0){const t=document.createElement("optgroup");t.label="Example Shaders",this.shaderManifest.forEach(s=>{const r=document.createElement("option");r.value=s.id,r.textContent=s.label,t.appendChild(r)}),this.exampleSelect.appendChild(t)}e&&Array.from(this.exampleSelect.options).some(s=>s.value===e)&&(this.exampleSelect.value=e)}async loadExample(e){if(this.currentLoadedShaderId=null,this.shaderCache[e]){this.applyShaderExample(this.shaderCache[e]);return}const i=this.shaderManifest.find(t=>t.id===e);if(!i){this.logConsole(`Shader example '${e}' not found`,"error");return}try{const t=await fetch(`./shaders/${i.file}`);if(!t.ok)throw new Error(`Failed to load shader: ${t.status}`);const s=await t.text(),r=this.parseShaderXML(s);r&&(this.shaderCache[e]=r,this.applyShaderExample(r))}catch(t){console.error(`[ShaderStudio] Failed to load shader '${e}':`,t),this.logConsole(`Failed to load shader: ${t}`,"error")}}loadNewShader(){this.currentLoadedShaderId=null,this.currentCustomLua=null,this.shaderNameInput&&(this.shaderNameInput.value=""),this.shaderDescriptionInput&&(this.shaderDescriptionInput.value=""),this.vertexEditor&&this.vertexEditor.setValue(this.defaultShader.vertex,-1),this.fragmentEditor&&this.fragmentEditor.setValue(this.defaultShader.fragment,-1),this.paramManager.clearParameters(),this.paramManager.collectParamDefinitions(),this.paramManager.createParameterControls(),this.logConsole("New shader created with default template","info"),this.compile(),this.markAsClean()}parseShaderXML(e){try{const t=new DOMParser().parseFromString(e,"text/xml"),s=t.querySelector("shader");if(!s)throw new Error("No <shader> element found");const r=s.getAttribute("name")||"Unnamed";let a;const l=s.getAttribute("description");if(l)a=l;else{const E=t.querySelector("description");E!=null&&E.textContent&&(a=E.textContent.trim())}const c=[],y=t.querySelector("parameters");y&&y.querySelectorAll("param").forEach(k=>{const D=k.getAttribute("name"),_=k.getAttribute("type");if(!D||!_)return;let P=k.getAttribute("studioType");if(!P){const F=D.toLowerCase();F==="time"?P="time":F==="playerpos"||F==="playerposition"?P="playerpos":(F==="mousepos"||F==="mouseposition")&&(P="mousepos")}const G=k.getAttribute("default"),O=k.getAttribute("min"),L=k.getAttribute("max"),A=k.getAttribute("step"),u={name:D,type:P||_,default:G||void 0};O&&(u.min=parseFloat(O)),L&&(u.max=parseFloat(L)),A&&(u.step=parseFloat(A));const R=k.getAttribute("fps");R&&(u.fps=parseInt(R,10));const I=k.getAttribute("coordinateSpace")||k.getAttribute("coordinate-space");(I==="world"||I==="screen")&&(u.coordinateSpace=I);const U=k.getAttribute("index");U&&(u.index=parseInt(U,10)),c.push(u)});const v=t.querySelector("vertex"),h=this.dedentCode((v==null?void 0:v.textContent)||""),b=t.querySelector("fragment"),x=this.dedentCode((b==null?void 0:b.textContent)||""),g=t.querySelector("lua"),T=g?this.dedentCode(g.textContent||""):void 0;return{name:r,description:a,params:c,vertex:h,fragment:x,customLua:T}}catch(i){return console.error("[ShaderStudio] Failed to parse shader XML:",i),this.logConsole(`Failed to parse shader XML: ${i}`,"error"),null}}dedentCode(e){if(!e)return"";const i=e.split(`
`);for(;i.length>0&&i[0].trim()==="";)i.shift();for(;i.length>0&&i[i.length-1].trim()==="";)i.pop();if(i.length===0)return"";let t=1/0;for(const r of i){if(r.trim()==="")continue;const a=r.match(/^(\s*)/);a&&(t=Math.min(t,a[1].length))}return t===1/0||t===0?i.join(`
`):i.map(r=>r.trim()===""?"":r.substring(t)).join(`
`)}indentCode(e,i){return e?e.split(`
`).map(s=>s.trim()===""?"":i+s).join(`
`):""}applyShaderExample(e){this.shaderNameInput&&(this.shaderNameInput.value=e.name),this.shaderDescriptionInput&&(this.shaderDescriptionInput.value=e.description||""),this.vertexEditor&&this.vertexEditor.setValue(e.vertex,-1),this.fragmentEditor&&this.fragmentEditor.setValue(e.fragment,-1),this.currentCustomLua=e.customLua||null,this.paramManager.loadParameters(e.params),this.logConsole(`Loaded shader: ${e.name}`,"info"),this.compile(),this.markAsClean()}compile(){var e,i,t;console.log("[ShaderStudio] compile() called"),this.clearConsole(),this.clearEditorAnnotations();try{if(!this.glCanvas){console.log("[ShaderStudio] compile: glCanvas not found!"),this.logConsole("GL Canvas not found","error");return}console.log("[ShaderStudio] compile: glCanvas found, size:",this.glCanvas.width,"x",this.glCanvas.height),this.renderer.stopRendering(),this.paramManager.collectParamDefinitions(),this.paramManager.createParameterControls(!0);const s=((e=this.shaderNameInput)==null?void 0:e.value)||"MyShader";console.log("[ShaderStudio] Compiling shader:",s);const r=((i=this.vertexEditor)==null?void 0:i.getValue())||this.defaultShader.vertex,a=((t=this.fragmentEditor)==null?void 0:t.getValue())||this.defaultShader.fragment;console.log("[ShaderStudio] Vertex source length:",r.length,"Fragment source length:",a.length),this.compiler.initGL(this.glCanvas);const l=this.compiler.getContext();if(console.log("[ShaderStudio] GL context:",l),!l)throw new Error("Failed to get WebGL context");const y=this.paramManager.getParamDefinitions().map(b=>b.name),v=this.compiler.validateIsaacShader(r,a,y);for(const b of v.warnings)this.logConsole(" "+b,"warning");for(const b of v.errors)this.logConsole(" Isaac compatibility: "+b,"error");v.valid||this.logConsole(" Shader will NOT work in Isaac! Custom parameters must be passed as vertex attributes  varyings, not uniforms.","error");const h=this.compiler.createProgram(r,a);console.log("[ShaderStudio] Program created:",h),this.renderer.initialize(l,this.glCanvas),this.renderer.setProgram(h),this.renderer.setupGeometry(),this.renderer.setupParameterAttributes(r),console.log("[ShaderStudio] Renderer setup complete"),this.viewportControls&&this.viewportControls.classList.add("active"),this.enabled=!0,console.log("[ShaderStudio] Starting render, enabled:",this.enabled),this.renderer.startRendering(),this.playPauseBtn&&(this.playPauseBtn.textContent=""),v.valid?this.logConsole("Shader compiled successfully","success"):this.logConsole("Shader compiled (preview only - fix errors for Isaac compatibility)","warning")}catch(s){console.error("[ShaderStudio] Compilation error:",s);const r=s.message;this.logConsole("Compilation failed: "+r,"error"),this.highlightShaderError(r)}}compileWithCode(e,i,t){console.log("[ShaderStudio] compileWithCode() called");try{if(!this.glCanvas)return console.log("[ShaderStudio] compileWithCode: glCanvas not found!"),!1;this.renderer.stopRendering(),this.currentVertexSource=e,this.currentFragmentSource=i,t&&t.length>0&&(this.paramManager.setParamDefinitions(t),this.paramManager.createParameterControls(!0)),this.compiler.initGL(this.glCanvas);const s=this.compiler.getContext();if(!s)throw new Error("Failed to get WebGL context");const r=this.compiler.createProgram(e,i);return console.log("[ShaderStudio] Program created:",r),this.renderer.initialize(s,this.glCanvas),this.renderer.setProgram(r),this.renderer.setupGeometry(),this.renderer.setupParameterAttributes(e),this.enabled=!0,this.renderer.startRendering(),!0}catch(s){throw console.error("[ShaderStudio] compileWithCode error:",s),s}}clearEditorAnnotations(){if(this.vertexEditor){this.vertexEditor.session.clearAnnotations();const e=this.vertexEditor.session.getMarkers(!1);for(const i in e)e[i].clazz==="shader-error-line"&&this.vertexEditor.session.removeMarker(parseInt(i,10))}if(this.fragmentEditor){this.fragmentEditor.session.clearAnnotations();const e=this.fragmentEditor.session.getMarkers(!1);for(const i in e)e[i].clazz==="shader-error-line"&&this.fragmentEditor.session.removeMarker(parseInt(i,10))}}highlightShaderError(e){const i=e.toLowerCase().includes("vertex"),t=e.toLowerCase().includes("fragment"),s=e.match(/ERROR:\s*\d+:(\d+)/i);let r=0;s&&(r=parseInt(s[1],10)-1);const a=e.match(/ERROR:\s*\d+:\d+:\s*(.+)/i),l=a?a[1]:e,c={row:Math.max(0,r),column:0,text:l,type:"error"},y=ace.require("ace/range").Range,v=new y(Math.max(0,r),0,Math.max(0,r),1);t&&this.fragmentEditor?(this.fragmentEditor.session.setAnnotations([c]),this.fragmentEditor.session.addMarker(v,"shader-error-line","fullLine",!1),this.fragmentEditor.gotoLine(r+1,0,!0)):i&&this.vertexEditor?(this.vertexEditor.session.setAnnotations([c]),this.vertexEditor.session.addMarker(v,"shader-error-line","fullLine",!1),this.vertexEditor.gotoLine(r+1,0,!0)):this.fragmentEditor&&(this.fragmentEditor.session.setAnnotations([c]),this.fragmentEditor.session.addMarker(v,"shader-error-line","fullLine",!1),this.fragmentEditor.gotoLine(r+1,0,!0))}updateFromGame(e,i,t,s,r,a=[]){if(!this.autoCompiled&&this.initialized&&(console.log("[ShaderStudio] Auto-compiling..."),this.autoCompiled=!0,this.logConsole("Auto-compiling passthrough shader...","info"),this.compile()),!this.enabled){console.log("[ShaderStudio] updateFromGame: not enabled, initialized:",this.initialized,"autoCompiled:",this.autoCompiled);return}const l=-2,c=i*4,y=(t+l)*4,v=a.map(h=>({x:h.x*4,y:(h.y+l)*4}));this.renderer.updateGameState({bufferCanvas:e,playerPosition:{x:c,y},playerPositionWorld:{x:c,y},canvasWidth:s,canvasHeight:r,tearPositions:v}),this.playerPosDisplay&&(this.playerPosDisplay.textContent=`${i.toFixed(0)}, ${t.toFixed(0)}`)}render(){!this.enabled||this.renderer.isActive()}generateXML(){var v,h,b,x,g,T;this.paramManager.collectParamDefinitions();const e=((h=(v=this.shaderNameInput)==null?void 0:v.value)==null?void 0:h.trim())||"MyShader",i=((x=(b=this.shaderDescriptionInput)==null?void 0:b.value)==null?void 0:x.trim())||"",t=((g=this.vertexEditor)==null?void 0:g.getValue())||"",s=((T=this.fragmentEditor)==null?void 0:T.getValue())||"",r=this.paramManager.getParamDefinitions();let a="";r.length>0&&(a=`    <parameters>
`,r.forEach(E=>{let k,D=null;E.type==="time"?(k="float",D="time"):E.type==="mousepos"?(k="vec2",D="mousepos"):E.type==="playerpos"?(k="vec2",D="playerpos"):E.type==="tearpos"?(k="vec2",D="tearpos"):E.type==="boolean"?(k="float",D="boolean"):E.type==="color"?(k="vec3",D="color"):k=E.type;let _=`name="${E.name}" type="${k}"`;D&&(_+=` studioType="${D}"`),E.default!==void 0&&E.default!==""&&(_+=` default="${E.default}"`),E.min!==void 0&&E.min!==""&&(_+=` min="${E.min}"`),E.max!==void 0&&E.max!==""&&(_+=` max="${E.max}"`),E.step!==void 0&&E.step!==""&&(_+=` step="${E.step}"`),E.fps!==void 0&&(_+=` fps="${E.fps}"`),E.coordinateSpace!==void 0&&E.coordinateSpace!==""&&(_+=` coordinateSpace="${E.coordinateSpace}"`),E.index!==void 0&&(_+=` index="${E.index}"`),a+=`      <param ${_}/>
`}),a+=`    </parameters>
`);const l=this.indentCode(t,"      "),c=this.indentCode(s,"      ");return`<shaders>${i?`
  <!-- ${i} -->
`:`
`}  <shader name="${e}">
${a}    <vertex><![CDATA[
${l}
    ]]></vertex>
    <fragment><![CDATA[
${c}
    ]]></fragment>
  </shader>
</shaders>`}generateLua(){var E,k,D,_;this.paramManager.collectParamDefinitions();const e=((k=(E=this.shaderNameInput)==null?void 0:E.value)==null?void 0:k.trim())||"MyShader",i=((_=(D=this.shaderDescriptionInput)==null?void 0:D.value)==null?void 0:_.trim())||"",t=this.paramManager.getParamDefinitions(),s=this.paramManager.getShaderParams(),r=[],a=(P,G=3)=>P.toFixed(G).replace(/\.?0+$/,"")||"0";t.forEach(P=>{if(P.type==="time"){const G=P.fps||60;G===60?r.push(`            ${P.name} = Isaac.GetFrameCount()`):G===30?r.push(`            ${P.name} = math.floor(Isaac.GetFrameCount() / 2)`):r.push(`            ${P.name} = math.floor(Isaac.GetFrameCount() * ${G} / 60)`)}else if(P.type==="playerpos"||P.type==="mousepos")P.type==="playerpos"&&P.coordinateSpace==="world"?r.push(`            ${P.name} = { playerPos.X, playerPos.Y }`):r.push(`            ${P.name} = { screenPos.X, screenPos.Y }`);else if(P.type==="tearpos"){const G=P.index||1;r.push(`            ${P.name} = tearPositions[${G}]`)}else if(P.type==="boolean"){const G=s[P.name],O=G!==void 0?G:P.default==="0"||P.default==="0.0"?0:1;r.push(`            ${P.name} = ${O===0?"0.0":"1.0"}`)}else if(P.type==="float"){const G=s[P.name],O=G!==void 0?G:parseFloat(P.default||"1.0");r.push(`            ${P.name} = ${a(O)}`)}else if(P.type==="vec2"){const G=s[P.name];if(G&&Array.isArray(G))r.push(`            ${P.name} = { ${a(G[0])}, ${a(G[1])} }`);else{const L=(P.default||"0.0,0.0").split(",").map(A=>A.trim());r.push(`            ${P.name} = { ${L[0]||"0.0"}, ${L[1]||"0.0"} }`)}}else if(P.type==="vec3"||P.type==="color"){const G=s[P.name];if(G&&Array.isArray(G))r.push(`            ${P.name} = { ${a(G[0])}, ${a(G[1])}, ${a(G[2])} }`);else{const L=(P.default||"0.0,0.0,0.0").split(",").map(A=>A.trim());r.push(`            ${P.name} = { ${L[0]||"0.0"}, ${L[1]||"0.0"}, ${L[2]||"0.0"} }`)}}else if(P.type==="vec4"){const G=s[P.name];if(G&&Array.isArray(G))r.push(`            ${P.name} = { ${a(G[0])}, ${a(G[1])}, ${a(G[2])}, ${a(G[3])} }`);else{const L=(P.default||"0.0,0.0,0.0,0.0").split(",").map(A=>A.trim());r.push(`            ${P.name} = { ${L[0]||"0.0"}, ${L[1]||"0.0"}, ${L[2]||"0.0"}, ${L[3]||"0.0"} }`)}}});const l=r.length>0?r.join(`,
`):"",c=e.replace(/[^a-zA-Z0-9]/g,"")+"Mod",y=t.some(P=>P.type==="mousepos"||P.type==="playerpos"&&P.coordinateSpace!=="world"),v=t.some(P=>P.type==="playerpos"&&P.coordinateSpace==="world"),h=t.some(P=>P.type==="tearpos"),b=t.filter(P=>P.type==="tearpos").reduce((P,G)=>Math.max(P,G.index||1),0),x=y||v;let g="";x&&(g=`
        local player = Isaac.GetPlayer()`,v&&(g+=`
        local playerPos = player.Position`),y&&(g+=`
        local screenPos = Isaac.WorldToScreen(player.Position)`)),h&&(g+=`

        -- Collect tear positions (player tears only)
        local tearPositions = {}
        local tears = Isaac.FindByType(EntityType.ENTITY_TEAR, -1, -1, false, false)
        for _, entity in ipairs(tears) do
            if #tearPositions >= ${b} then break end
            local tear = entity:ToTear()
            if tear and tear.SpawnerEntity and tear.SpawnerEntity.Type == EntityType.ENTITY_PLAYER then
                local tearScreenPos = Isaac.WorldToScreen(tear.Position)
                table.insert(tearPositions, { tearScreenPos.X, tearScreenPos.Y + tear.Height })
            end
        end
        -- Pad with zeros for unused slots
        while #tearPositions < ${b} do
            table.insert(tearPositions, { 0, 0 })
        end`);const T=i?`
-- ${i}`:"";return`-- Shader: ${e}${T}
-- Generated by Isaac Shader Studio

local ${c} = RegisterMod("${c}", 1)

function ${c}:GetShaderParams(shaderName)
    if shaderName == '${e}' then${g}

        local params = {
${l}
        }
        return params
    end
end

${c}:AddCallback(ModCallbacks.MC_GET_SHADER_PARAMS, ${c}.GetShaderParams)
`}generateMetadata(){var r,a,l,c;const e=((a=(r=this.shaderNameInput)==null?void 0:r.value)==null?void 0:a.trim())||"MyShader",i=((c=(l=this.shaderDescriptionInput)==null?void 0:l.value)==null?void 0:c.trim())||"Shader mod generated by Isaac Shader Studio",t=e.replace(/[^a-zA-Z0-9]/g,"")+"Mod",s=t.toLowerCase();return`<?xml version="1.0" encoding="UTF-8"?>
<metadata>
    <name>${t}</name>
    <directory>${s}</directory>
    <id></id>
    <description>${i}</description>
    <version>1.0</version>
    <visibility>Private</visibility>
</metadata>`}openViewModModal(){var l,c,y;if(!((c=(l=this.shaderNameInput)==null?void 0:l.value)==null?void 0:c.trim())){this.showErrorPopup("Please enter a shader name before exporting."),(y=this.shaderNameInput)==null||y.focus();return}const i=document.getElementById("viewModModal");if(!i)return;this.metadataEditor||(this.metadataEditor=ace.edit("metadataEditor"),this.metadataEditor.setTheme("ace/theme/monokai"),this.metadataEditor.session.setMode("ace/mode/xml"),this.metadataEditor.setOptions({fontSize:"12px",showPrintMargin:!1,tabSize:4,maxLines:12,minLines:8})),this.luaEditor||(this.luaEditor=ace.edit("luaEditor"),this.luaEditor.setTheme("ace/theme/monokai"),this.luaEditor.session.setMode("ace/mode/lua"),this.luaEditor.setOptions({fontSize:"12px",showPrintMargin:!1,tabSize:4})),this.xmlEditor||(this.xmlEditor=ace.edit("xmlEditor"),this.xmlEditor.setTheme("ace/theme/monokai"),this.xmlEditor.session.setMode("ace/mode/xml"),this.xmlEditor.setOptions({fontSize:"12px",showPrintMargin:!1,tabSize:2}));const t=this.generateMetadata(),s=this.currentCustomLua||this.generateLua(),r=this.generateXML();this.metadataEditor.setValue(t,-1),this.luaEditor.setValue(s,-1),this.xmlEditor.setValue(r,-1);const a=document.getElementById("luaCustomNotice");if(a){const v=this.currentCustomLua&&this.hasUnsavedChanges();a.style.display=v?"block":"none"}this.setupModalTabs(),i.style.display="flex",this.modalOpen=!0,setTimeout(()=>{this.resizeActiveModalEditor()},100)}setupModalTabs(){const e=document.querySelectorAll(".modal-tab"),i=document.querySelectorAll(".modal-tab-pane");e.forEach(t=>{t.addEventListener("click",()=>{const s=t.getAttribute("data-tab");e.forEach(r=>r.classList.remove("active")),t.classList.add("active"),i.forEach(r=>{r.getAttribute("data-tab")===s?r.classList.add("active"):r.classList.remove("active")}),this.resizeActiveModalEditor()})})}resizeActiveModalEditor(){var t,s,r;const e=document.querySelector(".modal-tab-pane.active");if(!e)return;switch(e.getAttribute("data-tab")){case"metadata":(t=this.metadataEditor)==null||t.resize();break;case"lua":(s=this.luaEditor)==null||s.resize();break;case"xml":(r=this.xmlEditor)==null||r.resize();break}}closeViewModModal(){const e=document.getElementById("viewModModal");e&&(e.style.display="none"),this.modalOpen=!1}async downloadMod(){var v,h,b,x,g,T;const i=(((h=(v=this.shaderNameInput)==null?void 0:v.value)==null?void 0:h.trim())||"MyShader").replace(/[^a-zA-Z0-9]/g,"")+"Mod",t=((b=this.metadataEditor)==null?void 0:b.getValue())||this.generateMetadata(),s=((x=this.luaEditor)==null?void 0:x.getValue())||this.currentCustomLua||this.generateLua(),r=((g=this.xmlEditor)==null?void 0:g.getValue())||this.generateXML(),a=new JSZip;a.file("metadata.xml",t),a.file("main.lua",s),(T=a.folder("content"))==null||T.file("shaders.xml",r);const l=await a.generateAsync({type:"blob"}),c=URL.createObjectURL(l),y=document.createElement("a");y.href=c,y.download=`${i}.zip`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(c),this.logConsole(`Downloaded mod: ${i}.zip`,"success")}setupImportModalListeners(){this.importModal=document.getElementById("importShaderModal"),this.importDropZone=document.getElementById("importDropZone"),this.importFileInput=document.getElementById("importFileInput"),this.importValidationError=document.getElementById("importValidationError"),this.importShaderListContainer=document.getElementById("importShaderListContainer"),this.importShaderList=document.getElementById("importShaderList"),this.importShaderCount=document.getElementById("importShaderCount"),this.importSelectAll=document.getElementById("importSelectAll"),this.importShadersBtn=document.getElementById("importShadersBtn");const e=document.getElementById("closeImportModalBtn"),i=document.getElementById("cancelImportBtn");e&&e.addEventListener("click",()=>this.closeImportModal()),i&&i.addEventListener("click",()=>this.closeImportModal()),this.importModal&&this.importModal.addEventListener("click",t=>{t.target===this.importModal&&this.closeImportModal()}),this.importDropZone&&this.importFileInput&&(this.importDropZone.addEventListener("click",()=>{var t;(t=this.importFileInput)==null||t.click()}),this.importFileInput.addEventListener("change",t=>{const s=t.target.files;s&&s.length>0&&this.handleImportFiles(Array.from(s))}),this.importDropZone.addEventListener("dragover",t=>{var s;t.preventDefault(),t.stopPropagation(),(s=this.importDropZone)==null||s.classList.add("drag-over")}),this.importDropZone.addEventListener("dragleave",t=>{var s;t.preventDefault(),t.stopPropagation(),(s=this.importDropZone)==null||s.classList.remove("drag-over")}),this.importDropZone.addEventListener("drop",t=>{var r,a;t.preventDefault(),t.stopPropagation(),(r=this.importDropZone)==null||r.classList.remove("drag-over");const s=(a=t.dataTransfer)==null?void 0:a.files;s&&s.length>0&&this.handleImportFiles(Array.from(s))})),this.importSelectAll&&this.importSelectAll.addEventListener("change",()=>{var s;((s=this.importShaderList)==null?void 0:s.querySelectorAll(".import-shader-checkbox")).forEach(r=>{r.checked=this.importSelectAll.checked}),this.updateImportButtonState()}),this.importShadersBtn&&this.importShadersBtn.addEventListener("click",()=>this.importSelectedShaders())}openImportModal(){this.importModal&&(this.resetImportModal(),this.importModal.style.display="flex")}closeImportModal(){this.importModal&&(this.importModal.style.display="none"),this.resetImportModal()}resetImportModal(){this.importFileInput&&(this.importFileInput.value=""),this.importValidationError&&(this.importValidationError.style.display="none",this.importValidationError.textContent=""),this.importShaderListContainer&&(this.importShaderListContainer.style.display="none"),this.importShaderList&&(this.importShaderList.innerHTML=""),this.importSelectAll&&(this.importSelectAll.checked=!0),this.importShadersBtn&&(this.importShadersBtn.disabled=!0),this.parsedShadersForImport=[]}async handleImportFiles(e){const i=e.filter(r=>r.name.toLowerCase().endsWith(".xml")),t=e.filter(r=>r.name.toLowerCase().endsWith(".vs")),s=e.filter(r=>r.name.toLowerCase().endsWith(".fs"));i.length>0?await this.handleXMLImport(i[0]):t.length>0||s.length>0?await this.handleGLSLImport(t,s):this.showImportError("Please select a shaders.xml file or .vs/.fs shader files.")}async handleXMLImport(e){try{const i=await e.text(),t=await this.validateShadersXML(i);if(!t.valid){this.showImportError(t.error||"Invalid shaders.xml format.");return}const s=this.parseShadersFromXML(i);if(s.length===0){this.showImportError("No shaders found in the XML file.");return}this.parsedShadersForImport=s,this.displayImportShaderList(s)}catch(i){console.error("[ShaderStudio] Import XML error:",i),this.showImportError(`Error reading XML file: ${i}`)}}async handleGLSLImport(e,i){try{const t=[],s=new Map,r=new Map;for(const c of e){const y=this.getShaderBaseName(c.name);s.set(y,c)}for(const c of i){const y=this.getShaderBaseName(c.name);r.set(y,c)}const a=new Set([...s.keys(),...r.keys()]);for(const c of a){const y=s.get(c),v=r.get(c);if(!y&&!v)continue;let h=this.defaultShader.vertex,b=this.defaultShader.fragment;y&&(h=await y.text()),v&&(b=await v.text());const x=this.extractParametersFromVertexShader(h),T={name:this.formatShaderName(c),description:y&&v?`Imported from ${y.name} and ${v.name}`:`Imported from ${(y==null?void 0:y.name)||(v==null?void 0:v.name)}`,params:x,vertex:h,fragment:b};t.push(T)}if(t.length===0){this.showImportError("No valid shader files found.");return}const l=[];for(const c of a)s.has(c)||l.push(`${c}: Missing .vs file, using default vertex shader`),r.has(c)||l.push(`${c}: Missing .fs file, using default fragment shader`);l.length>0&&this.logConsole(`Import warnings:
`+l.join(`
`),"warning"),this.parsedShadersForImport=t,this.displayImportShaderList(t)}catch(t){console.error("[ShaderStudio] Import GLSL error:",t),this.showImportError(`Error reading shader files: ${t}`)}}extractParametersFromVertexShader(e){const i=[],t=["Position","Color","TexCoord","RenderData","Scale","Transform"],s=/\b(?:attribute|in)\s+(float|vec2|vec3|vec4|mat4)\s+(\w+)\s*;/g;let r;for(;(r=s.exec(e))!==null;){const a=r[1],l=r[2];if(t.includes(l)||a==="mat4")continue;let c;switch(a){case"float":c="float";break;case"vec2":c="vec2";break;case"vec3":c="vec3";break;case"vec4":c="vec4";break;default:continue}const y=l.toLowerCase();y==="time"||y.endsWith("time")?c="time":y==="playerpos"||y==="playerposition"?c="playerpos":(y==="mousepos"||y==="mouseposition")&&(c="mousepos");const v={name:l,type:c};c==="float"&&(v.default="1.0",v.min=0,v.max=1,v.step=.01),i.push(v)}return i}getShaderBaseName(e){return e.replace(/\.(vs|fs)$/i,"")}formatShaderName(e){return e.split(/[_-]/).map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ")}async validateShadersXML(e){var i;try{const s=new DOMParser().parseFromString(e,"text/xml"),r=s.querySelector("parsererror");if(r)return{valid:!1,error:"Invalid XML: "+((i=r.textContent)==null?void 0:i.substring(0,100))};const a=s.documentElement;if(a.tagName!=="shaders")return{valid:!1,error:`Invalid root element: expected <shaders>, found <${a.tagName}>`};const l=s.querySelectorAll("shader");if(l.length===0)return{valid:!1,error:"No <shader> elements found in the file."};for(let c=0;c<l.length;c++){const y=l[c],v=y.getAttribute("name");if(!v)return{valid:!1,error:`Shader #${c+1} is missing required 'name' attribute.`};const h=y.querySelector("vertex"),b=y.querySelector("fragment");if(!h)return{valid:!1,error:`Shader '${v}' is missing <vertex> element.`};if(!b)return{valid:!1,error:`Shader '${v}' is missing <fragment> element.`}}try{(await fetch("https://wofsauge.github.io/isaac-xml-validator/xsd/shaders.xsd")).ok&&this.logConsole("Validated against Isaac shaders.xml format","info")}catch{console.warn("[ShaderStudio] Could not fetch XSD for validation, using basic validation")}return{valid:!0}}catch(t){return{valid:!1,error:`Validation error: ${t}`}}}parseShadersFromXML(e){const i=[];try{new DOMParser().parseFromString(e,"text/xml").querySelectorAll("shader").forEach(a=>{const l=this.parseShaderElement(a);l&&i.push(l)})}catch(t){console.error("[ShaderStudio] Error parsing shaders XML:",t)}return i}parseShaderElement(e){var i;try{const t=e.getAttribute("name")||"Unnamed";let s;const r=e.getAttribute("description");if(r)s=r;else{const b=e.previousSibling;b&&b.nodeType===Node.COMMENT_NODE&&(s=(i=b.textContent)==null?void 0:i.trim())}const a=[],l=e.querySelector("parameters");l&&l.querySelectorAll("param").forEach(x=>{const g=x.getAttribute("name"),T=x.getAttribute("type");if(!g||!T)return;let E=x.getAttribute("studioType");if(!E){const u=g.toLowerCase();u==="time"?E="time":u==="playerpos"||u==="playerposition"?E="playerpos":(u==="mousepos"||u==="mouseposition")&&(E="mousepos")}const k=x.getAttribute("default"),D=x.getAttribute("min"),_=x.getAttribute("max"),P=x.getAttribute("step"),G={name:g,type:E||T,default:k||void 0};D&&(G.min=parseFloat(D)),_&&(G.max=parseFloat(_)),P&&(G.step=parseFloat(P));const O=x.getAttribute("fps");O&&(G.fps=parseInt(O,10));const L=x.getAttribute("coordinateSpace")||x.getAttribute("coordinate-space");(L==="world"||L==="screen")&&(G.coordinateSpace=L);const A=x.getAttribute("index");A&&(G.index=parseInt(A,10)),a.push(G)});const c=e.querySelector("vertex"),y=this.dedentCode((c==null?void 0:c.textContent)||""),v=e.querySelector("fragment"),h=this.dedentCode((v==null?void 0:v.textContent)||"");return{name:t,description:s,params:a,vertex:y,fragment:h}}catch(t){return console.error("[ShaderStudio] Error parsing shader element:",t),null}}showImportError(e){this.importValidationError&&(this.importValidationError.textContent=e,this.importValidationError.style.display="block"),this.importShaderListContainer&&(this.importShaderListContainer.style.display="none")}displayImportShaderList(e){this.importValidationError&&(this.importValidationError.style.display="none"),this.importShaderCount&&(this.importShaderCount.textContent=`Found ${e.length} shader${e.length!==1?"s":""} in file:`),this.importShaderList&&(this.importShaderList.innerHTML="",e.forEach((i,t)=>{const s=document.createElement("div");s.className="import-shader-item",s.innerHTML=`
                    <input type="checkbox" class="import-shader-checkbox" data-index="${t}" checked>
                    <div class="import-shader-info">
                        <div class="import-shader-name">${this.escapeHtml(i.name)}</div>
                        ${i.description?`<div class="import-shader-desc">${this.escapeHtml(i.description)}</div>`:""}
                    </div>
                `,s.querySelector(".import-shader-checkbox").addEventListener("change",()=>this.updateImportButtonState()),this.importShaderList.appendChild(s)})),this.importShaderListContainer&&(this.importShaderListContainer.style.display="block"),this.updateImportButtonState()}escapeHtml(e){const i=document.createElement("div");return i.textContent=e,i.innerHTML}updateImportButtonState(){if(!this.importShadersBtn||!this.importShaderList)return;const e=this.importShaderList.querySelectorAll(".import-shader-checkbox:checked");if(this.importShadersBtn.disabled=e.length===0,this.importShadersBtn.textContent=`Import Selected (${e.length})`,this.importSelectAll){const i=this.importShaderList.querySelectorAll(".import-shader-checkbox"),t=Array.from(i).filter(s=>s.checked).length;this.importSelectAll.checked=t===i.length,this.importSelectAll.indeterminate=t>0&&t<i.length}}importSelectedShaders(){if(!this.importShaderList)return;const e=this.importShaderList.querySelectorAll(".import-shader-checkbox:checked"),i=Array.from(e).map(r=>parseInt(r.dataset.index||"0",10));if(i.length===0){this.showImportError("Please select at least one shader to import.");return}if(!this.confirmUnsavedChanges("import shaders"))return;const t=[];let s=null;i.forEach(r=>{const a=this.parsedShadersForImport[r];if(!a)return;const l=`shader_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;if(this.savedShaders.findIndex(v=>v.name===a.name)!==-1){let v=a.name,h=1;for(;this.savedShaders.some(b=>b.name===v)||t.some(b=>b.name===v);)v=`${a.name} (${h})`,h++;a.name=v}const y={id:l,name:a.name,description:a.description,params:a.params,vertex:a.vertex,fragment:a.fragment,savedAt:Date.now()};t.push(y),s||(s=l)}),this.savedShaders.push(...t),this.saveShadersToStorage(),this.populateExampleDropdown(),this.closeImportModal(),this.logConsole(`Imported ${t.length} shader${t.length!==1?"s":""}`,"success"),s&&(this.loadSavedShader(s),this.exampleSelect&&(this.exampleSelect.value=`saved:${s}`),this.updateDeleteButtonVisibility())}logConsole(e,i="info"){if(!this.consoleEl)return;const t=document.createElement("div");t.className=`console-entry ${i}`;const s=new Date().toLocaleTimeString();t.innerHTML=`<span class="console-timestamp">[${s}]</span>${e}`,this.consoleEl.appendChild(t),this.consoleEl.scrollTop=this.consoleEl.scrollHeight}showErrorPopup(e){var s;const i=document.createElement("div");i.className="error-popup-overlay",i.innerHTML=`
            <div class="error-popup">
                <div class="error-popup-icon"></div>
                <div class="error-popup-message">${e}</div>
                <button class="error-popup-btn">OK</button>
            </div>
        `,document.body.appendChild(i);const t=()=>{i.remove()};(s=i.querySelector(".error-popup-btn"))==null||s.addEventListener("click",t),i.addEventListener("click",r=>{r.target===i&&t()}),this.logConsole(e,"error")}clearConsole(){this.consoleEl&&(this.consoleEl.innerHTML="")}isInitialized(){return this.initialized}getGLCanvas(){return this.glCanvas}setParameter(e,i){this.paramManager.setParameter(e,i)}getParameterManager(){return this.paramManager}},m(Ie,"instance"),m(Ie,"STORAGE_KEY","isaac_shader_studio_saved_shaders"),Ie);const Oi=Kt.getInstance(),Ki=Object.freeze(Object.defineProperty({__proto__:null,ParameterManager:qt,ShaderCompiler:zt,ShaderRenderer:Yt,ShaderStudio:Kt,Studio:Oi},Symbol.toStringTag,{value:"Module"}));export{qe as $,q as A,ni as B,C,le as D,je as E,Ni as F,te as G,we as H,$i as I,Pe as J,Vi as K,Ii as L,j as M,Rt as N,Wt as O,lt as P,Gi as Q,mt as R,pt as S,wi as T,Bi as U,Wi as V,K as W,ki as X,bt as Y,Ht as Z,Ge as _,Xe as a,Hi as a0,zi as a1,Se as a2,qi as a3,Yi as a4,Me as b,tt as c,ui as d,fi as e,ye as f,Ei as g,$ as h,he as i,vt as j,Ti as k,S as l,yt as m,Bt as n,Ai as o,Li as p,_i as q,Fi as r,Ft as s,Ki as t,si as u,ri as v,Q as w,_e as x,ct as y,Ci as z};
