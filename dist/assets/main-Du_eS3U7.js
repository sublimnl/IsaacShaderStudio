var b=Object.defineProperty;var S=(i,e,t)=>e in i?b(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e,t)=>S(i,typeof e!="symbol"?e+"":e,t);import{C as n,K as I,M as z,q as C,r as R,I as B,m as d,L as E,t as P,i as m,e as T,a4 as A}from"./index-txHAgSDL.js";import{b as x,a as L,c as $,d as q,t as G}from"./index-BRIFiw3q.js";const{Studio:c}=P;class M{constructor(){h(this,"initialized",!1);n.initialize(document.getElementById("gameCanvas")||document.querySelector("canvas"),286,442),this.PreloadAssets(),I.start(),document.addEventListener("tick",e=>{this.Update(e),this.Render(e)})}PreloadAssets(){z.Preload(C,R,B);const e=document.querySelector(".loader"),t=e==null?void 0:e.querySelector("progress");e==null||e.removeAttribute("hidden"),document.addEventListener("loadingEvent",s=>{t&&(t.value=s.detail.progress),s.detail.progress>=100&&!this.initialized&&(e==null||e.setAttribute("hidden","true"),this.Start(),e==null||e.classList.add("fade-out"),this.initialized=!0)})}Start(){d.ChangeScene(new E),c.initialize()}Update(e){d.Update(e)}Render(e){var t,s,l;if(n.Clear(),d.Render(),n.Render(),c.isInitialized()){const o=m.GetPlayer(),v=((t=o==null?void 0:o.Position)==null?void 0:t.x)??n.width/2,p=((s=o==null?void 0:o.Position)==null?void 0:s.y)??n.height/2,r=[],u=(l=m.GetLevel())==null?void 0:l.GetRoom();if(u){const w=u.GetEntities();for(const a of w){if(r.length>=10)break;if(a instanceof T){const y=a.Height??0;r.push({x:a.Position.x,y:a.Position.y+y})}}}c.updateFromGame(n.getBufferCanvas(),v,p,n.width,n.height,r)}}}const g=()=>{const i=document.getElementById("glCanvas"),e=document.querySelector(".viewport");if(i&&e){const t=e.getBoundingClientRect(),s=A(i.width,i.height,t.width-20,t.height-20);i.style.width=`${s.width}px`,i.style.height=`${s.height}px`}};var f;(f=document.getElementById("root"))!=null&&f.hasChildNodes()||(window.onload=()=>{window.TBOI=new M,g();const i=document.querySelector(".viewport");if(i){let t;new ResizeObserver(()=>{clearTimeout(t),t=setTimeout(g,50)}).observe(i)}const e=document.getElementById("buildInfo");e&&(e.innerText=`Build: ${x}.${L}.${$}-${q}; Updated: ${new Date(G).toLocaleString()}`)});export{M as WebBOI};
