# Exporting Shaders

Export your shader for use in The Binding of Isaac: Repentance.

## Export Process

1. Click the **Export** button (or press `Ctrl+E`)
2. Review the generated files in each tab
3. Optionally edit the generated code
4. Click **Download Mod (.zip)** to get all files

## Generated Files

The export creates a complete mod structure:

### metadata.xml

Mod metadata for Steam Workshop and the game:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<metadata>
    <name>MyShaderMod</name>
    <directory>MyShaderMod</directory>
    <id></id>
    <description>Your shader description</description>
    <version>1.0</version>
    <visibility>Private</visibility>
</metadata>
```

- **name**: Display name in the mod menu
- **directory**: Folder name for the mod
- **id**: Steam Workshop ID (leave empty for local testing)
- **visibility**: Set to "Public" before uploading to Workshop

### main.lua

Lua script that registers and applies your shader:

```lua
-- Shader: MyShader
-- Generated by Isaac Shader Studio

local MyShaderMod = RegisterMod("MyShaderMod", 1)

function MyShaderMod:GetShaderParams(shaderName)
    if shaderName == 'MyShader' then
        local player = Isaac.GetPlayer()
        local screenPos = Isaac.WorldToScreen(player.Position)

        local params = {
            Intensity = 0.8,
            PlayerPos = { screenPos.X, screenPos.Y },
            Time = Isaac.GetFrameCount()
        }
        return params
    end
end

MyShaderMod:AddCallback(ModCallbacks.MC_GET_SHADER_PARAMS, MyShaderMod.GetShaderParams)
```

The generated code handles:
- Time-based parameters (using `Isaac.GetFrameCount()`)
- Player position (screen or world coordinates)
- Tear positions (collecting from entities)
- Static parameter values

### content/shaders.xml

The shader definition file:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<shaders>
  <shader name="MyShader" description="My awesome effect">
    <parameters>
      <param name="Intensity" type="float" default="0.8" min="0" max="1" />
      <param name="PlayerPos" type="vec2" studioType="playerpos" />
    </parameters>
    <vertex><![CDATA[
      // Vertex shader code
    ]]></vertex>
    <fragment><![CDATA[
      // Fragment shader code
    ]]></fragment>
  </shader>
</shaders>
```

## Export Settings

Click the **gear icon** in the export dialog for options:

### Strip Shader Studio Attributes

When enabled, removes Isaac Shader Studio-specific attributes from the XML:
- `studioType` - The original type before GLSL conversion
- `default`, `min`, `max`, `step` - Slider configuration
- `fps` - Time attribute frame rate
- `coordinateSpace` - Player position space
- `index` - Tear position index
- `description` - Shader description

Enable this for cleaner XML if you're not planning to re-import the shader.

## Installing Your Mod

### Method 1: Development (Recommended for Testing)

1. Extract the ZIP to your Isaac mods folder:
   - Windows: `Documents\My Games\Binding of Isaac Repentance\mods\`
   - macOS: `~/Library/Application Support/Binding of Isaac Repentance/mods/`
   - Linux: `~/.local/share/binding of isaac repentance/mods/`

2. Your mod structure should be:
   ```
   mods/
   └── MyShaderMod/
       ├── metadata.xml
       ├── main.lua
       └── content/
           └── shaders.xml
   ```

3. Launch the game and enable your mod in the Mods menu

### Method 2: Steam Workshop

1. Install your mod locally first and test it
2. Set `<visibility>Public</visibility>` in metadata.xml
3. Use the in-game mod uploader or Steam's workshop tools
4. Fill in the Workshop description and tags

## Using Your Shader in Isaac

The exported mod applies the shader globally. To use it conditionally:

### Apply on Specific Rooms

```lua
function MyMod:OnNewRoom()
    local room = Game():GetRoom()
    if room:GetType() == RoomType.ROOM_BOSS then
        -- Shader will be active
        self.ShaderActive = true
    else
        self.ShaderActive = false
    end
end

function MyMod:GetShaderParams(shaderName)
    if shaderName == 'MyShader' and self.ShaderActive then
        return { ... }
    end
    -- Return nil to disable shader
end
```

### Apply on Specific Items

```lua
function MyMod:GetShaderParams(shaderName)
    local player = Isaac.GetPlayer()
    if shaderName == 'MyShader' and player:HasCollectible(CollectibleType.COLLECTIBLE_BRIMSTONE) then
        return { ... }
    end
end
```

## Troubleshooting

### Shader Not Appearing

- Check that the mod is enabled in the Mods menu
- Verify file structure matches expected layout
- Check the game's log file for Lua errors
- Ensure shader name in Lua matches shaders.xml

### Black Screen

- The shader might have compilation errors in-game
- Check that all uniform names match between Lua and GLSL
- Verify parameter types are correct

### Performance Issues

- Reduce texture samples
- Simplify complex calculations
- Consider lowering precision qualifiers
- Avoid loops with many iterations

## Re-importing

You can re-import exported shaders using the **Import** button:
- Drag and drop the ZIP file
- Or select `shaders.xml` directly
- Studio-specific attributes (if not stripped) restore slider settings
